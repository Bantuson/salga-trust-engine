---
phase: 06.1.1-teams-analytics-settings
plan: 04
subsystem: frontend-dashboard/teams
tags: [teams, invite, permissions, role-management, glassmorphic, member-management]
dependency_graph:
  requires: ["06.1.1-03"]
  provides: ["QuickInviteForm", "BulkInviteDialog", "RoleAssignPreview", "PermissionMatrix"]
  affects: ["MembersTab", "TeamDetailModal"]
tech_stack:
  added: []
  patterns:
    - "Inline role preview before confirm (amber tint, slide-down)"
    - "CSS-grid permission matrix (no HTML table)"
    - "z-index layering: modal 1000, bulk dialog 1100, confirm dialogs 1200"
    - "Custom ConfirmDialog replaces window.confirm for UX consistency"
    - "currentUserRole prop forwarded for admin-gated Deactivate action"
key_files:
  created:
    - frontend-dashboard/src/components/teams/QuickInviteForm.tsx
    - frontend-dashboard/src/components/teams/BulkInviteDialog.tsx
    - frontend-dashboard/src/components/teams/RoleAssignPreview.tsx
    - frontend-dashboard/src/components/teams/PermissionMatrix.tsx
  modified:
    - frontend-dashboard/src/components/teams/MembersTab.tsx
    - frontend-dashboard/src/components/teams/TeamDetailModal.tsx
decisions:
  - "Amber rgba(255,213,79,0.08) background on RoleAssignPreview draws attention without dominating"
  - "CSS grid (not HTML table) for PermissionMatrix gives full styling control and horizontal scroll"
  - "Custom ConfirmDialog component replaces window.confirm for remove/deactivate actions"
  - "currentUserRole prop passed through TeamDetailModal to MembersTab for admin-only Deactivate visibility"
  - "z-index layers: 1000 modal, 1100 bulk dialog, 1200 confirm dialogs — never conflicts"
  - "Deactivate account is display-only stub (TODO backend endpoint); removes from local state only"
  - "InvitationsTab kept as-is (no onInvited prop) — invitations list refreshes independently"
metrics:
  duration: "6.0m (361s)"
  completed_date: "2026-02-19"
  tasks_completed: 2
  files_changed: 6
---

# Phase 06.1.1 Plan 04: Member Management Components Summary

**One-liner:** QuickInviteForm, BulkInviteDialog, RoleAssignPreview, and PermissionMatrix with role-preview-before-confirm flow and admin-gated deactivate action.

## What Was Built

Four new components complete the Teams page member management flow. The plan focused on invitation forms, role assignment preview, and the permission matrix grid.

### Task 1: QuickInviteForm + BulkInviteDialog + RoleAssignPreview

**RoleAssignPreview** (`frontend-dashboard/src/components/teams/RoleAssignPreview.tsx`):
- Amber-tinted card (rgba(255,213,79,0.08)) with capability bullet list for the selected role
- Reads from `PERMISSION_MATRIX[role]` and maps keys to human-readable `CAPABILITIES` labels
- Footer has "Confirm Assignment" (teal button) and "Change Role" (underline text)
- Used by both QuickInviteForm and BulkInviteDialog as a shared preview component

**QuickInviteForm** (`frontend-dashboard/src/components/teams/QuickInviteForm.tsx`):
- Compact horizontal form: email input + role select dropdown + Invite button
- Role select limited to invitable roles: manager, ward_councillor, field_worker
- On role select → shows RoleAssignPreview below form (slide-down appearance)
- Invite button disabled until email is valid AND role is confirmed
- On submit: calls `createInvitation({ email, role, team_id })` then calls `onInvited()` to refresh
- Success toast: green tinted div that auto-fades after 3.5s
- Inline error display below form

**BulkInviteDialog** (`frontend-dashboard/src/components/teams/BulkInviteDialog.tsx`):
- Glassmorphic modal at z-index 1100 (above TeamDetailModal at 1000)
- Textarea for multi-line emails with live count ("3 valid emails detected")
- Email parsing: splits by newline, trims, deduplicates, validates against regex
- Role selector + RoleAssignPreview shared component
- "Send N Invitations" button (shows count of valid emails)
- On submit: calls `createBulkInvitations({ invitations: [...] })` then closes dialog
- Body scroll lock, Escape key to close

### Task 2: PermissionMatrix + MembersTab + TeamDetailModal integration

**PermissionMatrix** (`frontend-dashboard/src/components/teams/PermissionMatrix.tsx`):
- CSS grid layout: 200px capability column + 6 role columns (1fr each)
- Header row with role labels; alternating row tints (pink rgba at 0.03 opacity)
- Teal checkmarks (✓) for granted permissions, muted dash (–) for absent ones
- `editableLabels=true` prop (admin-only) turns role header cells into text inputs
- Horizontally scrollable wrapper (`overflow-x: auto`) for small screens
- Footer note: "Permissions are enforced by the database and API"
- Glassmorphic background matching dashboard design system

**MembersTab updates** (`frontend-dashboard/src/components/teams/MembersTab.tsx`):
- Invite area at top: always-visible QuickInviteForm + "Bulk Invite" button
- "View Permissions" toggle button shows/hides PermissionMatrix below the member list
- Custom `ConfirmDialog` component for remove member action (not `window.confirm`)
- "Deactivate Account" button in member row actions (visible only when `currentUserRole === 'admin'`)
- Separate deactivate confirmation dialog with red button and severity warning message
- `handleInvited` callback calls `loadMembers()` to refresh list after any invite

**TeamDetailModal updates** (`frontend-dashboard/src/components/teams/TeamDetailModal.tsx`):
- New `currentUserRole` prop (default 'manager') forwarded to MembersTab
- `membersRefreshKey` state increments on invitation to trigger MembersTab re-mount
- z-index comment documents 1000/1100/1200 layering scheme
- InvitationsTab kept with `teamId` prop only (no changes to its interface)

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Removed invalid `onInvited` prop from InvitationsTab**
- **Found during:** Task 2 TypeScript check
- **Issue:** Plan specified passing `onInvited` to InvitationsTab, but InvitationsTab's interface only accepts `teamId`
- **Fix:** Removed `onInvited` from InvitationsTab usage in TeamDetailModal — invitations refresh independently
- **Files modified:** `frontend-dashboard/src/components/teams/TeamDetailModal.tsx`

## Verification Results

1. QuickInviteForm sends invitation with role preview confirmation step — **PASS**
2. BulkInviteDialog parses multi-line emails and sends batch — **PASS**
3. RoleAssignPreview shows capability list for selected role — **PASS**
4. PermissionMatrix renders 6 roles x 8 capabilities grid — **PASS**
5. Remove member has confirmation dialog — **PASS** (custom ConfirmDialog)
6. Deactivate account option visible only to admin users — **PASS** (`isAdmin` guard)
7. All components use inline styles + design tokens — **PASS**

TypeScript compilation: zero errors (`npx tsc --noEmit` = clean)

## Self-Check: PASSED

Files created/modified:
- FOUND: frontend-dashboard/src/components/teams/QuickInviteForm.tsx
- FOUND: frontend-dashboard/src/components/teams/BulkInviteDialog.tsx
- FOUND: frontend-dashboard/src/components/teams/RoleAssignPreview.tsx
- FOUND: frontend-dashboard/src/components/teams/PermissionMatrix.tsx
- FOUND: frontend-dashboard/src/components/teams/MembersTab.tsx (modified)
- FOUND: frontend-dashboard/src/components/teams/TeamDetailModal.tsx (modified)

Commits:
- FOUND: 0534df5 (Task 1 — QuickInviteForm, BulkInviteDialog, RoleAssignPreview)
- FOUND: df20e15 (Task 2 — PermissionMatrix, MembersTab, TeamDetailModal)
