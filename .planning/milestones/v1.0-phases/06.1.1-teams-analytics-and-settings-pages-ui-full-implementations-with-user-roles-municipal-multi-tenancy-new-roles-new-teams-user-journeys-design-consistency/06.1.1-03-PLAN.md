---
phase: 06.1.1-teams-analytics-settings
plan: 03
type: execute
wave: 2
depends_on: ["06.1.1-01", "06.1.1-02"]
files_modified:
  - frontend-dashboard/src/pages/TeamsPage.tsx
  - frontend-dashboard/src/components/teams/TeamCard.tsx
  - frontend-dashboard/src/components/teams/TeamCreateCard.tsx
  - frontend-dashboard/src/components/teams/TeamDetailModal.tsx
  - frontend-dashboard/src/components/teams/MembersTab.tsx
  - frontend-dashboard/src/components/teams/InvitationsTab.tsx
  - frontend-dashboard/src/components/teams/ActivityTab.tsx
  - frontend-dashboard/src/hooks/useTeams.ts
autonomous: true
requirements:
  - OPS-01
  - SEC-04

must_haves:
  truths:
    - "Teams page shows a grid of team cards with name, category badge, member count, manager, ticket count"
    - "Clicking a team card opens a modal with tabbed Members/Invitations/Activity views"
    - "Plus card in grid expands to inline team creation form"
    - "Team cards use AnimatedCard + GlassCard wrapper matching MetricsCards pattern"
    - "Loading state shows skeleton placeholders in grid layout"
  artifacts:
    - path: "frontend-dashboard/src/pages/TeamsPage.tsx"
      provides: "Teams page component with grid layout"
      contains: "TeamsPage"
    - path: "frontend-dashboard/src/components/teams/TeamCard.tsx"
      provides: "Individual team card with category badge and stats"
      contains: "TeamCard"
    - path: "frontend-dashboard/src/components/teams/TeamDetailModal.tsx"
      provides: "Full modal with tabbed layout"
      contains: "TeamDetailModal"
    - path: "frontend-dashboard/src/hooks/useTeams.ts"
      provides: "Teams data fetching and state management hook"
      contains: "useTeams"
  key_links:
    - from: "frontend-dashboard/src/pages/TeamsPage.tsx"
      to: "frontend-dashboard/src/hooks/useTeams.ts"
      via: "useTeams() hook call"
      pattern: "useTeams"
    - from: "frontend-dashboard/src/hooks/useTeams.ts"
      to: "frontend-dashboard/src/services/api.ts"
      via: "fetchTeams API call"
      pattern: "fetchTeams"
---

<objective>
Build the Teams page with card grid, team detail modal, and team creation flow.

Purpose: Replace the "Coming Soon" placeholder for /teams with a fully functional team management page. This is the most complex page in this phase — modal with tabs, inline creation form, and member/invitation display.

Output: TeamsPage component, 6 sub-components, and useTeams hook.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06.1.1-teams-analytics-and-settings-pages-ui-full-implementations-with-user-roles-municipal-multi-tenancy-new-roles-new-teams-user-journeys-design-consistency/06.1.1-02-SUMMARY.md
@frontend-dashboard/src/pages/DashboardPage.tsx
@frontend-dashboard/src/components/dashboard/MetricsCards.tsx
@frontend-dashboard/src/components/onboarding/InviteTeamStep.tsx
@frontend-dashboard/src/hooks/useAuth.ts
@shared/components/ui/GlassCard.tsx
@shared/components/ui/Badge.tsx
@shared/components/ui/Button.tsx
@shared/components/ui/Skeleton.tsx
@shared/design-tokens.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useTeams hook + TeamsPage + TeamCard + TeamCreateCard</name>
  <files>
    frontend-dashboard/src/hooks/useTeams.ts
    frontend-dashboard/src/pages/TeamsPage.tsx
    frontend-dashboard/src/components/teams/TeamCard.tsx
    frontend-dashboard/src/components/teams/TeamCreateCard.tsx
  </files>
  <action>
1. Create `frontend-dashboard/src/hooks/useTeams.ts`:
   - State: teams (Team[]), isLoading (boolean), error (string | null), selectedTeam (Team | null)
   - On mount, call fetchTeams() from api.ts, populate teams state
   - Expose: teams, isLoading, error, selectedTeam, setSelectedTeam, refreshTeams
   - Add createTeam function: calls createTeam API, appends to local teams, returns new team
   - Add updateTeam function: calls updateTeam API, updates local state
   - Do NOT use Zustand — local hook state per page (per anti-pattern guidance: "Don't pollute the existing dashboard store")

2. Create `frontend-dashboard/src/components/teams/TeamCard.tsx`:
   Per locked decision: "Card shows: team name, category badge (icon + colored pill), member count, manager name, active ticket count"

   Props: team: Team, index: number, onClick: () => void

   Structure:
   - Wrap in AnimatedCard with glowColor based on category color, delay={index * 0.05}
   - Inside: GlassCard variant="interactive" with onClick handler
   - Top section: Team name (h3, font-weight 600) + category badge (colored pill with icon character + label from CATEGORY_CONFIG)
   - Middle section: Manager name (or "No manager" in muted text)
   - Bottom section: Two stat items side by side — member count (people icon + number) and active tickets (ticket icon + number)
   - Use inline styles matching DashboardPage pattern (no CSS files, use design tokens)
   - Category badge uses bgColor from CATEGORY_CONFIG with color text

3. Create `frontend-dashboard/src/components/teams/TeamCreateCard.tsx`:
   Per locked decision: "Create team via inline '+' card in the grid — expands into a creation form"

   Props: onCreated: (team: Team) => void

   State: isExpanded (boolean), form: { name, category, manager_id }

   When collapsed:
   - GlassCard variant="interactive" with dashed border (border: 2px dashed var(--glass-border))
   - Centered "+" icon (large, 48px) with "Create Team" text below
   - onClick toggles isExpanded

   When expanded:
   - GlassCard with form inside: team name Input, category dropdown (select element styled with design tokens), service area text input, assign manager dropdown (placeholder — initially empty, managers loaded later)
   - Submit button (Button component, variant="secondary") and Cancel link
   - On submit: call createTeam from useTeams, collapse form, call onCreated
   - Category dropdown populated from CATEGORY_CONFIG entries
   - Use single form state object (not multiple useState) per anti-pattern guidance

4. Create `frontend-dashboard/src/pages/TeamsPage.tsx`:
   Per locked decision: "Card grid layout — each team rendered as a GlassCard"

   Structure matching DashboardPage layout:
   - Container div: maxWidth 1400px, margin 0 auto, padding 2rem
   - Header: h1 "Teams" (left) + optional action buttons area (right)
   - Grid: display grid, gridTemplateColumns repeat(auto-fill, minmax(300px, 1fr)), gap var(--space-lg)
   - First item in grid: TeamCreateCard (always present at start)
   - Remaining items: TeamCard for each team, with onClick setting selectedTeam

   Loading state: SkeletonTheme with 6 GlassCard placeholders (Skeleton height/width patterns matching MetricsCards skeleton)
   Empty state (no teams after load): Styled message "No teams yet. Create your first team to get started." with arrow pointing at create card.
   Error state: Red-tinted GlassCard with error message and retry button.

   When selectedTeam is set: render TeamDetailModal (created in Task 2)
  </action>
  <verify>
    Run `cd frontend-dashboard && npx tsc --noEmit src/pages/TeamsPage.tsx 2>&1 | head -10` — should compile.
    Run `cd frontend-dashboard && npx tsc --noEmit src/components/teams/TeamCard.tsx 2>&1 | head -10` — should compile.
  </verify>
  <done>TeamsPage renders card grid with team cards and inline creation form. useTeams hook manages data fetching and state.</done>
</task>

<task type="auto">
  <name>Task 2: Create TeamDetailModal with tabbed layout (Members, Invitations, Activity)</name>
  <files>
    frontend-dashboard/src/components/teams/TeamDetailModal.tsx
    frontend-dashboard/src/components/teams/MembersTab.tsx
    frontend-dashboard/src/components/teams/InvitationsTab.tsx
    frontend-dashboard/src/components/teams/ActivityTab.tsx
  </files>
  <action>
1. Create `frontend-dashboard/src/components/teams/TeamDetailModal.tsx`:
   Per locked decision: "Clicking a team card opens a full detail MODAL" and "Modal has tabbed layout: Members | Pending Invitations | Activity"

   Props: team: Team, onClose: () => void

   Structure:
   - Overlay: fixed inset 0, background rgba(0,0,0,0.5), backdropFilter blur(4px), zIndex 1000, flex center
   - Modal container: glassmorphic styling per research Pattern 5 (glass-pink-frost, blur medium, border glass-border, radius xl, maxWidth 720px, maxHeight 85vh, overflowY auto)
   - Click overlay to close, stopPropagation on modal content
   - Add body scroll lock: useEffect sets document.body.style.overflow = 'hidden', restores on cleanup (per Pitfall 2)

   Header section:
   - Team name (h2) + category badge (colored pill)
   - Close button (X icon, top right)
   - Manager name + member count + ticket count displayed as metadata row

   Tab bar:
   - 3 tabs: Members | Pending Invitations | Activity
   - State: activeTab ('members' | 'invitations' | 'activity'), default 'members'
   - Tab styling: bottom border highlight (2px solid var(--color-teal) for active, transparent for inactive), text color var(--text-primary) active vs var(--text-muted) inactive
   - Background transparent, cursor pointer, font-family var(--font-body)

   Tab content:
   - Render MembersTab, InvitationsTab, or ActivityTab based on activeTab
   - Pass team.id to each tab component

2. Create `frontend-dashboard/src/components/teams/MembersTab.tsx`:
   Props: teamId: string

   - Fetch members on mount using fetchTeamMembers(teamId) from api.ts
   - Display as a list with each member showing: avatar placeholder (circle with initials), full_name, email, role badge (Badge component), joined_at (formatDistanceToNow from date-fns)
   - Each member row has a "Remove" button (red text, confirmation dialog before calling removeTeamMember API)
   - Role badge uses Badge component with variant based on role string
   - Loading: Skeleton rows
   - Empty: "No team members yet. Send invitations to add members."

3. Create `frontend-dashboard/src/components/teams/InvitationsTab.tsx`:
   Per locked decision: "Pending Invitations tab shows sent invitations with status and resend/cancel actions"

   Props: teamId: string

   - Fetch invitations on mount using fetchTeamInvitations(teamId) from api.ts
   - Display each invitation: email, role, status badge (pending=amber, accepted=green, expired=red), created_at, expires_at
   - Actions per invitation:
     - Pending: "Resend" button (re-creates invitation) + "Cancel" button (calls DELETE /invitations/{id})
     - Accepted: no actions (just display)
     - Expired: "Resend" button only
   - Loading: Skeleton rows
   - Empty: "No invitations sent for this team yet."

4. Create `frontend-dashboard/src/components/teams/ActivityTab.tsx`:
   Props: teamId: string

   - This is a placeholder/minimal implementation (no dedicated backend endpoint for team activity)
   - Display a timeline-style list showing recent team events (derived from team member joined_at dates and invitation created_at dates)
   - If no data available: "Team activity will appear here as members join and tickets are assigned."
   - Style as vertical timeline with dots and connecting line (pure CSS, no library)
   - This tab is informational only — no actions needed
  </action>
  <verify>
    Run `cd frontend-dashboard && npx tsc --noEmit src/components/teams/TeamDetailModal.tsx 2>&1 | head -10` — should compile.
  </verify>
  <done>TeamDetailModal opens as glassmorphic modal overlay with 3 functional tabs. Members tab shows team members with remove action. Invitations tab shows pending invitations with resend/cancel. Activity tab shows timeline.</done>
</task>

</tasks>

<verification>
1. TeamsPage renders grid with TeamCreateCard + TeamCards
2. Clicking TeamCard opens TeamDetailModal
3. TeamDetailModal has 3 tabs, switching between them works
4. MembersTab fetches and displays team members
5. InvitationsTab fetches and displays team invitations
6. TeamCreateCard expands to form and submits new team
7. Body scroll locks when modal is open
8. All components use inline styles + design tokens (no new CSS files)
</verification>

<success_criteria>
- Teams page displays card grid matching MetricsCards visual pattern
- Team creation inline form works (expand, fill, submit, collapse)
- Team detail modal opens with glassmorphic overlay
- 3 tabs render correct content
- Loading skeletons show during data fetch
- Empty states display helpful messages
</success_criteria>

<output>
After completion, create `.planning/phases/06.1.1-teams-analytics-and-settings-pages-ui-full-implementations-with-user-roles-municipal-multi-tenancy-new-roles-new-teams-user-journeys-design-consistency/06.1.1-03-SUMMARY.md`
</output>
