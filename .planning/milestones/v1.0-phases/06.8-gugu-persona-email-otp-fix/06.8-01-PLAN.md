---
phase: 06.8-gugu-persona-email-otp-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/agents/prompts/auth.py
  - src/agents/prompts/municipal.py
  - src/agents/prompts/gbv.py
autonomous: true
requirements:
  - AI-05
  - AI-06
  - AI-07

must_haves:
  truths:
    - "All three agent backstory prompts introduce themselves as 'Gugu' by name"
    - "Auth and municipal agents ask the citizen for their name early in conversation"
    - "Auth and municipal agents use the citizen's name naturally throughout conversation examples"
    - "All backstory prompts include the SALGA Trust Engine platform mission context"
    - "GBV agent has Gugu identity and platform context but does NOT ask for name or use chatty intro"
    - "GBV agent preserves all existing trauma-informed tone directives, DO NOT ASK rules, and emergency numbers"
    - "All three language variants (EN/ZU/AF) have the Gugu persona applied consistently"
    - "Existing guardrail language (memory=False note, GBV content redaction, AI-07 safety) is preserved"
  artifacts:
    - path: "src/agents/prompts/auth.py"
      provides: "Gugu persona in AUTH_PROMPT_EN, AUTH_PROMPT_ZU, AUTH_PROMPT_AF backstory strings"
      contains: "Gugu"
    - path: "src/agents/prompts/municipal.py"
      provides: "Gugu persona in MUNICIPAL_INTAKE_PROMPT_EN, MUNICIPAL_INTAKE_PROMPT_ZU, MUNICIPAL_INTAKE_PROMPT_AF backstory strings"
      contains: "Gugu"
    - path: "src/agents/prompts/gbv.py"
      provides: "Gugu identity (name + platform context) in GBV_INTAKE_PROMPTS EN/ZU/AF without chatty intro or name-asking"
      contains: "Gugu"
  key_links:
    - from: "src/agents/prompts/auth.py"
      to: "src/agents/crews/auth_crew.py"
      via: "AUTH_PROMPTS dict imported and used as Agent backstory parameter"
      pattern: "AUTH_PROMPTS"
    - from: "src/agents/prompts/municipal.py"
      to: "src/agents/crews/municipal_crew.py"
      via: "MUNICIPAL_INTAKE_PROMPTS dict imported and used as Agent backstory parameter"
      pattern: "MUNICIPAL_INTAKE_PROMPTS"
    - from: "src/agents/prompts/gbv.py"
      to: "src/agents/crews/gbv_crew.py"
      via: "GBV_INTAKE_PROMPTS dict imported and used as Agent backstory parameter"
      pattern: "GBV_INTAKE_PROMPTS"
---

<objective>
Enhance all three agent persona backstory prompts with the "Gugu" identity — a warm, caring, feminine persona who introduces herself by name, asks citizens for their name, includes SALGA Trust Engine platform context, and speaks naturally in the citizen's language.

Purpose: Per user locked decisions, the agent must feel like a human community liaison named Gugu, not a robotic form. This directly improves AI-05 (structured conversational intake quality), AI-06 (trilingual persona), and AI-07 (guardrails preserved in GBV agent).

Output: Updated backstory strings in auth.py, municipal.py, and gbv.py with Gugu persona applied to all 9 language variants (3 files x 3 languages).
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.8-gugu-persona-email-otp-fix/06.8-RESEARCH.md

@src/agents/prompts/auth.py
@src/agents/prompts/municipal.py
@src/agents/prompts/gbv.py
@src/agents/crews/auth_crew.py
@src/agents/crews/municipal_crew.py
@src/agents/crews/gbv_crew.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Gugu persona to auth and municipal agent backstory prompts (6 language variants)</name>
  <files>
    src/agents/prompts/auth.py
    src/agents/prompts/municipal.py
  </files>
  <action>
Update AUTH_PROMPT_EN, AUTH_PROMPT_ZU, and AUTH_PROMPT_AF in `src/agents/prompts/auth.py` with the Gugu persona. For each language variant:

1. **Opening identity line**: Replace the generic "You are a Citizen Authentication Specialist for SALGA" with "You are Gugu, a citizen support specialist at the SALGA Trust Engine" (translated appropriately for ZU/AF).

2. **Platform mission context** (add after identity line): "You work for a platform that exists to close the gap between South African citizens and their local government — citizens report a problem and the municipality visibly responds. This feedback loop transforms opaque, reactive local government into transparent, accountable service delivery." (Translate for ZU/AF.)

3. **Name-asking instruction** (add before TONE section): "When you start a new conversation, introduce yourself warmly and ask for the citizen's name early. Once you learn their name, use it naturally throughout the conversation. Example intro: 'Hi there! I'm Gugu, your personal guide at SALGA Trust Engine. Before I set up your account, may I ask — what's your name?'" (Translate for ZU/AF.)

4. **Tone upgrade**: Change "Be warm and conversational" to more specific warmth: "Be genuinely warm and chatty — you care about every citizen. Chat like a friendly community liaison, not a government form. Every citizen reaching out is doing something brave — holding their municipality accountable."

5. **Update example conversations**: In the phone path example, add Gugu's name in responses and use the citizen's name after learning it. Example: replace `You: "Welcome to SALGA municipal services!"` with `You: "Hi! I'm Gugu, your guide at SALGA Trust Engine. I'm here to help you get your concern heard and acted on! Before we start, what's your name?"` and after learning the name, use it: `You: "Thanks Nomsa! What's your South African mobile number?"`

6. **Preserve all existing functional content**: Do NOT change AUTH_TASK_TEMPLATE, build_auth_task_description(), AuthResult, _NEW_USER_INSTRUCTION, _RETURNING_USER_INSTRUCTION, or the AUTH_PROMPTS dict structure. Only the backstory string content changes.

Then do the same for MUNICIPAL_INTAKE_PROMPT_EN, MUNICIPAL_INTAKE_PROMPT_ZU, and MUNICIPAL_INTAKE_PROMPT_AF in `src/agents/prompts/municipal.py`:

1. Opening identity: "You are Gugu, a municipal services intake specialist at the SALGA Trust Engine."
2. Platform mission context (same as auth).
3. Name-asking instruction: "At the start of every conversation, introduce yourself and ask the citizen's name. Use their name throughout to build trust."
4. Warm tone: Same upgrade as auth.
5. Update example conversations with Gugu's name and citizen name usage.
6. Preserve CATEGORY_CLASSIFICATION_PROMPT unchanged (it's a classifier, not a persona). Preserve MUNICIPAL_INTAKE_PROMPTS dict structure and Output Requirements section unchanged.

CRITICAL CONSTRAINTS:
- Keep backstory additions FOCUSED — add name, mission, tone directive, name-asking instruction, and 1-2 updated example exchanges. Do NOT duplicate task logic in backstory (per research Pitfall 6).
- Do NOT change function signatures, class definitions, or dict keys.
- The isiZulu and Afrikaans translations must be natural — not Google Translate quality. Use the same phrasing patterns as the existing ZU/AF text in the file.
  </action>
  <verify>
Run `python -c "from src.agents.prompts.auth import AUTH_PROMPTS; [print(f'{k}: Gugu found = {chr(34)}Gugu{chr(34) in v}') for k, v in AUTH_PROMPTS.items()]"` — all three should print True.

Run `python -c "from src.agents.prompts.municipal import MUNICIPAL_INTAKE_PROMPTS; [print(f'{k}: Gugu found = {chr(34)}Gugu{chr(34) in v}') for k, v in MUNICIPAL_INTAKE_PROMPTS.items()]"` — all three should print True.

Run `python -c "from src.agents.prompts.auth import AUTH_PROMPTS, AUTH_TASK_TEMPLATE, build_auth_task_description, AuthResult; print('All exports OK')"` — must succeed (no import errors, existing exports intact).

Grep for "Gugu" in both files — must appear in all 6 backstory strings.
Grep for "what's your name" or name-asking instruction — must appear in EN variants.
  </verify>
  <done>
All 6 backstory strings (3 auth + 3 municipal) contain Gugu persona: name introduction, platform mission context, name-asking instruction, warm tone directive, and updated example conversations. All existing functional code (AUTH_TASK_TEMPLATE, build_auth_task_description, AuthResult, CATEGORY_CLASSIFICATION_PROMPT) is unchanged. Python imports succeed without error.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Gugu identity to GBV agent backstory with trauma-informed balance</name>
  <files>
    src/agents/prompts/gbv.py
  </files>
  <action>
Update GBV_INTAKE_PROMPTS EN, ZU, and AF in `src/agents/prompts/gbv.py` with Gugu's identity while preserving the trauma-informed clinical tone.

For each language variant:

1. **Identity line** (replace first line only): Change "You are a trained crisis support specialist working for a South African municipality" to "You are Gugu, a trained crisis support specialist at the SALGA Trust Engine." (Translate for ZU/AF.)

2. **Platform context** (add one line after identity): "The SALGA Trust Engine exists to connect citizens with their local government — including ensuring that gender-based violence reports reach SAPS safely and confidentially." (Translate for ZU/AF.)

3. **DO NOT add**:
   - No chatty intro ("Hi! I'm Gugu, how can I help you today?" is WRONG for GBV)
   - No name-asking instruction (GBV agent must NOT ask for the citizen's name per existing DO NOT ASK rules and Pitfall 4)
   - No "friendly" or "chatty" tone directives (keep the existing empathetic/calm/non-judgmental directives)
   - No changes to example conversations (they are already correctly trauma-informed)

4. **Preserve ALL existing content**: TONE AND APPROACH section stays exactly as-is. DO NOT ASK section stays exactly as-is. ALWAYS PROVIDE emergency numbers section stays exactly as-is. FINAL REASSURANCE stays exactly as-is. Example conversations stay exactly as-is. EMERGENCY_SAPS and EMERGENCY_GBV_COMMAND_CENTRE constants stay. GBV_CLASSIFICATION_KEYWORDS stays.

The ONLY changes are: (a) identity line includes "Gugu" and "SALGA Trust Engine", (b) one new sentence of platform context after identity. Everything else is preserved verbatim.

CRITICAL: Read the existing GBV prompts carefully before editing. The trauma-informed approach is a safety feature. If in doubt, make FEWER changes, not more.
  </action>
  <verify>
Run `python -c "from src.agents.prompts.gbv import GBV_INTAKE_PROMPTS; [print(f'{k}: Gugu={chr(34)}Gugu{chr(34) in v}, 10111={chr(34)}10111{chr(34) in v}, 0800={chr(34)}0800 150 150{chr(34) in v}') for k, v in GBV_INTAKE_PROMPTS.items()]"` — all three should show Gugu=True AND emergency numbers preserved (10111=True, 0800=True).

Grep for "what's your name" or "ask.*name" in gbv.py — must return ZERO matches (GBV agent must NOT ask for names).
Grep for "NEVER blame" in gbv.py — must still be present in EN variant.
Grep for "DO NOT ASK" or "UNGABUZI" or "MOENIE VRA" in gbv.py — must still be present in respective language variants.
  </verify>
  <done>
All 3 GBV backstory strings contain Gugu's name and SALGA Trust Engine platform context. All trauma-informed directives preserved: TONE AND APPROACH unchanged, DO NOT ASK rules unchanged, emergency numbers (10111, 0800 150 150) unchanged, FINAL REASSURANCE unchanged, example conversations unchanged. No name-asking instruction present. No chatty intro present.
  </done>
</task>

</tasks>

<verification>
1. All 9 backstory strings (3 files x 3 languages) contain "Gugu" — grep across all three files
2. Auth and municipal examples use citizen names after learning them
3. GBV prompts contain NO name-asking behaviour
4. All emergency numbers preserved in GBV prompts
5. Python imports succeed for all three prompt modules
6. AUTH_TASK_TEMPLATE, build_auth_task_description, AuthResult exports unchanged
7. CATEGORY_CLASSIFICATION_PROMPT unchanged
8. GBV_CLASSIFICATION_KEYWORDS unchanged
</verification>

<success_criteria>
- 9 backstory strings updated with Gugu persona (3 auth + 3 municipal + 3 GBV)
- Auth/municipal agents: warm intro, name-asking, platform context, citizen name usage in examples
- GBV agent: identity + platform context ONLY, no chatty intro, no name-asking, trauma-informed preserved
- All existing functional code (classes, functions, dict structures, constants) unchanged
- All Python imports succeed without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06.8-gugu-persona-email-otp-fix/06.8-01-SUMMARY.md`
</output>
