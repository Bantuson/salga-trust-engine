# Phase 06.4: Dashboard Landing Pages, Public Hero Polish, and Citizen Auth Architecture on Public Portal - Research

**Researched:** 2026-02-13
**Domain:** React authentication context, protected routes, GSAP scroll animations, proof of residence verification, citizen profile UI
**Confidence:** HIGH

## Summary

Phase 06.4 establishes citizen authentication on the public portal (frontend-public), implements the complete citizen reporting workflow (web form + receipt), adds auth-gated boundaries for protected pages (My Reports, Report Issue, Profile), polishes the public landing page with scroll-triggered GSAP animations, and enhances the municipal dashboard login page with product information. This phase builds on the existing Supabase Auth infrastructure from Phase 06.1-02, extending it to citizens while maintaining the premium glassmorphic design language established in Phase 06.3.

**Critical insights:**
- Supabase Auth already implemented in municipal dashboard — citizen auth uses same infrastructure with different user flows
- Protected routes with return URL preservation is standard React Router v7 pattern using `useLocation` state
- GSAP ScrollTrigger with staggered animations is the industry standard for scroll storytelling (used by Apple, Tesla, major brands)
- Proof of residence verification is a regulatory requirement (PLAT-03) but deferred until first report submission (not at signup)
- GBV reporting requires explicit consent dialog with emergency contact information (ethical data collection standard)

**Primary recommendation:** Implement citizen auth as a lightweight extension of the existing municipal dashboard auth system. Reuse the same `useAuth` hook pattern, supabase client configuration, and glassmorphic UI components. Focus on UX differentiation (citizens vs municipal staff) rather than architectural divergence.

<user_constraints>
## User Constraints (from CONTEXT.md)

### Locked Decisions

**Citizen Authentication Flow:**
- Both phone OTP AND email+password options available (citizen chooses)
- Proof of residence NOT required at signup — required before first report submission
- Citizen login/register pages use same premium style as municipal dashboard (skyline background, glassmorphic card, GSAP animations)
- Post-login redirects to the originally intended page (My Reports or Report Issue — whichever triggered the auth gate)
- Auth gate happens once per session — after login, citizen navigates freely between all pages (including public dashboard and home)

**Citizen Reporting Experience:**
- Both web form AND WhatsApp channels available for reporting
- Web report form reuses full ReportForm component (category, description, photos, GPS, address fallback)
- GBV appears as a category in the report form — selecting it shows consent dialog + emergency numbers (10111, 0800 150 150) before proceeding
- Proof of residence verification: inline blocker on first report AND available in profile page with missing indicator
- Post-submit shows full glassmorphic receipt card: tracking number (TKT-...), category, description summary, expected response time, WhatsApp notification opt-in
- Receipt card has two CTAs: "Submit Another Report" and "View My Reports"
- Report form is single scrollable form (not multi-step wizard)
- Report form page uses premium full-page style (skyline background, glassmorphic card containing form)
- "Report Issue" button on public landing page links to /report (auth-gated) — redirects to login if not authenticated, then back to report form

**Auth-gated Boundaries:**
- Protected pages: My Reports, Report Issue, Profile — require citizen login
- Public pages: Landing, Transparency Dashboard, About — always accessible (logged in or not)
- Unauthenticated users hitting protected pages get redirected to citizen login page with return URL
- "My Reports" nav button in existing header serves as the auth entry point — clicking when not logged in triggers login redirect

**Header States (Public Portal):**
- Unauthenticated: existing nav (Home, Dashboard, About, My Reports, Report Issue CTA) — no changes needed
- Authenticated: add user menu dropdown (avatar/name) with: My Reports, Profile, Report Issue, Sign Out
- Existing "My Reports" nav link stays — it's the auth gateway

**Citizen Profile Page:**
- Full profile page showing: name, email/phone, municipality, verification status, uploaded residence docs, edit profile
- Proof of residence verification available here with clear "not verified" indicator if missing
- Profile page is auth-gated (same as My Reports and Report Issue)

**Landing Page Polish (Public Portal):**
- All 5 sections (Hero, Problem, Solution, Features, DashboardCTA) get GSAP scroll-triggered animations
- Full scroll storytelling: each section fades/slides in, staggered entrance for cards and text blocks
- Hero text readability fix: pink/rose semi-transparent overlay on the skyline behind text area
- Hero subtitle and CTA need solid background treatment for visibility against skyline photograph

**Municipal Dashboard Landing:**
- Keep login page as entry point (no separate landing page)
- Enhance existing login page with product info/branding — add description of what the municipal dashboard offers
- "Sign In" and "Request Access" buttons both visible on enhanced login page

### Claude's Discretion

- Exact GSAP animation timing and easing for scroll-triggered sections
- Auth context provider architecture (React context pattern)
- Protected route wrapper implementation
- Profile page layout and form field arrangement
- WhatsApp deep link format on the report channel choice
- Pink/rose overlay opacity level on hero section (balance readability vs skyline visibility)

### Specific Ideas

- "My Reports button already exists in navbar — it should open to auth-gated dashboard that shows reports and profile in top navbar"
- Hero section text "Track service delivery, hold municipalities accountable, and see real results across South Africa" plus "View Municipal Performance" CTA needs solid background — currently not well visible against skyline
- Citizen auth should feel consistent with municipal dashboard premium style but serve a different audience (citizens vs municipal staff)
- After auth, user can still navigate between dashboard and home freely — auth gate is session-based, not page-based

### Deferred Ideas (OUT OF SCOPE)

None — discussion stayed within phase scope

</user_constraints>

## Standard Stack

### Core Authentication & Routing

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| @supabase/supabase-js | 2.48.1+ | Supabase client (auth, database) | Official TypeScript SDK, already in use from Phase 06.1-02, handles session persistence + RLS queries |
| react-router-dom | 7.13.0+ | Client-side routing | Current version in project, v7 includes `useLocation` state for return URLs, loader/action patterns |
| React Context API | Native | Auth state management | Built into React 19.2.0, zero dependencies, sufficient for single-user session state |

**Key insight:** No need for Redux, Zustand, or external state managers for auth. React Context + Supabase's built-in session persistence handles all requirements. The municipal dashboard already uses this pattern successfully.

### UI Components & Animations

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| GSAP | 3.14.2 (current) | Animation engine | Industry standard, used by Apple, Tesla, major brands; ScrollTrigger is THE library for scroll storytelling |
| @gsap/react | 2.1.2 (current) | GSAP React integration | Official React hooks (useGSAP), automatic cleanup via gsap.context(), scope-based selectors |
| Lenis | 1.3.17 (current) | Smooth scroll | Syncs with GSAP ticker, supports mobile touch inertia (syncTouch: true), used in premium web experiences |
| GlassCard (shared) | N/A | Glassmorphism component | Already built in `shared/components/ui/GlassCard.tsx`, reuse for consistency |

**All UI libraries already installed and configured from Phase 06.1-08 and 06.3 — no new dependencies needed.**

### Supporting Libraries

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| react-dropzone | 14.4.0 (current) | File upload UI | Already in dashboard, reuse for citizen proof of residence upload and evidence photos |
| zod-validation-error | Latest | Error message formatting | Convert Supabase/form errors to user-friendly messages |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| React Context | Zustand/Redux | Context sufficient for auth state; Zustand adds 1KB for no benefit in this scope |
| GSAP ScrollTrigger | Framer Motion scroll animations | Framer Motion can't match GSAP's timeline control, scrubbing, or performance at scale |
| Supabase Auth | NextAuth.js/Auth0 | Project already committed to Supabase (Phase 06.1-02); switching adds migration cost with zero technical benefit |
| Protected route HOC | React Router loader | Loaders run before render (better UX), but HOC pattern simpler for this phase scope |

**Installation:**

No new installations required — all dependencies already in `frontend-public/package.json` and `frontend-dashboard/package.json`.

## Architecture Patterns

### Recommended Project Structure

```
frontend-public/src/
├── contexts/
│   └── AuthContext.tsx              # NEW: Citizen auth context provider
├── hooks/
│   ├── useAuth.ts                   # NEW: Reuse pattern from dashboard
│   └── useProtectedRoute.ts         # NEW: Return URL redirect logic
├── components/
│   ├── auth/
│   │   ├── CitizenLoginPage.tsx     # NEW: Email+password + Phone OTP
│   │   ├── CitizenRegisterPage.tsx  # NEW: Signup with both options
│   │   └── ProtectedRoute.tsx       # NEW: Wrapper for auth-gated pages
│   ├── citizen/
│   │   ├── ReportForm.tsx           # NEW: Full report form (reuse dashboard pattern)
│   │   ├── ReportReceipt.tsx        # NEW: Glassmorphic receipt card
│   │   ├── ProofOfResidence.tsx     # NEW: Upload + verification UI
│   │   ├── ProfilePage.tsx          # NEW: Citizen profile dashboard
│   │   └── MyReportsPage.tsx        # NEW: List of user's reports
│   ├── layout/
│   │   └── PublicHeader.tsx         # EDIT: Add authenticated state (user dropdown)
│   └── landing/
│       ├── HeroSection.tsx          # EDIT: Add overlay + scroll animations
│       ├── ProblemSection.tsx       # EDIT: Scroll-triggered entrance
│       ├── SolutionSection.tsx      # EDIT: Scroll-triggered entrance
│       ├── FeaturesSection.tsx      # EDIT: Staggered card animations
│       └── DashboardCTA.tsx         # EDIT: Scroll-triggered entrance
└── pages/
    ├── LandingPage.tsx              # EDIT: Initialize scroll animations
    ├── CitizenLoginPage.tsx         # NEW: Auth entry point
    ├── CitizenRegisterPage.tsx      # NEW: Signup flow
    ├── ReportIssuePage.tsx          # NEW: Auth-gated report form
    ├── MyReportsPage.tsx            # NEW: Auth-gated report list
    └── ProfilePage.tsx              # NEW: Auth-gated profile

frontend-dashboard/src/
└── pages/
    └── LoginPage.tsx                # EDIT: Add product info section
```

### Pattern 1: Protected Route with Return URL

**What:** Redirect unauthenticated users to login, preserving intended destination

**When to use:** Any route requiring authentication (My Reports, Report Issue, Profile)

**Example:**
```typescript
// hooks/useProtectedRoute.ts
import { useEffect } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { useAuth } from './useAuth';

export function useProtectedRoute() {
  const { user, loading } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();

  useEffect(() => {
    if (!loading && !user) {
      // Preserve current location as return URL
      navigate('/login', {
        state: { from: location.pathname + location.search },
        replace: true
      });
    }
  }, [user, loading, navigate, location]);

  return { user, loading };
}

// components/auth/ProtectedRoute.tsx
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';

export function ProtectedRoute({ children }: { children: React.ReactNode }) {
  const { user, loading } = useAuth();
  const location = useLocation();

  if (loading) {
    return <div>Loading...</div>; // Or skeleton component
  }

  if (!user) {
    // Redirect to login with return URL in state
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  return <>{children}</>;
}

// Usage in App.tsx
<Route
  path="/my-reports"
  element={
    <ProtectedRoute>
      <MyReportsPage />
    </ProtectedRoute>
  }
/>
```

**Source:** [React Router 7: Protected Routes](https://www.robinwieruch.de/react-router-private-routes/), [Authentication with React Router v7](https://blog.logrocket.com/authentication-react-router-v7/)

### Pattern 2: Auth Context Provider

**What:** Centralized authentication state using React Context API

**When to use:** Single source of truth for session state across entire app

**Example:**
```typescript
// contexts/AuthContext.tsx
import { createContext, useContext, useEffect, useState } from 'react';
import { supabase } from '../lib/supabase';
import type { User, Session } from '@supabase/supabase-js';

interface AuthContextType {
  user: User | null;
  session: Session | null;
  loading: boolean;
  signInWithEmail: (email: string, password: string) => Promise<void>;
  signInWithPhone: (phone: string) => Promise<void>;
  verifyOtp: (phone: string, token: string) => Promise<void>;
  signOut: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setUser(session?.user ?? null);
      setLoading(false);
    });

    // Listen for auth changes
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        setSession(session);
        setUser(session?.user ?? null);
        setLoading(false);
      }
    );

    return () => subscription.unsubscribe();
  }, []);

  const signInWithEmail = async (email: string, password: string) => {
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) throw error;
  };

  const signInWithPhone = async (phone: string) => {
    const { error } = await supabase.auth.signInWithOtp({ phone });
    if (error) throw error;
  };

  const verifyOtp = async (phone: string, token: string) => {
    const { error } = await supabase.auth.verifyOtp({
      phone,
      token,
      type: 'sms'
    });
    if (error) throw error;
  };

  const signOut = async () => {
    const { error } = await supabase.auth.signOut();
    if (error) throw error;
  };

  return (
    <AuthContext.Provider value={{
      user,
      session,
      loading,
      signInWithEmail,
      signInWithPhone,
      verifyOtp,
      signOut
    }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}
```

**Source:** Reused pattern from `frontend-dashboard/src/hooks/useAuth.ts` (Phase 06.1-02)

### Pattern 3: GSAP Scroll-Triggered Staggered Animations

**What:** Sections fade/slide in as user scrolls, with staggered child element animations

**When to use:** Landing page sections (Hero, Problem, Solution, Features, DashboardCTA)

**Example:**
```typescript
// components/landing/FeaturesSection.tsx
import { useRef } from 'react';
import gsap from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';
import { useGSAP } from '@gsap/react';
import { useReducedMotion } from '@shared/hooks/useReducedMotion';

gsap.registerPlugin(useGSAP, ScrollTrigger);

export function FeaturesSection() {
  const sectionRef = useRef<HTMLDivElement>(null);
  const cardsRef = useRef<HTMLDivElement>(null);
  const reducedMotion = useReducedMotion();

  useGSAP(() => {
    if (reducedMotion) {
      // Skip animations for accessibility
      gsap.set(sectionRef.current, { opacity: 1 });
      return;
    }

    // Section entrance (fade + slide)
    gsap.from(sectionRef.current, {
      opacity: 0,
      y: 80,
      duration: 1,
      ease: 'power3.out',
      scrollTrigger: {
        trigger: sectionRef.current,
        start: 'top 80%', // Start when section is 80% down viewport
        toggleActions: 'play none none reverse',
      },
    });

    // Staggered card entrance
    if (cardsRef.current) {
      gsap.from(cardsRef.current.children, {
        opacity: 0,
        y: 50,
        duration: 0.6,
        stagger: 0.15, // 150ms delay between cards
        ease: 'power2.out',
        scrollTrigger: {
          trigger: cardsRef.current,
          start: 'top 75%',
          toggleActions: 'play none none reverse',
        },
      });
    }
  }, { scope: sectionRef, dependencies: [reducedMotion] });

  return (
    <section ref={sectionRef} className="features-section">
      <h2>Key Features</h2>
      <div ref={cardsRef} className="features-grid">
        <FeatureCard title="Real-time Tracking" />
        <FeatureCard title="Transparent SLA" />
        <FeatureCard title="Geographic Heatmaps" />
      </div>
    </section>
  );
}
```

**Key timing recommendations:**
- Section entrance: `duration: 1s`, `ease: 'power3.out'`
- Stagger delay: `0.1-0.2s` for smooth sequential reveal
- ScrollTrigger start: `'top 70-80%'` (starts animation before fully in viewport)
- Use `toggleActions: 'play none none reverse'` for scroll-up reversal

**Source:** [GSAP ScrollTrigger Documentation](https://gsap.com/docs/v3/Plugins/ScrollTrigger/), [Staggered Animations in ScrollTrigger](https://gsap.com/community/forums/topic/24288-staggered-animations-in-scrolltrigger/)

### Pattern 4: Glassmorphic Receipt Card

**What:** Post-submit confirmation card with tracking number, summary, and CTAs

**When to use:** After successful report submission

**Example:**
```typescript
// components/citizen/ReportReceipt.tsx
import { GlassCard } from '@shared/components/ui/GlassCard';
import { Button } from '@shared/components/ui/Button';

interface ReportReceiptProps {
  trackingNumber: string;
  category: string;
  description: string;
  expectedResponseTime: string;
  onSubmitAnother: () => void;
  onViewReports: () => void;
}

export function ReportReceipt({
  trackingNumber,
  category,
  description,
  expectedResponseTime,
  onSubmitAnother,
  onViewReports,
}: ReportReceiptProps) {
  return (
    <GlassCard variant="elevated" glow="teal" style={{ maxWidth: '600px', margin: '2rem auto' }}>
      <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
        <div style={{ fontSize: '3rem', marginBottom: '0.5rem' }}>✓</div>
        <h2 style={{ color: 'var(--color-teal)', marginBottom: '0.5rem' }}>
          Report Submitted Successfully
        </h2>
        <p style={{ color: 'var(--text-secondary)' }}>
          Your issue has been logged and assigned to the municipality
        </p>
      </div>

      <div style={{ marginBottom: '2rem' }}>
        <div style={styles.infoRow}>
          <span style={styles.label}>Tracking Number:</span>
          <code style={styles.value}>{trackingNumber}</code>
        </div>
        <div style={styles.infoRow}>
          <span style={styles.label}>Category:</span>
          <span style={styles.value}>{category}</span>
        </div>
        <div style={styles.infoRow}>
          <span style={styles.label}>Description:</span>
          <span style={styles.value}>
            {description.length > 100
              ? description.substring(0, 100) + '...'
              : description}
          </span>
        </div>
        <div style={styles.infoRow}>
          <span style={styles.label}>Expected Response:</span>
          <span style={styles.value}>{expectedResponseTime}</span>
        </div>
      </div>

      <div style={{ marginBottom: '2rem', padding: '1rem', backgroundColor: 'var(--surface-elevated)', borderRadius: 'var(--radius-md)' }}>
        <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>
          <input type="checkbox" style={{ marginRight: '0.75rem' }} />
          <span style={{ fontSize: '0.875rem' }}>
            Receive WhatsApp notifications for status updates
          </span>
        </label>
      </div>

      <div style={{ display: 'flex', gap: '1rem' }}>
        <Button
          variant="secondary"
          onClick={onSubmitAnother}
          style={{ flex: 1 }}
        >
          Submit Another Report
        </Button>
        <Button
          variant="primary"
          onClick={onViewReports}
          style={{ flex: 1 }}
        >
          View My Reports
        </Button>
      </div>
    </GlassCard>
  );
}

const styles = {
  infoRow: {
    display: 'flex',
    justifyContent: 'space-between',
    padding: '0.75rem 0',
    borderBottom: '1px solid var(--border-subtle)',
  } as React.CSSProperties,
  label: {
    color: 'var(--text-secondary)',
    fontSize: '0.875rem',
  } as React.CSSProperties,
  value: {
    color: 'var(--text-primary)',
    fontWeight: '500',
    textAlign: 'right',
  } as React.CSSProperties,
};
```

### Pattern 5: GBV Consent Dialog

**What:** Modal overlay with consent information and emergency contacts

**When to use:** When citizen selects "GBV/Abuse" category in report form

**Example:**
```typescript
// components/citizen/GBVConsentDialog.tsx
import { GlassCard } from '@shared/components/ui/GlassCard';

interface GBVConsentDialogProps {
  onAccept: () => void;
  onDecline: () => void;
}

export function GBVConsentDialog({ onAccept, onDecline }: GBVConsentDialogProps) {
  return (
    <div style={styles.overlay}>
      <GlassCard variant="elevated" style={styles.dialog}>
        <h2 style={{ color: 'var(--color-coral)', marginBottom: '1rem' }}>
          GBV Report Consent
        </h2>

        <p style={{ marginBottom: '1rem' }}>
          By submitting a GBV (gender-based violence) report:
        </p>

        <ul style={{ marginBottom: '1.5rem', paddingLeft: '1.5rem' }}>
          <li>Your report will be securely encrypted</li>
          <li>SAPS (South African Police Service) will be notified</li>
          <li>Your information will be handled with strict confidentiality</li>
          <li>Only authorized SAPS liaison officers can access your details</li>
        </ul>

        <div style={styles.emergencyBox}>
          <h3 style={{ marginBottom: '0.5rem', color: 'var(--color-coral)' }}>
            Emergency Contacts
          </h3>
          <p style={{ marginBottom: '0.25rem' }}>
            <strong>Police Emergency:</strong> <a href="tel:10111" style={styles.phoneLink}>10111</a>
          </p>
          <p>
            <strong>GBV Command Centre:</strong> <a href="tel:0800150150" style={styles.phoneLink}>0800 150 150</a>
          </p>
          <p style={{ fontSize: '0.875rem', marginTop: '0.5rem', color: 'var(--text-secondary)' }}>
            If you are in immediate danger, call these numbers now.
          </p>
        </div>

        <div style={{ display: 'flex', gap: '1rem', marginTop: '1.5rem' }}>
          <button onClick={onDecline} style={styles.declineButton}>
            Cancel
          </button>
          <button onClick={onAccept} style={styles.acceptButton}>
            I Understand, Continue
          </button>
        </div>
      </GlassCard>
    </div>
  );
}

const styles = {
  overlay: {
    position: 'fixed' as const,
    inset: 0,
    backgroundColor: 'rgba(0, 0, 0, 0.7)',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    zIndex: 9999,
  },
  dialog: {
    maxWidth: '500px',
    margin: '1rem',
  },
  emergencyBox: {
    padding: '1rem',
    backgroundColor: 'var(--surface-elevated)',
    borderRadius: 'var(--radius-md)',
    border: '1px solid var(--color-coral)',
  },
  phoneLink: {
    color: 'var(--color-teal)',
    textDecoration: 'none',
    fontWeight: 'bold',
  },
  declineButton: {
    flex: 1,
    padding: '0.875rem',
    backgroundColor: 'var(--surface-higher)',
    color: 'var(--text-primary)',
    border: 'none',
    borderRadius: 'var(--radius-sm)',
    cursor: 'pointer',
  },
  acceptButton: {
    flex: 1,
    padding: '0.875rem',
    backgroundColor: 'var(--color-teal)',
    color: 'white',
    border: 'none',
    borderRadius: 'var(--radius-sm)',
    cursor: 'pointer',
    fontWeight: '600',
  },
};
```

**Source:** [GBVIMS Intake and Consent Forms](https://www.gbvims.com/gbvims-tools/intake-form/), [Conduct ethical data collection - Spotlight Initiative](https://www.spotlightinitiative.org/conduct-ethical-data-collection)

### Pattern 6: Proof of Residence Upload & Verification UI

**What:** Drag-and-drop file upload with verification status indicator

**When to use:** First report submission (blocker) and Profile page

**Example:**
```typescript
// components/citizen/ProofOfResidence.tsx
import { useState } from 'react';
import { useDropzone } from 'react-dropzone';
import { GlassCard } from '@shared/components/ui/GlassCard';

interface ProofOfResidenceProps {
  isVerified: boolean;
  documentUrl?: string;
  onUpload: (file: File) => Promise<void>;
}

export function ProofOfResidence({
  isVerified,
  documentUrl,
  onUpload
}: ProofOfResidenceProps) {
  const [uploading, setUploading] = useState(false);

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    accept: {
      'image/*': ['.png', '.jpg', '.jpeg'],
      'application/pdf': ['.pdf'],
    },
    maxFiles: 1,
    onDrop: async (acceptedFiles) => {
      if (acceptedFiles.length > 0) {
        setUploading(true);
        try {
          await onUpload(acceptedFiles[0]);
        } finally {
          setUploading(false);
        }
      }
    },
  });

  return (
    <GlassCard variant="default">
      <h3 style={{ marginBottom: '1rem' }}>Proof of Residence</h3>

      {isVerified ? (
        <div style={styles.verifiedBadge}>
          <span style={{ fontSize: '1.5rem', marginRight: '0.5rem' }}>✓</span>
          <div>
            <strong>Verified</strong>
            <p style={{ fontSize: '0.875rem', color: 'var(--text-secondary)', margin: 0 }}>
              Your residence has been confirmed
            </p>
          </div>
          {documentUrl && (
            <a href={documentUrl} target="_blank" rel="noopener noreferrer" style={styles.viewLink}>
              View Document
            </a>
          )}
        </div>
      ) : (
        <>
          <div style={styles.warningBox}>
            ⚠️ You must upload proof of residence before submitting your first report
          </div>

          <div
            {...getRootProps()}
            style={{
              ...styles.dropzone,
              ...(isDragActive ? styles.dropzoneActive : {}),
            }}
          >
            <input {...getInputProps()} />
            {uploading ? (
              <p>Uploading...</p>
            ) : isDragActive ? (
              <p>Drop document here</p>
            ) : (
              <>
                <p style={{ fontWeight: '600', marginBottom: '0.5rem' }}>
                  Drag & drop proof of residence here
                </p>
                <p style={{ fontSize: '0.875rem', color: 'var(--text-secondary)' }}>
                  or click to browse (PDF, JPG, PNG)
                </p>
              </>
            )}
          </div>

          <p style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.5rem' }}>
            Accepted documents: Utility bill, bank statement, lease agreement (max 90 days old)
          </p>
        </>
      )}
    </GlassCard>
  );
}

const styles = {
  verifiedBadge: {
    display: 'flex',
    alignItems: 'center',
    padding: '1rem',
    backgroundColor: 'var(--surface-elevated)',
    borderRadius: 'var(--radius-md)',
    border: '1px solid var(--color-teal)',
    color: 'var(--color-teal)',
  },
  viewLink: {
    marginLeft: 'auto',
    color: 'var(--color-teal)',
    textDecoration: 'underline',
    fontSize: '0.875rem',
  },
  warningBox: {
    padding: '0.75rem',
    backgroundColor: 'rgba(255, 213, 79, 0.1)',
    border: '1px solid var(--color-accent-gold)',
    borderRadius: 'var(--radius-sm)',
    marginBottom: '1rem',
    fontSize: '0.875rem',
  },
  dropzone: {
    padding: '2rem',
    border: '2px dashed var(--border-subtle)',
    borderRadius: 'var(--radius-md)',
    textAlign: 'center' as const,
    cursor: 'pointer',
    transition: 'var(--transition-base)',
  },
  dropzoneActive: {
    borderColor: 'var(--color-teal)',
    backgroundColor: 'var(--surface-elevated)',
  },
};
```

**Source:** [How to Verify Proof of Address in 2026 - iDenfy](https://www.idenfy.com/blog/proof-of-address-poa/), [OCR Document Verification](https://www.klippa.com/en/blog/information/proof-of-address-verification/)

## Anti-Patterns to Avoid

### Anti-Pattern 1: Multiple Auth State Sources

**Bad:**
```typescript
// DON'T: Separate auth state in components
const [user, setUser] = useState(null);

useEffect(() => {
  supabase.auth.getUser().then(setUser);
}, []);
```

**Good:**
```typescript
// DO: Single AuthContext provider
<AuthProvider>
  <App />
</AuthProvider>

// Components access via hook
const { user } = useAuth();
```

**Why:** Prevents state sync issues, ensures single source of truth, automatic subscription cleanup.

### Anti-Pattern 2: Hardcoded Animation Values

**Bad:**
```typescript
// DON'T: Hardcoded durations without reduced motion check
gsap.from('.hero', { opacity: 0, duration: 1 });
```

**Good:**
```typescript
// DO: Respect prefers-reduced-motion
const reducedMotion = useReducedMotion();

useGSAP(() => {
  if (reducedMotion) {
    gsap.set('.hero', { opacity: 1 });
    return;
  }
  gsap.from('.hero', { opacity: 0, duration: 1 });
}, { dependencies: [reducedMotion] });
```

**Why:** Accessibility requirement (WCAG 2.1), prevents motion sickness for sensitive users.

### Anti-Pattern 3: Client-Side Security Reliance

**Bad:**
```typescript
// DON'T: Hide UI elements for unauthorized users
{user?.role !== 'admin' && <AdminPanel />}
```

**Good:**
```typescript
// DO: Backend enforces access control
// Frontend checks are UX only, backend validates via RLS policies
{user?.role === 'admin' && <AdminPanel />}
// Backend: RLS policy on admin-only tables
```

**Why:** Client-side checks are bypassable; backend RLS policies enforce data security.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Authentication state management | Custom JWT decode + refresh logic | Supabase Auth SDK | Handles token refresh, session persistence, secure storage automatically; 1000s of edge cases tested |
| Protected routes | Custom route guards + redirect logic | React Router v7 Navigate + useLocation | Standard pattern, handles return URLs, integrates with browser history |
| File uploads | Custom multipart form handling | react-dropzone | Drag-and-drop, file validation, preview generation, accessibility built-in |
| Scroll animations | Manual IntersectionObserver + CSS transitions | GSAP ScrollTrigger | Performance-optimized, timeline control, scrubbing, easing library |
| Form validation | Manual field-by-field validation | React Hook Form + Zod | Type-safe schemas, async validation, minimal re-renders |

**Key insight:** The project already uses Supabase Auth (Phase 06.1-02), GSAP (Phase 06.1-08), and react-dropzone (dashboard). Reusing these libraries maintains consistency and avoids reinventing tested solutions.

## Common Pitfalls

### Pitfall 1: Forgetting to Cleanup GSAP Animations

**What goes wrong:** Memory leaks, animations persisting after unmount, duplicate ScrollTriggers

**Why it happens:** GSAP animations and ScrollTriggers need manual cleanup in React

**How to avoid:** Always use `useGSAP` hook with scope, never raw `useEffect`

**Warning signs:** Console errors "ScrollTrigger already exists", animations firing multiple times

**Example:**
```typescript
// BAD: No cleanup
useEffect(() => {
  gsap.from('.card', { opacity: 0 });
}, []);

// GOOD: Automatic cleanup via useGSAP
useGSAP(() => {
  gsap.from('.card', { opacity: 0 });
}, { scope: containerRef });
```

### Pitfall 2: Return URL State Loss on Page Refresh

**What goes wrong:** User logs in, gets redirected to dashboard instead of intended page

**Why it happens:** React Router state doesn't persist across page refreshes

**How to avoid:** Store return URL in sessionStorage as fallback

**Warning signs:** Users complain "I clicked My Reports but ended up on Dashboard after login"

**Example:**
```typescript
// ProtectedRoute.tsx
const location = useLocation();

if (!user) {
  // Store in sessionStorage as backup
  sessionStorage.setItem('returnUrl', location.pathname);
  return <Navigate to="/login" state={{ from: location }} replace />;
}

// LoginPage.tsx - After successful login
const navigate = useNavigate();
const location = useLocation();

const returnUrl =
  location.state?.from?.pathname ||
  sessionStorage.getItem('returnUrl') ||
  '/my-reports';

sessionStorage.removeItem('returnUrl');
navigate(returnUrl, { replace: true });
```

### Pitfall 3: GBV Data Leaking into Public Pages

**What goes wrong:** GBV report details appear in "My Reports" when user is logged out (cached data)

**Why it happens:** Client-side state not cleared on signout, or RLS policies not enforcing data isolation

**How to avoid:** Clear all client-side cache on signout, verify RLS policies exclude GBV from public views

**Warning signs:** Logout doesn't clear report data, test accounts see other users' GBV reports

**Example:**
```typescript
// AuthContext.tsx
const signOut = async () => {
  await supabase.auth.signOut();

  // Clear all client-side cached data
  sessionStorage.clear();
  localStorage.removeItem('supabase.auth.token');

  // Reset state
  setUser(null);
  setSession(null);

  // Force page reload to clear any stale UI state
  window.location.href = '/';
};
```

### Pitfall 4: WhatsApp Opt-in Combined with Other Channels

**What goes wrong:** Single checkbox for "Email + WhatsApp + SMS notifications" violates WhatsApp Business policy

**Why it happens:** Developer tries to simplify UI by combining channel preferences

**How to avoid:** WhatsApp opt-in MUST have its own checkbox with logo/name

**Warning signs:** WhatsApp Business API rejects messages with "opt-in violation" error

**Example:**
```typescript
// BAD: Combined opt-in
<label>
  <input type="checkbox" />
  Receive notifications via Email, SMS, and WhatsApp
</label>

// GOOD: Separate WhatsApp opt-in
<label>
  <input type="checkbox" name="email" />
  Receive email notifications
</label>
<label style={{ display: 'flex', alignItems: 'center' }}>
  <input type="checkbox" name="whatsapp" />
  <img src="/whatsapp-icon.svg" alt="WhatsApp" style={{ width: '20px', marginLeft: '8px' }} />
  Receive WhatsApp notifications
</label>
```

**Source:** [WhatsApp opt-in: Policy requirements - Infobip](https://www.infobip.com/blog/how-to-collect-whatsapp-business-opt-ins)

### Pitfall 5: Proof of Residence Required at Signup

**What goes wrong:** High signup abandonment rate, users can't even create an account

**Why it happens:** Misunderstanding of CONTEXT.md decision ("NOT required at signup")

**How to avoid:** Allow signup with email/phone only, gate report submission on proof of residence

**Warning signs:** Analytics show 80%+ signup abandonment, users complain about lengthy registration

**Decision from CONTEXT.md:** "Proof of residence NOT required at signup — required before first report submission"

## Code Examples

### Example 1: Citizen Login Page (Dual Auth Mode)

```typescript
// pages/CitizenLoginPage.tsx
import { useState } from 'react';
import { useNavigate, useLocation, Link } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import { GlassCard } from '@shared/components/ui/GlassCard';
import gsap from 'gsap';
import { useGSAP } from '@gsap/react';

type AuthMode = 'email' | 'phone' | 'verify-otp';

export function CitizenLoginPage() {
  const { signInWithEmail, signInWithPhone, verifyOtp } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();

  const [mode, setMode] = useState<AuthMode>('email');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Form fields
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [phone, setPhone] = useState('');
  const [otpToken, setOtpToken] = useState('');

  const cardRef = useRef<HTMLDivElement>(null);

  // Entrance animation (reuse municipal dashboard pattern)
  useGSAP(() => {
    gsap.from(cardRef.current, {
      y: 50,
      opacity: 0,
      duration: 0.8,
      ease: 'back.out(1.7)',
    });
  }, { scope: cardRef });

  const handleEmailLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    try {
      await signInWithEmail(email, password);

      // Redirect to return URL or default
      const returnUrl = location.state?.from?.pathname || '/my-reports';
      navigate(returnUrl, { replace: true });
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Login failed');
    } finally {
      setLoading(false);
    }
  };

  const handlePhoneLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    try {
      await signInWithPhone(phone);
      setMode('verify-otp');
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to send OTP');
    } finally {
      setLoading(false);
    }
  };

  const handleVerifyOtp = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    try {
      await verifyOtp(phone, otpToken);

      const returnUrl = location.state?.from?.pathname || '/my-reports';
      navigate(returnUrl, { replace: true });
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Invalid OTP code');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={styles.container}>
      <div className="auth-skyline-bg" />
      <div className="auth-skyline-overlay" />

      <div ref={cardRef}>
        <GlassCard style={styles.card}>
          <div style={styles.header}>
            <h1 style={styles.title}>Citizen Portal</h1>
            <p style={styles.subtitle}>Sign in to track your reports</p>
          </div>

          {error && (
            <div style={styles.errorBox}>{error}</div>
          )}

          {mode === 'email' && (
            <form onSubmit={handleEmailLogin}>
              {/* Email + Password form fields... */}
              <button type="submit" disabled={loading}>
                {loading ? 'Signing in...' : 'Sign In'}
              </button>
              <button type="button" onClick={() => setMode('phone')}>
                Sign in with Phone OTP
              </button>
            </form>
          )}

          {mode === 'phone' && (
            <form onSubmit={handlePhoneLogin}>
              {/* Phone number field... */}
            </form>
          )}

          {mode === 'verify-otp' && (
            <form onSubmit={handleVerifyOtp}>
              {/* OTP verification field... */}
            </form>
          )}

          <div style={styles.footer}>
            <Link to="/register">Don't have an account? Register</Link>
          </div>
        </GlassCard>
      </div>
    </div>
  );
}

const styles = {
  container: {
    minHeight: '100vh',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    position: 'relative' as const,
  },
  card: {
    maxWidth: '440px',
    padding: '3rem 2.5rem',
    zIndex: 2,
  },
  header: {
    textAlign: 'center' as const,
    marginBottom: '2rem',
  },
  title: {
    fontSize: '2rem',
    fontWeight: '700',
    background: 'linear-gradient(135deg, var(--color-rose), var(--color-teal))',
    WebkitBackgroundClip: 'text',
    WebkitTextFillColor: 'transparent',
  },
  subtitle: {
    color: 'var(--text-secondary)',
  },
  errorBox: {
    padding: '0.75rem',
    backgroundColor: 'rgba(239, 68, 68, 0.1)',
    border: '1px solid var(--color-coral)',
    borderRadius: 'var(--radius-sm)',
    color: 'var(--color-coral)',
    marginBottom: '1rem',
  },
  footer: {
    textAlign: 'center' as const,
    marginTop: '1.5rem',
  },
};
```

### Example 2: Hero Section with Readability Overlay

```typescript
// components/landing/HeroSection.tsx (ENHANCED VERSION)
import { useRef } from 'react';
import { Link } from 'react-router-dom';
import gsap from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';
import { useGSAP } from '@gsap/react';
import { Button } from '@shared/components/ui/Button';

gsap.registerPlugin(useGSAP, ScrollTrigger);

export function HeroSection() {
  const sectionRef = useRef<HTMLDivElement>(null);
  const headlineRef = useRef<HTMLHeadingElement>(null);
  const subtitleRef = useRef<HTMLParagraphElement>(null);
  const ctaRef = useRef<HTMLDivElement>(null);

  useGSAP(() => {
    // Entrance animations
    const tl = gsap.timeline();
    tl.from(headlineRef.current, {
      y: 80,
      opacity: 0,
      duration: 1.2,
      ease: 'power3.out'
    })
    .from(subtitleRef.current, {
      y: 40,
      opacity: 0,
      duration: 0.8,
      ease: 'power2.out'
    }, '-=0.5')
    .from(ctaRef.current, {
      y: 30,
      opacity: 0,
      duration: 0.6,
      ease: 'power2.out'
    }, '-=0.3');

    // Parallax skyline fade on scroll
    gsap.to('.skyline-background', {
      opacity: 0,
      ease: 'none',
      scrollTrigger: {
        trigger: sectionRef.current,
        start: 'top top',
        end: 'bottom top',
        scrub: true,
      },
    });
  }, { scope: sectionRef });

  return (
    <section ref={sectionRef} className="hero-section">
      {/* Skyline photograph background */}
      <div className="skyline-background" />

      {/* NEW: Pink/rose semi-transparent overlay for text readability */}
      <div className="hero-text-overlay" />

      <div className="hero-content">
        <h1 ref={headlineRef} className="hero-headline">
          Transparent Municipal Services.<br />
          <span className="text-coral">For Every Citizen.</span>
        </h1>

        {/* NEW: Solid background for subtitle */}
        <div className="hero-subtitle-container">
          <p ref={subtitleRef} className="hero-subtitle">
            Track service delivery, hold municipalities accountable,
            and see real results across South Africa.
          </p>
        </div>

        {/* NEW: Solid background for CTA */}
        <div ref={ctaRef} className="hero-cta-container">
          <Link to="/dashboard">
            <Button variant="primary" size="lg">
              View Municipal Performance
            </Button>
          </Link>
        </div>
      </div>
    </section>
  );
}

// App.css additions
/*
.hero-text-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    rgba(205, 94, 129, 0.35) 0%,
    rgba(163, 72, 102, 0.45) 100%
  );
  z-index: 1;
}

.hero-subtitle-container,
.hero-cta-container {
  background: rgba(205, 94, 129, 0.6);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  padding: 1rem 1.5rem;
  border-radius: var(--radius-md);
  display: inline-block;
  position: relative;
  z-index: 2;
}

.hero-content {
  position: relative;
  z-index: 2;
  text-align: center;
  max-width: 800px;
  margin: 0 auto;
}
*/
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Manual JWT refresh | Supabase Auth SDK auto-refresh | Phase 06.1-02 | Eliminates refresh token logic, secure storage built-in |
| Barba.js page transitions | GSAP + React Router | Phase 06.1-08 | No MPA/SPA conflicts, native React integration |
| Manual proof of residence verification | OCR document analysis | 2026 industry standard | 99%+ accuracy, fraud detection, compliance automation |
| Combined channel opt-ins | Separate WhatsApp checkbox | WhatsApp Business Policy 2025 | Avoids API rejection, meets compliance |
| Proof required at signup | Proof required at first report | UX research 2025+ | Reduces signup friction, maintains compliance |

**Deprecated/outdated:**
- **create-react-app:** Unmaintained since 2023, use Vite instead (already in project)
- **Custom JWT middleware in FastAPI:** Replaced by Supabase Auth + RLS policies (Phase 06.1-02)
- **Manual file upload security:** react-dropzone + Supabase Storage RLS handles validation, virus scanning

## Open Questions

1. **OCR Service Provider for Proof of Residence**
   - What we know: Industry uses Klippa, iDenfy, Koncile for OCR document verification
   - What's unclear: Which service integrates best with Supabase Storage (pricing, API compatibility)
   - Recommendation: Research in sub-phase 06.4-03 when implementing proof of residence upload. Supabase Edge Functions can call external OCR APIs.

2. **WhatsApp Deep Link Format**
   - What we know: WhatsApp supports `https://wa.me/27XXXXXXXXX?text=` deep links
   - What's unclear: Should receipt card include prefilled message template or just open chat?
   - Recommendation: Open clean chat (no prefilled text) to avoid user confusion. Twilio webhook can detect new messages.

3. **Session-Based vs Route-Based Auth Gates**
   - What we know: User decision states "auth gate happens once per session"
   - What's unclear: How to persist "authenticated this session" flag across page refreshes
   - Recommendation: Use Supabase session persistence (localStorage by default). Once logged in, user stays logged in until explicit signout or session expiry.

## Sources

### Primary (HIGH confidence)

- [Supabase Phone Login Documentation](https://supabase.com/docs/guides/auth/phone-login) - Phone OTP implementation
- [Supabase JavaScript Auth Reference](https://supabase.com/docs/reference/javascript/auth-signinwithotp) - Email OTP and phone auth APIs
- [GSAP ScrollTrigger Documentation](https://gsap.com/docs/v3/Plugins/ScrollTrigger/) - Official scroll animation API
- [@gsap/react npm package](https://www.npmjs.com/package/@gsap/react) - useGSAP hook documentation
- [Lenis GitHub Repository](https://github.com/darkroomengineering/lenis) - Smooth scroll configuration
- [React Router 7: Protected Routes](https://www.robinwieruch.de/react-router-private-routes/) - Return URL pattern
- [GBVIMS Intake and Consent Forms](https://www.gbvims.com/gbvims-tools/intake-form/) - GBV data collection ethics

### Secondary (MEDIUM confidence)

- [Authentication with React Router v7 - LogRocket](https://blog.logrocket.com/authentication-react-router-v7/) - Protected route implementations
- [Staggered Animations in ScrollTrigger - GSAP Forums](https://gsap.com/community/forums/topic/24288-staggered-animations-in-scrolltrigger/) - Timing patterns
- [How to Verify Proof of Address in 2026 - iDenfy](https://www.idenfy.com/blog/proof-of-address-poa/) - OCR verification workflows
- [WhatsApp opt-in: Policy requirements - Infobip](https://www.infobip.com/blog/how-to-collect-whatsapp-business-opt-ins) - Dual channel opt-in compliance
- [Conduct ethical data collection - Spotlight Initiative](https://www.spotlightinitiative.org/conduct-ethical-data-collection) - GBV consent guidelines
- [React Form Validation with Formik and Yup (2026 Edition) - TheLinuxCode](https://thelinuxcode.com/react-form-validation-with-formik-and-yup-2026-edition/) - Form validation patterns

### Tertiary (LOW confidence - requires verification)

- [CSS Glassmorphism Examples - Free Frontend](https://freefrontend.com/css-glassmorphism/) - Design inspiration only
- [React Hook Form Documentation](https://react-hook-form.com/) - Form library alternative (not required for this phase)

## Metadata

**Confidence breakdown:**
- Authentication patterns: HIGH - Reusing proven Phase 06.1-02 Supabase Auth implementation
- Protected routes: HIGH - React Router v7 standard pattern with extensive documentation
- GSAP animations: HIGH - Official GSAP docs + existing Phase 06.1-08 implementation
- Proof of residence: MEDIUM - OCR service provider selection deferred to implementation
- GBV consent: HIGH - Based on GBVIMS international standards

**Research date:** 2026-02-13
**Valid until:** 60 days (stable patterns - auth, routing, animations are established React/GSAP standards)

**Next steps for planner:**
1. Break into sub-phases: (1) Auth infrastructure, (2) Protected pages + profile, (3) Report form + receipt, (4) Landing page animations, (5) Municipal dashboard login enhancement
2. Prioritize auth infrastructure first — enables testing all other citizen-facing features
3. Reuse existing components from `shared/` and `frontend-dashboard/` wherever possible
4. Verify RLS policies prevent GBV data leaks in "My Reports" page
5. Test WhatsApp deep links on mobile devices (Android + iOS)
