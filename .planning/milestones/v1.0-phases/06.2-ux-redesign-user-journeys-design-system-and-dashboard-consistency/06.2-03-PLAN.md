---
phase: 06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency
plan: 03
type: execute
wave: 2
depends_on: ["06.2-01"]
files_modified:
  - frontend-dashboard/package.json
  - frontend-dashboard/src/App.tsx
  - frontend-dashboard/src/App.css
  - frontend-dashboard/src/components/layout/Sidebar.tsx
  - frontend-dashboard/src/components/layout/DashboardLayout.tsx
  - frontend-dashboard/src/hooks/useRoleBasedNav.ts
  - frontend-dashboard/src/pages/RegisterPage.tsx
autonomous: true

must_haves:
  truths:
    - "Municipal dashboard has icon-only sidebar that expands on hover to show labels"
    - "Navigation items change based on user role (manager sees all, councillor sees ward view, etc.)"
    - "Register page exists alongside login page for new account creation"
    - "Mobile users get hamburger menu instead of sidebar"
    - "Pages use React Router for navigation instead of hash-based routing"
  artifacts:
    - path: "frontend-dashboard/src/components/layout/Sidebar.tsx"
      provides: "Icon-only sidebar with hover expansion"
      contains: "sidebar.*collapsed.*expanded"
    - path: "frontend-dashboard/src/hooks/useRoleBasedNav.ts"
      provides: "Role-adaptive navigation items hook"
      contains: "useRoleBasedNav"
    - path: "frontend-dashboard/src/components/layout/DashboardLayout.tsx"
      provides: "Layout wrapper with sidebar + main content area"
      contains: "DashboardLayout"
    - path: "frontend-dashboard/src/pages/RegisterPage.tsx"
      provides: "Registration page for new municipal staff accounts"
      contains: "RegisterPage"
  key_links:
    - from: "frontend-dashboard/src/components/layout/Sidebar.tsx"
      to: "frontend-dashboard/src/hooks/useRoleBasedNav.ts"
      via: "nav items from role hook"
      pattern: "useRoleBasedNav"
    - from: "frontend-dashboard/src/App.tsx"
      to: "frontend-dashboard/src/components/layout/DashboardLayout.tsx"
      via: "layout wrapper around authenticated routes"
      pattern: "DashboardLayout"
---

<objective>
Restructure the municipal dashboard with an icon-only sidebar navigation, React Router, role-based adaptive navigation, and proper layout shell. Add a registration page alongside the existing login.

Purpose: The municipal dashboard currently uses hash-based routing with a simple top nav bar. The locked decision requires an icon-only sidebar that expands on hover, with navigation items that adapt based on the user's role (manager, councillor, field worker, SAPS liaison, platform admin). This creates a professional dashboard experience that shows each user only what they need.

Output: Role-adaptive sidebar navigation, React Router setup, DashboardLayout shell, and RegisterPage.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency/06.2-CONTEXT.md
@.planning/phases/06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency/06.2-01-SUMMARY.md
@frontend-dashboard/src/App.tsx
@frontend-dashboard/src/hooks/useAuth.ts
@frontend-dashboard/src/pages/LoginPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create role-based nav hook, sidebar component, and dashboard layout</name>
  <files>
    frontend-dashboard/package.json
    frontend-dashboard/src/hooks/useRoleBasedNav.ts
    frontend-dashboard/src/components/layout/Sidebar.tsx
    frontend-dashboard/src/components/layout/DashboardLayout.tsx
  </files>
  <action>
    **1. Install react-router-dom:**
    ```bash
    cd frontend-dashboard && npm install react-router-dom
    ```

    **2. Create useRoleBasedNav.ts:**
    ```typescript
    import { useMemo } from 'react';

    // Icon type — each nav item has an icon name and component renders the SVG
    interface NavItem {
      label: string;
      path: string;
      icon: string;  // Icon identifier: 'home', 'ticket', 'users', 'chart', 'settings', 'shield', 'building', 'upload'
    }

    type UserRole = 'platform_admin' | 'manager' | 'admin' | 'ward_councillor' | 'field_worker' | 'saps_liaison' | 'citizen';

    export function useRoleBasedNav(role: UserRole | string): NavItem[] {
      return useMemo(() => {
        const base: NavItem[] = [
          { label: 'Dashboard', path: '/', icon: 'home' },
        ];

        switch (role) {
          case 'platform_admin':
            return [...base,
              { label: 'Municipalities', path: '/municipalities', icon: 'building' },
              { label: 'Tickets', path: '/tickets', icon: 'ticket' },
              { label: 'Analytics', path: '/analytics', icon: 'chart' },
              { label: 'System', path: '/system', icon: 'settings' },
            ];
          case 'manager':
          case 'admin':
            return [...base,
              { label: 'Tickets', path: '/tickets', icon: 'ticket' },
              { label: 'Teams', path: '/teams', icon: 'users' },
              { label: 'Analytics', path: '/analytics', icon: 'chart' },
              { label: 'Settings', path: '/settings', icon: 'settings' },
            ];
          case 'ward_councillor':
            return [...base,
              { label: 'My Ward Tickets', path: '/tickets', icon: 'ticket' },
              { label: 'Ward Analytics', path: '/analytics', icon: 'chart' },
            ];
          case 'field_worker':
            return [
              { label: 'My Tickets', path: '/', icon: 'ticket' },
              { label: 'Submit Report', path: '/report', icon: 'upload' },
            ];
          case 'saps_liaison':
            return [
              { label: 'GBV Cases', path: '/', icon: 'shield' },
              { label: 'Reports', path: '/reports', icon: 'chart' },
            ];
          default:
            return base;
        }
      }, [role]);
    }
    ```

    **3. Create Sidebar.tsx:**
    - Icon-only sidebar by default, ~64px wide
    - Hover expands to show labels, ~240px wide
    - Smooth width transition (0.3s ease)
    - Fixed position on left side, full height
    - Background: var(--color-navy-light) with subtle right border
    - Each nav item:
      - SVG icon (render inline SVGs for home, ticket, users, chart, settings, shield, building, upload)
      - Icon size: 20x20px, color: var(--text-secondary)
      - Label: hidden when collapsed, visible when expanded, color: var(--text-secondary)
      - Active state: icon + label turn white, left border accent (3px coral)
      - Hover: icon brightens, subtle background highlight
    - Bottom section: user profile area
      - Collapsed: circular avatar placeholder (initials or icon)
      - Expanded: name, role badge (using shared Badge component), logout button
    - Mobile (< 768px):
      - Sidebar hidden by default
      - Hamburger button in top-left corner
      - Click hamburger: sidebar slides in as overlay with glassmorphism backdrop
      - Click outside or X button: slides out
    - Use `useRoleBasedNav` hook to get nav items
    - Use React Router `NavLink` for active state detection
    - Use `useReducedMotion` from shared hooks — skip transitions if reduced motion preferred

    **4. Create DashboardLayout.tsx:**
    - Layout wrapper that positions sidebar + main content
    - Structure:
      ```
      ┌──────────────────────────────────────┐
      │ Sidebar │       Main Content          │
      │  (64px) │       (flex: 1)             │
      │         │                             │
      │  Icons  │  [Page Header]              │
      │         │  [Page Content]             │
      │         │                             │
      │  User   │                             │
      └──────────────────────────────────────┘
      ```
    - Sidebar is fixed position
    - Main content has `margin-left: 64px` (expands to 240px on sidebar hover — NO, keep main content static at 64px margin, sidebar overlays when expanded)
    - Main content area has padding from design tokens
    - Props: `children: React.ReactNode`
    - Receives user info from context to pass to Sidebar
  </action>
  <verify>
    - `ls frontend-dashboard/src/hooks/useRoleBasedNav.ts frontend-dashboard/src/components/layout/Sidebar.tsx frontend-dashboard/src/components/layout/DashboardLayout.tsx` — all exist
    - `grep "react-router-dom" frontend-dashboard/package.json` — dependency installed
    - `grep "useRoleBasedNav" frontend-dashboard/src/components/layout/Sidebar.tsx` — sidebar uses role hook
    - `grep "NavLink" frontend-dashboard/src/components/layout/Sidebar.tsx` — uses React Router NavLink
    - `grep "64px\|sidebar" frontend-dashboard/src/components/layout/DashboardLayout.tsx` — layout accounts for sidebar width
  </verify>
  <done>
    Role-based navigation hook returns correct nav items per role. Sidebar is icon-only (64px) with hover expand to labels (240px). DashboardLayout positions sidebar + content. Mobile hamburger menu with slide-in overlay.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate to React Router, create RegisterPage, integrate new layout</name>
  <files>
    frontend-dashboard/src/App.tsx
    frontend-dashboard/src/App.css
    frontend-dashboard/src/pages/RegisterPage.tsx
    frontend-dashboard/src/pages/LoginPage.tsx
  </files>
  <action>
    **1. Create RegisterPage.tsx:**
    - Styled consistently with existing LoginPage (glassmorphism card, gradient bg, 3D globe)
    - Registration form fields:
      - Email address (required)
      - Password (required, min 8 chars)
      - Confirm password
      - Full name
    - Submit calls Supabase Auth `signUp()` with email + password
    - Success message: "Account created! Please check your email to verify."
    - Link at bottom: "Already have an account? [Sign In]" → links to /login
    - Use shared Button component for submit
    - Use shared Input component for form fields
    - Use shared GlassCard for the form container
    - Use shared AnimatedGradientBg for background (replaces GradientMeshBg)
    - Keep the decorative 3D globe from LoginPage (lazy-loaded)

    **2. Update LoginPage.tsx:**
    - Add link at bottom: "Don't have an account? [Register]" → links to /register
    - Replace GradientMeshBg with shared AnimatedGradientBg component
    - Keep all existing Supabase Auth functionality (email, phone OTP, verify OTP)
    - Use React Router `Link` for navigation between login/register

    **3. Restructure App.tsx with React Router:**
    - Replace hash-based routing with `BrowserRouter` + `Routes`
    - Route structure:
      - `/login` → LoginPage (unauthenticated only)
      - `/register` → RegisterPage (unauthenticated only)
      - `/` → DashboardPage (authenticated, inside DashboardLayout)
      - `/tickets` → TicketListPage (authenticated, inside DashboardLayout)
      - `/report` → ReportForm (authenticated, inside DashboardLayout)
      - `*` → redirect to `/` or `/login` based on auth state
    - Auth guard: if not authenticated, redirect to `/login`
    - If authenticated, wrap pages in `DashboardLayout` (which includes Sidebar)
    - Remove the old top navigation bar (replaced by sidebar)
    - Keep LenisProvider wrapping everything
    - Remove old inline `styles` object — move remaining styles to App.css
    - Keep PageTransition component for route changes (trigger on location change instead of hash)

    **4. Update App.css:**
    - Remove old top nav styles (replaced by sidebar)
    - Add sidebar-aware layout styles
    - Keep dark mode theme, card styles, table styles, button styles
    - Add register page styles (matching login page aesthetic)
    - Ensure AnimatedGradientBg styles work for both login and register pages

    **Build verification:**
    Run `cd frontend-dashboard && npm run build` to verify everything compiles.
  </action>
  <verify>
    - `ls frontend-dashboard/src/pages/RegisterPage.tsx` — register page exists
    - `grep "BrowserRouter\|Routes\|Route" frontend-dashboard/src/App.tsx` — React Router configured
    - `grep "DashboardLayout" frontend-dashboard/src/App.tsx` — layout wrapper used
    - `grep "signUp" frontend-dashboard/src/pages/RegisterPage.tsx` — registration calls Supabase
    - `grep "Link.*register\|Link.*login" frontend-dashboard/src/pages/LoginPage.tsx` — cross-links exist
    - `cd frontend-dashboard && npm run build` — builds successfully
  </verify>
  <done>
    Municipal dashboard migrated to React Router with authenticated route guard. DashboardLayout with icon sidebar replaces top nav. RegisterPage created with matching glassmorphism aesthetic. Login and register pages cross-linked. Build passes.
  </done>
</task>

</tasks>

<verification>
1. Municipal dashboard uses React Router (not hash routing)
2. Icon-only sidebar (64px) expands on hover (240px)
3. Navigation items adapt based on user role
4. Login and Register pages are separate routes with cross-links
5. Authenticated pages wrapped in DashboardLayout with sidebar
6. Mobile hamburger menu for sidebar
7. `npm run build` succeeds
</verification>

<success_criteria>
- Manager sees: Dashboard, Tickets, Teams, Analytics, Settings
- Ward Councillor sees: Dashboard, My Ward Tickets, Ward Analytics
- Field Worker sees: My Tickets, Submit Report
- SAPS Liaison sees: GBV Cases, Reports
- Sidebar is icon-only by default, labels appear on hover
- Login/Register toggle seamlessly
</success_criteria>

<output>
After completion, create `.planning/phases/06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency/06.2-03-SUMMARY.md`
</output>
