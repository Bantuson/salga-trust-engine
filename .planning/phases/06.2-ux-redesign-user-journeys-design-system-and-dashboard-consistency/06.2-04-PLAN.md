---
phase: 06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency
plan: 04
type: execute
wave: 3
depends_on: ["06.2-01", "06.2-02"]
files_modified:
  - frontend-public/src/components/Globe3D.tsx
  - frontend-public/src/components/landing/HeroSection.tsx
  - frontend-public/src/components/landing/ProblemSection.tsx
  - frontend-public/src/components/landing/SolutionSection.tsx
  - frontend-public/src/components/landing/FeaturesSection.tsx
  - frontend-public/src/components/landing/LiveStatsSection.tsx
  - frontend-public/src/components/landing/MunicipalityShowcase.tsx
  - frontend-public/src/components/landing/DashboardPreview.tsx
  - frontend-public/src/App.css
autonomous: true

must_haves:
  truths:
    - "3D globe uses MeshPhysicalMaterial with metallic/glass appearance (not MeshStandardMaterial)"
    - "Municipality data points glow with particle-like effects using AdditiveBlending"
    - "Globe is an interactive data visualization, not just decoration"
    - "All scroll animations respect prefers-reduced-motion"
    - "Landing page scroll storytelling has cinematic polish with parallax effects"
  artifacts:
    - path: "frontend-public/src/components/Globe3D.tsx"
      provides: "Premium 3D SA globe with upgraded materials and particle effects"
      contains: "MeshPhysicalMaterial"
    - path: "frontend-public/src/components/landing/HeroSection.tsx"
      provides: "Enhanced hero with parallax and improved animation timing"
      contains: "ScrollTrigger"
  key_links:
    - from: "frontend-public/src/components/Globe3D.tsx"
      to: "shared/hooks/useReducedMotion.ts"
      via: "reduced motion check for globe auto-rotation"
      pattern: "useReducedMotion"
    - from: "frontend-public/src/components/landing/HeroSection.tsx"
      to: "frontend-public/src/components/Globe3D.tsx"
      via: "lazy-loaded globe in hero section"
      pattern: "React\\.lazy"
---

<objective>
Upgrade the 3D globe from basic to premium quality (MeshPhysicalMaterial, particle effects, glow) and polish all scroll storytelling animations with improved timing, parallax effects, and prefers-reduced-motion support throughout.

Purpose: The current 3D globe is "too basic/low quality" per user feedback (locked decision). The globe must be an interactive data visualization, not decoration. All animations need to respect WCAG 2.3.3 prefers-reduced-motion.

Output: Premium 3D globe with metallic/glass materials and glowing municipality data points. Polished scroll animations with accessibility compliance.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency/06.2-CONTEXT.md
@.planning/phases/06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency/06.2-RESEARCH.md
@.planning/phases/06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency/06.2-01-SUMMARY.md
@.planning/phases/06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency/06.2-02-SUMMARY.md
@.planning/phases/06.1-postgres-refactor-to-supabase-and-dashboard-separation/06.1-09-SUMMARY.md
@frontend-public/src/components/Globe3D.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade 3D globe to premium quality with MeshPhysicalMaterial and particle effects</name>
  <files>
    frontend-public/src/components/Globe3D.tsx
  </files>
  <action>
    **Upgrade the existing Globe3D.tsx. Keep all mobile performance optimizations from Phase 6.1 (DPR cap, on-demand rendering, mediump shaders, detect-gpu, lazy loading, simplified GeoJSON).**

    **1. Upgrade province materials from MeshStandardMaterial to MeshPhysicalMaterial:**
    ```typescript
    <meshPhysicalMaterial
      color={provinceColor}     // Green/amber/coral based on performance
      metalness={0.7}           // Metallic sheen
      roughness={0.2}           // Glossy finish
      clearcoat={1.0}           // Glass-like top layer
      clearcoatRoughness={0.1}  // Smooth clearcoat
      envMapIntensity={1.5}     // Environment map reflections
      emissive={provinceColor}  // Self-illumination
      emissiveIntensity={0.15}  // Subtle glow
    />
    ```
    Note: MeshPhysicalMaterial is heavier than MeshStandardMaterial. Use `detect-gpu` tier:
    - Tier 0-1 (low-end): Fall back to MeshStandardMaterial with simple properties
    - Tier 2+ (mid/high): Use MeshPhysicalMaterial with full properties

    **2. Add environment map for reflections:**
    - Use `@react-three/drei` Environment component with a `sunset` preset (built-in, no external files)
    - Only load on GPU tier 2+
    ```typescript
    import { Environment } from '@react-three/drei';
    // Inside Canvas:
    {gpuTier >= 2 && <Environment preset="sunset" environmentIntensity={0.3} />}
    ```

    **3. Add glowing municipality data points:**
    - For each province centroid, render a small glowing sphere
    - Use `Points` or individual small `Sphere` meshes at province center coordinates
    - Material: emissive coral (#FF6B4A) with AdditiveBlending for glow effect
    - Size: small (0.03-0.05 units)
    - Animation: gentle pulse (scale 0.8 to 1.2 oscillation using useFrame)
    - Each point represents a municipality location
    - On hover, point scales up and shows province name + performance metric in tooltip
    ```typescript
    <mesh position={[cx, cy, 0.3]}>
      <sphereGeometry args={[0.04, 8, 8]} />
      <meshBasicMaterial
        color="#FF6B4A"
        transparent
        opacity={0.8}
        blending={AdditiveBlending}
      />
    </mesh>
    ```

    **4. Improve lighting setup:**
    - Keep existing ambient + directional lights
    - Add a `PointLight` near the globe surface (coral color, low intensity) for rim lighting effect
    - Add `RectAreaLight` from drei if GPU tier allows — creates soft studio-quality lighting
    ```typescript
    <pointLight position={[3, 0, 2]} color="#FF6B4A" intensity={0.5} distance={10} />
    ```

    **5. Add subtle globe edge glow (atmosphere effect):**
    - Create a slightly larger transparent sphere behind the provinces
    - Material: `MeshBasicMaterial` with teal color, transparent, opacity 0.05
    - Purpose: Creates a soft atmospheric glow around the globe silhouette
    - Only render on GPU tier 2+
    ```typescript
    {gpuTier >= 2 && (
      <mesh>
        <sphereGeometry args={[3, 32, 32]} />
        <meshBasicMaterial color="#00D9A6" transparent opacity={0.03} side={BackSide} />
      </mesh>
    )}
    ```

    **6. Enhanced interaction:**
    - Current: hover shows province name. Keep this.
    - Add: click province dispatches `onProvinceClick(provinceCode, provinceData)` callback
    - On hover: province mesh emissive intensity increases (highlight effect)
    - Smooth transition: use a state variable for hovered province and lerp emissive in useFrame

    **7. Reduced motion support:**
    - Import `useReducedMotion` from shared hooks
    - If reduced motion: disable auto-rotation, disable point pulsing, disable hover animations
    - Globe still renders statically (data visualization value preserved)
    - Interaction (click, manual drag) still works

    **8. Keep all existing mobile performance optimizations:**
    - DPR cap at 2
    - frameloop="demand"
    - mediump shader precision
    - detect-gpu for LOD
    - React.lazy code-splitting
    - Simplified province GeoJSON
    Do NOT remove any of these. Only ADD the quality improvements.
  </action>
  <verify>
    - `grep "MeshPhysicalMaterial\|meshPhysicalMaterial" frontend-public/src/components/Globe3D.tsx` — upgraded material
    - `grep "AdditiveBlending" frontend-public/src/components/Globe3D.tsx` — particle glow effect
    - `grep "clearcoat\|metalness" frontend-public/src/components/Globe3D.tsx` — physical material properties
    - `grep "useReducedMotion" frontend-public/src/components/Globe3D.tsx` — reduced motion support
    - `grep "Environment" frontend-public/src/components/Globe3D.tsx` — environment map for reflections
    - `grep "detect-gpu\|gpuTier\|GPU" frontend-public/src/components/Globe3D.tsx` — GPU tier still used for LOD
    - `cd frontend-public && npx tsc --noEmit` — TypeScript compiles
  </verify>
  <done>
    Globe upgraded to premium quality: MeshPhysicalMaterial with metalness/clearcoat, glowing municipality data points with AdditiveBlending, environment map reflections, atmospheric edge glow, enhanced lighting, GPU-tier adaptive quality, and prefers-reduced-motion support. All Phase 6.1 mobile optimizations preserved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Polish scroll animations with parallax, improved timing, and reduced motion support</name>
  <files>
    frontend-public/src/components/landing/HeroSection.tsx
    frontend-public/src/components/landing/ProblemSection.tsx
    frontend-public/src/components/landing/SolutionSection.tsx
    frontend-public/src/components/landing/FeaturesSection.tsx
    frontend-public/src/components/landing/LiveStatsSection.tsx
    frontend-public/src/components/landing/MunicipalityShowcase.tsx
    frontend-public/src/components/landing/DashboardPreview.tsx
    frontend-public/src/App.css
  </files>
  <action>
    **Update ALL 7 landing sections to add prefers-reduced-motion support and polish animations.**

    **For EVERY section component:**
    1. Import `useReducedMotion` from `@shared/hooks/useReducedMotion`
    2. If `reducedMotion` is true:
       - Set elements to their final state immediately (opacity: 1, y: 0, etc.) using `gsap.set()`
       - Do NOT register any ScrollTrigger animations
       - Content is fully visible without any animation
    3. If `reducedMotion` is false: keep and enhance existing animations

    **Section-specific enhancements:**

    **HeroSection.tsx:**
    - Add parallax on the globe container: as user scrolls, globe moves up slightly slower than content
      ```typescript
      gsap.to('.globe-container', {
        y: -80,
        ease: 'none',
        scrollTrigger: {
          trigger: heroRef.current,
          start: 'top top',
          end: 'bottom top',
          scrub: true,
        },
      });
      ```
    - Update CTA button to use React Router `Link` to `/dashboard` (if not already done by Plan 02)
    - Add subtle text shadow on headline for depth against globe background

    **ProblemSection.tsx:**
    - Add stagger delay increase between reveal lines (0.15s between each)
    - Use `power3.out` ease for smoother deceleration
    - Add toggleActions `'play none none reverse'` so lines un-reveal when scrolling back up

    **SolutionSection.tsx:**
    - Improve split-screen: add slight rotation on the old-way column (`rotateY: -5deg`) as it fades
    - Add parallax background gradient shift

    **FeaturesSection.tsx:**
    - Enhance card entrance: combine Y movement with slight rotation (`rotateX: 5deg`) for perspective effect
    - Each card should have the NdebelePattern corner variant as subtle decoration (very low opacity)
    - Glow effect on hover should use design token variables

    **LiveStatsSection.tsx:**
    - Add NdebelePattern border variant as section divider above and below
    - Counter animations: keep anime.js but add a final "settle" bounce effect

    **MunicipalityShowcase.tsx:**
    - Add GSAP-powered horizontal scroll hint animation on first load (arrow pulses left)
    - Cards should use shared GlassCard component for consistency (if not too disruptive to migrate)

    **DashboardPreview.tsx:**
    - Since transparency dashboard is now a separate page (Plan 02), update this section:
      - Instead of cross-fading into embedded dashboard, show a stylized dashboard mockup
      - CTA: "Explore the Dashboard" button that links to `/dashboard`
      - Remove the scroll-linked fade-to-live-data pattern (no longer applicable)
      - Keep the glassmorphism frame aesthetic

    **App.css updates:**
    - Add parallax-specific styles
    - Add NdebelePattern integration styles (opacity, positioning)
    - Ensure all animation-related styles have `prefers-reduced-motion` overrides
    - Add styles for updated DashboardPreview CTA

    **Build verification:**
    Run `cd frontend-public && npm run build` to verify everything compiles.
  </action>
  <verify>
    - `grep "useReducedMotion" frontend-public/src/components/landing/HeroSection.tsx` — reduced motion in Hero
    - `grep "useReducedMotion" frontend-public/src/components/landing/ProblemSection.tsx` — reduced motion in Problem
    - `grep "useReducedMotion" frontend-public/src/components/landing/FeaturesSection.tsx` — reduced motion in Features
    - `grep "scrub.*true\|parallax" frontend-public/src/components/landing/HeroSection.tsx` — parallax effect
    - `grep "NdebelePattern\|ndebele" frontend-public/src/components/landing/FeaturesSection.tsx frontend-public/src/components/landing/LiveStatsSection.tsx` — patterns integrated
    - `grep "/dashboard\|Link.*dashboard" frontend-public/src/components/landing/DashboardPreview.tsx` — CTA links to dashboard page
    - `cd frontend-public && npm run build` — builds successfully
  </verify>
  <done>
    All 7 scroll sections have prefers-reduced-motion support (WCAG 2.3.3). Hero has parallax globe effect. Features have NdebelePattern corner accents. DashboardPreview updated for separate dashboard page (CTA instead of cross-fade). Animation timing polished throughout.
  </done>
</task>

</tasks>

<verification>
1. Globe uses MeshPhysicalMaterial with clearcoat, metalness properties
2. Municipality data points glow with AdditiveBlending
3. Globe adapts quality based on GPU tier (low-end gets simpler materials)
4. All 7 landing sections respect prefers-reduced-motion
5. Hero section has parallax effect on globe
6. NdebelePattern integrated as subtle accents in Features and LiveStats sections
7. DashboardPreview links to /dashboard instead of embedding dashboard
8. `npm run build` succeeds
</verification>

<success_criteria>
- Globe looks premium (metallic sheen, glass clearcoat, atmospheric glow)
- Municipality points pulse with glow
- Desktop users get full animation experience
- Reduced motion users see static content with full data visibility
- Mobile users get simplified materials for performance
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/06.2-ux-redesign-user-journeys-design-system-and-dashboard-consistency/06.2-04-SUMMARY.md`
</output>
