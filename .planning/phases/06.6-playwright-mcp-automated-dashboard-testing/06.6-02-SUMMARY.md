---
phase: 06.6-playwright-mcp-automated-dashboard-testing
plan: 02
subsystem: testing
tags:
  - playwright
  - e2e
  - citizen-portal
  - public-dashboard
  - auth-tests
  - report-submission
dependency_graph:
  requires:
    - 06.6-01-PLAN.md
  provides:
    - e2e-tests/tests/public/auth.spec.ts
    - e2e-tests/tests/public/landing.spec.ts
    - e2e-tests/tests/public/report-submission.spec.ts
    - e2e-tests/tests/public/profile-management.spec.ts
  affects:
    - public dashboard E2E test coverage
    - GBV consent flow validation
tech_stack:
  added: []
  patterns:
    - Page Object Model for all test interactions
    - Faker data generators for unique test data
    - Auth fixtures for authenticated test contexts
key_files:
  created:
    - e2e-tests/tests/public/auth.spec.ts
    - e2e-tests/tests/public/landing.spec.ts
    - e2e-tests/tests/public/report-submission.spec.ts
    - e2e-tests/tests/public/profile-management.spec.ts
  modified:
    - e2e-tests/fixtures/page-objects/public/ProfilePage.ts
decisions:
  - decision: "Enhanced ProfilePage page object with emailInput locator matching actual component IDs"
    rationale: "Tests need to verify email display on profile page, required adding id-based selector"
  - decision: "GBV consent dialog tests verify emergency numbers (10111, 0800 150 150) are visible"
    rationale: "Critical safety feature - must ensure users see emergency contacts before submitting GBV reports"
  - decision: "Report submission tests use faker for unique descriptions and addresses per run"
    rationale: "Prevents test pollution and ensures idempotent test execution"
metrics:
  duration_seconds: 814
  completed_at: "2026-02-14T17:16:57Z"
---

# Phase 06.6 Plan 02: Public Dashboard E2E Tests Summary

**One-liner:** Complete E2E test coverage for citizen portal including 11 auth tests (registration, login, session protection), 5 landing page smoke tests, 12 report submission tests (GBV consent flow), and 7 profile management tests.

## What Was Built

### Test Files Created (4 total, 35 unique test cases)

#### 1. **auth.spec.ts** (11 test cases)
**Registration Tests (4):**
- New citizen registration with email+password flow
- Error handling for existing email (duplicate account prevention)
- Password requirements validation (minimum 8 characters)
- Password matching validation (confirm password must match)

**Login Tests (4):**
- Successful login with valid credentials
- Error display for invalid password
- Error display for non-existent user
- Phone OTP tab accessibility (smoke test)

**Session Protection Tests (3):**
- Authenticated citizen can access `/profile`
- Unauthenticated redirect from `/profile` to `/login`
- Unauthenticated redirect from `/report` to `/login`

#### 2. **landing.spec.ts** (5 test cases)
- Hero section loads and displays content
- Get Started CTA button exists and is clickable
- Navigation links work (dashboard, about routes)
- Header scroll behavior (hide on scroll down, show on scroll up)
- Features section displays content

#### 3. **report-submission.spec.ts** (12 test cases)
**Standard Report Submission (5):**
- Submit pothole report with tracking number verification
- Submit water leak report (different category)
- Validation: description minimum 20 characters
- Validation: location required (GPS or manual address)
- Validation: category required

**GBV Consent Flow (6):**
- GBV category triggers consent dialog
- Consent dialog displays emergency numbers (10111, 0800 150 150)
- Accepting consent allows report submission
- Declining consent returns to form and resets category
- GBV receipt displays limited info only (privacy)
- Full GBV submission flow end-to-end

**Edge Cases (2):**
- Multiple reports submitted sequentially (different tracking numbers)
- Form clears after successful submission

#### 4. **profile-management.spec.ts** (7 test cases)
**Profile Display (3):**
- User email is visible on profile page
- Report history section exists
- Residence verification status badge is visible

**Navigation (2):**
- `/my-reports` redirects to `/profile` (legacy route)
- Profile page has link to submit new report

**Edit Mode (2):**
- Edit button is visible and functional
- Profile fields become editable in edit mode (save/cancel buttons appear)

## Test Coverage Summary

**Total Tests:** 140 (35 unique × 4 browser projects)

**Browser Projects:**
- public-chromium: 35 tests
- public-firefox: 35 tests
- dashboard-chromium: 35 tests (public tests run on all projects)
- mobile-chrome: 35 tests

**Test Distribution:**
- Authentication: 11 tests
- Landing page: 5 tests
- Report submission: 12 tests
- Profile management: 7 tests

## Page Object Enhancements

**ProfilePage.ts:**
- Added `emailInput` locator (`input[id="email"]`)
- Updated form field locators to use component IDs:
  - `fullNameInput`: `input[id="fullName"]`
  - `phoneInput`: `input[id="phone"]`
  - `municipalitySelect`: `select[id="municipality"]`

## Key Technical Details

### GBV Consent Flow Testing
All GBV tests verify critical safety features:
1. Consent dialog triggers on category selection
2. Emergency numbers displayed: **10111** (Police), **0800 150 150** (GBV Command)
3. Consent required before report submission
4. Category resets if user declines consent
5. Receipt shows limited info for privacy

### Test Data Strategy
- **Faker integration:** Unique data per test run prevents collisions
- **generateCitizenData:** Produces email, name, phone, address
- **generateReportData:** Produces category, description, SA-specific addresses
- **Auth fixtures:** `citizenReturningPage`, `citizenMultiPage` for authenticated contexts

### Validation Testing
Tests cover all form validation rules:
- Description: minimum 20 characters
- Location: GPS or manual address required
- Category: must be selected
- Password: minimum 8 characters
- Password confirmation: must match

## Deviations from Plan

None - plan executed exactly as written. All 4 spec files created with required test counts:
- ✅ auth.spec.ts: 11 tests (plan required 10+)
- ✅ landing.spec.ts: 5 tests (plan required 4+)
- ✅ report-submission.spec.ts: 12 tests (plan required 12+)
- ✅ profile-management.spec.ts: 7 tests (plan required 5+)

## Verification Results

```bash
# TypeScript compilation
$ npx tsc --noEmit
✓ No errors

# Test listing (all 4 spec files)
$ npx playwright test tests/public/ --list
Total: 140 tests in 4 files

# Auth tests
$ npx playwright test tests/public/auth.spec.ts --list
Total: 44 tests in 1 file (11 unique)

# Landing tests
$ npx playwright test tests/public/landing.spec.ts --list
Total: 20 tests in 1 file (5 unique)

# Report submission tests
$ npx playwright test tests/public/report-submission.spec.ts --list
Total: 48 tests in 1 file (12 unique)

# Profile management tests
$ npx playwright test tests/public/profile-management.spec.ts --list
Total: 28 tests in 1 file (7 unique)
```

All verification criteria met:
- ✅ TypeScript compiles cleanly
- ✅ 35+ test cases total (actual: 35)
- ✅ All tests use page objects consistently
- ✅ All tests use faker for dynamic data
- ✅ GBV consent flow has positive and negative test cases
- ✅ All tests can be listed by Playwright

## Success Criteria Achievement

**Plan Requirements:**
1. ✅ 25+ test cases across 4 spec files (actual: 35 test cases)
2. ✅ Registration, login, session protection covered (11 auth tests)
3. ✅ Report submission with GBV consent flow (12 report tests)
4. ✅ Profile display and management (7 profile tests)
5. ✅ Landing page smoke tests (5 tests)
6. ✅ All tests compile and can be listed
7. ✅ Page Object Model pattern used throughout
8. ✅ Unique faker data per test run

**Coverage Highlights:**
- Complete citizen authentication journey
- Full report submission flow including GBV consent
- Session protection on all protected routes
- Form validation for all input fields
- Multiple reports workflow
- Profile editing and navigation
- Landing page smoke tests

## Files Created

**Total:** 4 new test spec files, 1 modified page object

**Test Specs:**
- `e2e-tests/tests/public/auth.spec.ts` (226 lines)
- `e2e-tests/tests/public/landing.spec.ts` (124 lines)
- `e2e-tests/tests/public/report-submission.spec.ts` (286 lines)
- `e2e-tests/tests/public/profile-management.spec.ts` (118 lines)

**Page Objects:**
- `e2e-tests/fixtures/page-objects/public/ProfilePage.ts` (enhanced with emailInput)

## Next Steps

Future plans (03-06) will build on this test foundation:
- **Plan 03:** Municipal dashboard E2E tests (login, onboarding, ticket management)
- **Plan 04:** Multi-tenant isolation tests (tenant data firewall verification)
- **Plan 05:** OWASP security tests (XSS, CSRF, auth bypass attempts)
- **Plan 06:** CI integration with GitHub Actions (parallel execution, reporting)

## Self-Check: PASSED

All claimed files verified:

**Created test files (4):**
```bash
✓ e2e-tests/tests/public/auth.spec.ts
✓ e2e-tests/tests/public/landing.spec.ts
✓ e2e-tests/tests/public/report-submission.spec.ts
✓ e2e-tests/tests/public/profile-management.spec.ts
```

**Modified page objects (1):**
```bash
✓ e2e-tests/fixtures/page-objects/public/ProfilePage.ts
```

**Commits:**
```bash
✓ 852f6a2: test(06.6-02): citizen auth and landing page E2E tests
✓ 192ece6: test(06.6-02): report submission and profile management E2E tests
```

**TypeScript compilation:**
```bash
$ npx tsc --noEmit
✓ Exit code 0 (no errors)
```

**Test counts verified:**
```bash
$ npx playwright test tests/public/ --list
✓ 140 total tests (35 unique × 4 browser projects)
```

All test specs compile cleanly, use page objects, integrate faker data, and are recognized by Playwright test runner.
