---
phase: 06.6-playwright-mcp-automated-dashboard-testing
plan: 02
type: execute
wave: 2
depends_on: ["06.6-01"]
files_modified:
  - e2e-tests/tests/public/auth.spec.ts
  - e2e-tests/tests/public/report-submission.spec.ts
  - e2e-tests/tests/public/profile-management.spec.ts
  - e2e-tests/tests/public/landing.spec.ts
autonomous: true
must_haves:
  truths:
    - "New citizen can register with email+password and land on profile page"
    - "Returning citizen can log in and see their existing reports"
    - "Citizen can submit a service report with category, description, and address"
    - "Submitted report shows receipt with tracking number"
    - "GBV category triggers consent dialog with emergency numbers before submission"
    - "Landing page loads with hero, features, and CTA buttons"
    - "Profile page displays user info and report history"
  artifacts:
    - path: "e2e-tests/tests/public/auth.spec.ts"
      provides: "Registration and login E2E tests for citizen portal"
      min_lines: 80
    - path: "e2e-tests/tests/public/report-submission.spec.ts"
      provides: "Report submission E2E tests including GBV consent flow"
      min_lines: 100
    - path: "e2e-tests/tests/public/profile-management.spec.ts"
      provides: "Profile page and citizen portal E2E tests"
      min_lines: 40
    - path: "e2e-tests/tests/public/landing.spec.ts"
      provides: "Landing page smoke E2E tests"
      min_lines: 30
  key_links:
    - from: "e2e-tests/tests/public/auth.spec.ts"
      to: "e2e-tests/fixtures/auth.ts"
      via: "imports extended test with citizen fixtures"
      pattern: "import.*test.*from.*fixtures/auth"
    - from: "e2e-tests/tests/public/report-submission.spec.ts"
      to: "e2e-tests/fixtures/page-objects/public/ReportIssuePage.ts"
      via: "uses ReportIssuePage page object"
      pattern: "new ReportIssuePage"
    - from: "e2e-tests/tests/public/auth.spec.ts"
      to: "e2e-tests/fixtures/test-data.ts"
      via: "generates unique citizen data with faker"
      pattern: "generateCitizenData"
---

<objective>
Write E2E tests for the public citizen dashboard covering all citizen user journeys: registration, login, report submission (including GBV consent flow), profile management, and landing page smoke tests.

Purpose: Verifies success criteria 1 (account creation), 2 (database persistence), 3 (report submission and routing), and 5 (edge cases) from the citizen perspective. These tests use the citizen-* profiles and public dashboard page objects.

Output: 4 test spec files covering all public dashboard user journeys with 15-20 test cases.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06.6-playwright-mcp-automated-dashboard-testing/06.6-RESEARCH.md
@.planning/phases/06.6-playwright-mcp-automated-dashboard-testing/06.6-01-SUMMARY.md
@frontend-public/src/pages/CitizenLoginPage.tsx
@frontend-public/src/pages/CitizenRegisterPage.tsx
@frontend-public/src/pages/ReportIssuePage.tsx
@frontend-public/src/pages/ProfilePage.tsx
@frontend-public/src/pages/LandingPage.tsx
@frontend-public/src/components/citizen/GBVConsentDialog.tsx
@frontend-public/src/components/citizen/ReportReceipt.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Citizen auth and landing page E2E tests</name>
  <files>
    e2e-tests/tests/public/auth.spec.ts
    e2e-tests/tests/public/landing.spec.ts
  </files>
  <action>
    Create tests/public/auth.spec.ts covering citizen authentication flows:

    1. Registration tests (use generateCitizenData for unique emails each run):
       - "New citizen can register with email and password" -- navigate to /register, fill form (email, password, confirm password, first name, last name), submit, verify redirect to /profile or /login
       - "Registration shows error for existing email" -- use citizen-returning profile email, attempt register, verify error message
       - "Registration validates password requirements" -- try short password, verify validation error
       - "Registration validates matching passwords" -- different confirm password, verify error

    2. Login tests:
       - "Citizen can log in with valid credentials" -- use citizen-returning profile, login via LoginPage page object, verify redirect to profile/dashboard
       - "Login shows error for invalid credentials" -- wrong password, verify error message
       - "Login shows error for non-existent user" -- faker email, verify error
       - "Phone OTP tab is accessible" -- click phone tab, verify phone input visible (smoke test only, can't complete OTP without real SMS)

    3. Session tests:
       - "Authenticated citizen can access /profile" -- use citizenReturningPage fixture, navigate to /profile, verify content loads
       - "Unauthenticated user is redirected from /profile to /login" -- fresh context (no auth), navigate to /profile, verify redirect to /login
       - "Unauthenticated user is redirected from /report to /login" -- fresh context, navigate to /report, verify redirect to /login

    Create tests/public/landing.spec.ts covering landing page smoke tests:

    1. "Landing page loads with hero section" -- navigate to /, verify hero text/images visible
    2. "Landing page has Get Started CTA" -- verify CTA button exists and is clickable
    3. "Navigation links work" -- click dashboard link, verify /dashboard route; click about, verify /about route
    4. "Header hides on scroll and reappears" -- scroll down 200px, verify header hidden; scroll up, verify header visible (if feasible with Playwright scroll)

    All tests must:
    - Import { test, expect } from fixtures/auth or @playwright/test
    - Use page objects for all page interactions
    - Use faker for any new user data
    - NOT use waitForTimeout (use auto-wait assertions instead)
    - Handle GSAP animations gracefully (elements may animate in -- use toBeVisible() which auto-waits)
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npx playwright test tests/public/auth.spec.ts --list` lists all auth test cases
    - `npx playwright test tests/public/landing.spec.ts --list` lists all landing test cases
  </verify>
  <done>
    Auth spec has 10+ test cases covering registration, login, session protection. Landing spec has 4+ smoke tests. All use page objects and faker data. TypeScript compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Report submission and profile management E2E tests</name>
  <files>
    e2e-tests/tests/public/report-submission.spec.ts
    e2e-tests/tests/public/profile-management.spec.ts
  </files>
  <action>
    Create tests/public/report-submission.spec.ts covering the full report submission journey:

    1. Standard report submission:
       - "Citizen can submit a pothole report" -- use citizenReturningPage, navigate to /report, select 'Pothole' category, fill description (min 20 chars), fill manual address, submit, verify receipt card with tracking number appears
       - "Citizen can submit a water leak report" -- different category, same flow, verify tracking number
       - "Report requires description of at least 20 characters" -- try short description, verify validation error
       - "Report requires either GPS or manual address" -- leave both empty, submit, verify validation error
       - "Report requires category selection" -- skip category, submit, verify validation error

    2. GBV consent flow:
       - "GBV category triggers consent dialog" -- select 'GBV/Abuse' from category dropdown, verify consent dialog appears with emergency numbers (10111, 0800 150 150)
       - "GBV consent dialog shows emergency numbers" -- verify 10111 and 0800 150 150 are visible in dialog
       - "Accepting GBV consent allows report submission" -- click consent button, fill description and address, submit, verify receipt
       - "Declining GBV consent returns to form" -- select GBV, close/decline dialog, verify category is NOT set to GBV/Abuse
       - "GBV receipt shows limited info only" -- after GBV submission, verify receipt shows tracking number but limited details (privacy)

    3. Edge cases:
       - "Multiple reports can be submitted sequentially" -- use citizenMultireportPage, submit 2 reports in sequence, verify both get unique tracking numbers
       - "Report form clears after successful submission" -- submit report, navigate back to /report, verify form fields are empty

    Create tests/public/profile-management.spec.ts:

    1. Profile display:
       - "Profile page shows user email" -- use citizenReturningPage, navigate to /profile, verify user email displayed
       - "Profile page shows report history" -- verify reports section is visible (may be empty list or populated)
       - "Profile page shows residence verification status" -- verify residence section exists

    2. Navigation:
       - "My Reports route redirects to profile" -- navigate to /my-reports, verify redirect to /profile
       - "Profile page has link to submit new report" -- verify report CTA/link exists

    All tests use ReportIssuePage and ProfilePage page objects. Use faker for descriptions and addresses. Each test that creates a report uses unique data via generateReportData().
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npx playwright test tests/public/report-submission.spec.ts --list` lists all report test cases
    - `npx playwright test tests/public/profile-management.spec.ts --list` lists all profile test cases
  </verify>
  <done>
    Report submission spec has 12+ test cases covering standard reports, GBV consent flow, and edge cases. Profile spec has 5+ test cases. All use page objects and faker data. GBV consent dialog interactions fully tested. TypeScript compiles.
  </done>
</task>

</tasks>

<verification>
- All 4 test spec files exist under e2e-tests/tests/public/
- `npx tsc --noEmit` passes for all test files
- `npx playwright test tests/public/ --list` shows 25+ test cases total
- Tests use page objects consistently (no raw page.locator in spec files except where page object doesn't cover)
- Tests use faker for dynamic data (no hardcoded test emails in spec files)
- GBV consent flow has both positive and negative test cases
</verification>

<success_criteria>
- 25+ test cases across 4 spec files covering all citizen user journeys
- Registration, login, session protection, report submission, GBV consent, profile display
- All tests compile and can be listed by Playwright
- Tests follow Page Object Model pattern
- Unique faker data per test run prevents data collisions
</success_criteria>

<output>
After completion, create `.planning/phases/06.6-playwright-mcp-automated-dashboard-testing/06.6-02-SUMMARY.md`
</output>
