---
phase: 06.6-playwright-mcp-automated-dashboard-testing
plan: 03
subsystem: e2e-testing
tags: [playwright, e2e, municipal-dashboard, rbac, onboarding, ticket-management, access-request]
dependency_graph:
  requires:
    - 06.6-01 (auth fixtures and page objects)
  provides:
    - Municipal dashboard E2E test coverage
    - Access request flow tests
    - Onboarding wizard tests
    - RBAC tests for 5 municipal roles
    - Ticket management tests
  affects:
    - Municipal dashboard feature confidence
    - Regression detection capability
tech_stack:
  added:
    - None (uses existing Playwright infrastructure)
  patterns:
    - Page Object Model for test organization
    - Auth fixtures for role-based testing
    - Negative authorization testing
key_files:
  created:
    - e2e-tests/tests/municipal/access-request.spec.ts
    - e2e-tests/tests/municipal/onboarding.spec.ts
    - e2e-tests/tests/municipal/dashboard-rbac.spec.ts
    - e2e-tests/tests/municipal/ticket-management.spec.ts
  modified: []
decisions: []
metrics:
  duration_seconds: 956
  duration_minutes: 15.9
  completed_at: 2026-02-14T17:19:19Z
  tasks_completed: 2
  test_cases_added: 39
  spec_files_created: 4
---

# Phase 06.6 Plan 03: Municipal Dashboard E2E Tests Summary

**Municipal dashboard E2E tests covering access requests, onboarding, RBAC, and ticket management**

## Objective

Write comprehensive E2E tests for the municipal dashboard covering all municipal user journeys: access request submission, onboarding wizard progression, RBAC-based dashboard access for all 5 municipal roles, and ticket management operations (search, filter, pagination, export).

## What Was Built

### Test Spec Files (4 files, 39 test cases)

1. **access-request.spec.ts** (6 tests)
   - Municipality can submit access request with valid data
   - Form validation for required fields (municipality name, province, contact name, email)
   - Email format validation
   - Document upload functionality (PDF, JPG, PNG)
   - Auto-save draft to localStorage with page refresh restoration
   - Province dropdown contains all 9 SA provinces

2. **onboarding.spec.ts** (6 tests)
   - Admin sees onboarding wizard on first login (Welcome step visible)
   - Wizard progresses through steps (Welcome → Profile → Team → Wards → SLA → Completion)
   - Steps can be skipped (Team, Wards, SLA are optional)
   - Progress persists after page refresh (backend state restoration)
   - Wizard can navigate backwards with data preservation
   - Completion redirects to main dashboard

3. **dashboard-rbac.spec.ts** (16 tests)
   - **Admin role** (3 tests): Dashboard access, all navigation items (Dashboard, Tickets, Teams, Analytics, Settings), ticket list access
   - **Manager role** (3 tests): Dashboard access, ticket management with filters/export, management navigation
   - **Field worker role** (3 tests): Limited navigation (ONLY My Tickets and Submit Report), ticket list access (assigned tickets), report submission form
   - **SAPS liaison role** (2 tests): Dashboard access (GBV-specific), GBV Cases and Reports navigation
   - **Ward councillor role** (2 tests): Dashboard access, ward-filtered data with My Ward Tickets navigation
   - **Negative tests** (3 tests): Unauthenticated redirect to login, citizen role cannot access municipal dashboard, field worker cannot access admin settings

4. **ticket-management.spec.ts** (11 tests)
   - **List display** (3 tests): Table with headers (ID/Tracking, Status, Category, Priority, Assigned, Created), pagination controls, real ticket data or empty state
   - **Search and filter** (4 tests): Search by keyword with debounce, filter by status, filter by category, clear/reset filters
   - **Export** (1 test): CSV download with correct filename pattern
   - **Real-time indicator** (1 test): Live connection status visible on dashboard
   - **Edge cases** (2 tests): Empty search returns full list, pagination changes page content

## Test Coverage Verification

All test spec files TypeScript-compile successfully (`npx tsc --noEmit` passes).

**Test counts:**
- access-request.spec.ts: 6 tests (>= 5 required) ✓
- onboarding.spec.ts: 6 tests (>= 6 required) ✓
- dashboard-rbac.spec.ts: 16 tests (>= 12 required) ✓
- ticket-management.spec.ts: 11 tests (>= 10 required) ✓
- **Total: 39 tests (>= 30 required) ✓**

All 5 municipal roles tested: admin, manager, field_worker, ward_councillor, saps_liaison ✓

## Key Implementation Details

### Page Object Model Pattern

All tests use existing page objects from 06.6-01:
- `RequestAccessPage` for access request form interactions
- `OnboardingWizardPage` for wizard navigation and step detection
- `TicketListPage` for ticket table, search, filter, pagination
- `DashboardPage` for dashboard metrics and real-time indicator

### Auth Fixtures Usage

RBAC tests leverage auth fixtures from 06.6-01:
- `adminPage`, `managerPage`, `fieldWorkerPage`, `sapsLiaisonPage`, `wardCouncillorPage` for municipal roles
- `citizenNewPage` for negative authorization test (citizen cannot access municipal dashboard)
- Fresh unauthenticated context for redirect test

### Navigation Verification

RBAC tests verify navigation items match `useRoleBasedNav` hook expectations:
- **Admin/Manager**: Dashboard, Tickets, Teams, Analytics, Settings
- **Ward Councillor**: Dashboard, My Ward Tickets, Ward Analytics
- **Field Worker**: My Tickets, Submit Report (no Dashboard, Teams, Analytics)
- **SAPS Liaison**: GBV Cases, Reports

### Form and Data Validation

- Access request tests validate all required fields and email format
- Province dropdown verified to contain all 9 SA provinces (Eastern Cape, Free State, Gauteng, KwaZulu-Natal, Limpopo, Mpumalanga, North West, Northern Cape, Western Cape)
- File upload tests verify document attachment and removal functionality
- Auto-save tests verify localStorage persistence and page refresh restoration

## Deviations from Plan

None - plan executed exactly as written. All test cases implemented as specified.

## Commits

| Commit | Message | Files |
|--------|---------|-------|
| 160de25 | test(06.6-03): add municipal E2E tests for access request, onboarding, and RBAC | access-request.spec.ts, onboarding.spec.ts, dashboard-rbac.spec.ts |
| 0160e52 | test(06.6-03): add ticket management E2E tests | ticket-management.spec.ts |

## Self-Check

**Files created:**
- ✓ e2e-tests/tests/municipal/access-request.spec.ts exists
- ✓ e2e-tests/tests/municipal/onboarding.spec.ts exists
- ✓ e2e-tests/tests/municipal/dashboard-rbac.spec.ts exists
- ✓ e2e-tests/tests/municipal/ticket-management.spec.ts exists

**Commits exist:**
- ✓ 160de25: test(06.6-03): add municipal E2E tests for access request, onboarding, and RBAC
- ✓ 0160e52: test(06.6-03): add ticket management E2E tests

**Test compilation:**
- ✓ `npx tsc --noEmit` passes with no TypeScript errors

**Test count verification:**
- ✓ 39 total test cases across 4 spec files (exceeds 30+ requirement)
- ✓ All must-have artifacts present with minimum line counts met

## Self-Check: PASSED

All files created, commits verified, TypeScript compilation successful, test count exceeds requirements.

## Next Steps

1. Execute tests against running dashboards (frontend-public:5173, frontend-dashboard:5174)
2. Verify all role profiles exist and can authenticate
3. Seed test data for ticket list, search, and filter tests
4. Continue to Plan 04: Public portal E2E tests (citizen journeys)

## Success Criteria Met

- ✅ 39 test cases across 4 spec files covering all municipal user journeys
- ✅ All 5 municipal roles tested for appropriate access levels
- ✅ Access request, onboarding, dashboard RBAC, and ticket management all covered
- ✅ Tests follow Page Object Model pattern
- ✅ Negative authorization tests verify security boundaries
- ✅ TypeScript compiles with no errors
- ✅ All test specs use appropriate auth fixtures
