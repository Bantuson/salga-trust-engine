---
phase: 10.3-crewai-agent-rebuild-and-llm-evaluation-framework
task: agent-iteration-after-eval
total_plans: 9
plans_complete: 7
status: in_progress
last_updated: 2026-02-25T21:20:00.000Z
---

<current_state>
Phase 10.3 Wave 5 checkpoint. Plans 01-07 complete. Plan 08 Task 1 done (integration tests).

Per-agent Playwright eval completed: **1/4 PASS (GBV), 3/4 FAIL (Auth, Municipal, Ticket Status)**.

The 3 failing agents all use gpt-4o-mini which overrides backstory with safety training.
GBV passes because it uses DeepSeek which follows system prompts faithfully.

Eval report: `tests/evals/reports/2026-02-25-agent-eval-results.md`
Screenshots: `tests/evals/screenshots/`

Bug fixed this session: `crew_server.py` dotenv loading (commit `6e263df`).
</current_state>

<remaining_work>

## Immediate: Fix 3 failing agents (iteration required)

Root cause: gpt-4o-mini ignores backstory/tools. Options:
1. Switch all 3 agents to DeepSeek (proven to work for GBV)
2. Switch to gpt-4o (full, not mini) — better instruction following
3. Strengthen prompts with explicit "YOU MUST use tools" + few-shot examples
4. Test with verbose=True first to diagnose whether tools are attempted

Files to modify:
- `src/agents/crews/auth_crew.py` — LLM selection + prompt strengthening
- `src/agents/crews/municipal_crew.py` — same
- `src/agents/crews/ticket_status_crew.py` — same
- `src/agents/prompts/auth.py` — add tool-use instructions
- `src/agents/prompts/municipal.py` — add tool-use instructions
- `src/agents/prompts/ticket_status.py` — add tool-use instructions

## After fixes: Re-run eval for all 4 agents

## Then: Complete Plan 08 Task 2, proceed to Plan 09

## Phase completion: verification, ROADMAP update, close phase
</remaining_work>

<next_action>
1. Diagnose: Run auth agent with verbose=True to see if it attempts tool calls
2. Try switching auth agent to DeepSeek — does it adopt Gugu persona + use tools?
3. If DeepSeek works: switch all 3 failing agents to DeepSeek
4. If not: strengthen prompts with few-shot tool-use examples
5. Re-run eval for all 4 agents
6. If all pass: complete Plan 08, proceed to Plan 09
</next_action>
