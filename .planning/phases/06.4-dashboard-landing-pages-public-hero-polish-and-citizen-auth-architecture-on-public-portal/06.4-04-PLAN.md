---
phase: 06.4-dashboard-landing-pages-public-hero-polish-and-citizen-auth-architecture-on-public-portal
plan: 04
type: execute
wave: 2
depends_on: ["06.4-01"]
files_modified:
  - frontend-public/src/pages/CitizenLoginPage.tsx
  - frontend-public/src/pages/CitizenRegisterPage.tsx
autonomous: true

must_haves:
  truths:
    - "Citizens can log in with email+password OR phone OTP (their choice)"
    - "Citizens can register with email+password with optional phone"
    - "Login page uses premium style: skyline background, glassmorphic card, GSAP animations"
    - "Register page uses same premium style as login page"
    - "Post-login redirects to the originally intended page via return URL"
    - "Proof of residence is NOT required at signup"
  artifacts:
    - path: "frontend-public/src/pages/CitizenLoginPage.tsx"
      provides: "Citizen login page with dual auth modes and return URL redirect"
      contains: "CitizenLoginPage"
    - path: "frontend-public/src/pages/CitizenRegisterPage.tsx"
      provides: "Citizen registration page with email+password signup"
      contains: "CitizenRegisterPage"
  key_links:
    - from: "frontend-public/src/pages/CitizenLoginPage.tsx"
      to: "frontend-public/src/hooks/useAuth.ts"
      via: "useAuth hook for signInWithEmail, signInWithPhone, verifyOtp"
      pattern: "useAuth"
    - from: "frontend-public/src/pages/CitizenLoginPage.tsx"
      to: "react-router-dom"
      via: "useLocation for return URL, useNavigate for redirect"
      pattern: "location\\.state\\?\\.(from|pathname)"
    - from: "frontend-public/src/pages/CitizenRegisterPage.tsx"
      to: "frontend-public/src/hooks/useAuth.ts"
      via: "useAuth hook for signUp"
      pattern: "signUp"
---

<objective>
Create citizen login and registration pages for the public portal with premium glassmorphic styling.

Purpose: Citizens need dedicated auth pages that feel consistent with the municipal dashboard's premium style (skyline background, glassmorphic card, GSAP animations) while serving a different audience. These pages are the entry point for all auth-gated citizen features (My Reports, Report Issue, Profile).

Output: Two new page components: CitizenLoginPage and CitizenRegisterPage with full auth flows.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06.4-dashboard-landing-pages-public-hero-polish-and-citizen-auth-architecture-on-public-portal/06.4-01-SUMMARY.md
@frontend-dashboard/src/pages/LoginPage.tsx
@frontend-public/src/App.css
@frontend-public/src/hooks/useAuth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CitizenLoginPage with dual auth modes and return URL redirect</name>
  <files>
    frontend-public/src/pages/CitizenLoginPage.tsx
  </files>
  <action>
    Create `frontend-public/src/pages/CitizenLoginPage.tsx` following the municipal dashboard LoginPage pattern but branded for citizens.

    **Structure:**
    - Full-viewport container with skyline background (reuse `.auth-skyline-bg` and `.auth-skyline-overlay` CSS classes from App.css — same pattern as municipal dashboard)
    - Glassmorphic card centered (NOT right-aligned like dashboard — centered for citizens)
    - Three auth modes via state: 'email' | 'phone' | 'verify-otp'

    **Auth mode: email (default)**
    - Email input field
    - Password input field
    - "Sign In" submit button (coral/rose background)
    - "OR" divider
    - "Sign in with Phone OTP" toggle button
    - "Don't have an account? Register" link → /register

    **Auth mode: phone**
    - Phone number input (+27XXXXXXXXX format hint)
    - "Send OTP" submit button
    - "Back to email login" toggle

    **Auth mode: verify-otp**
    - Info box: "OTP code sent to {phone}"
    - 6-digit code input (maxLength=6, pattern=[0-9]{6})
    - "Verify OTP" submit button
    - "Resend OTP" button (resets to phone mode)

    **Return URL handling (CRITICAL):**
    On successful login (either email or OTP verification):
    ```typescript
    const returnUrl =
      location.state?.from?.pathname ||
      sessionStorage.getItem('returnUrl') ||
      '/my-reports';
    sessionStorage.removeItem('returnUrl');
    navigate(returnUrl, { replace: true });
    ```
    This ensures the user is redirected to whichever page triggered the auth gate.

    **GSAP animation:**
    - Card entrance: `gsap.from(cardRef, { y: 50, opacity: 0, duration: 0.8, ease: 'back.out(1.7)' })`
    - Form fields stagger: `gsap.from(children, { y: 20, opacity: 0, stagger: 0.1, duration: 0.4 })` in timeline after card

    **Branding:**
    - Title: "Citizen Portal" with gradient text (rose -> teal, matching dashboard pattern)
    - Subtitle: "Sign in to track your reports"

    **Styling:**
    Use inline styles matching the dashboard LoginPage pattern (same formGroup, input, button, linkButton, etc.) but with the card centered: `margin: '0 auto'` instead of `marginRight: '10%'`.

    **Error handling:**
    - Error state displayed in coral-bordered box above form
    - Loading state disables submit buttons and shows "Signing in..." / "Sending OTP..." / "Verifying..."

    **Imports needed:**
    - useState, useRef from react
    - Link, useNavigate, useLocation from react-router-dom
    - useAuth from ../hooks/useAuth
    - GlassCard from @shared/components/ui/GlassCard
    - gsap from gsap
    - useGSAP from @gsap/react
  </action>
  <verify>
    Run `cd frontend-public && npx tsc --noEmit` to verify TypeScript compiles.
    Verify CitizenLoginPage.tsx exports CitizenLoginPage component.
    Verify file contains returnUrl handling with sessionStorage fallback.
  </verify>
  <done>
    Citizen login page with email+password and phone OTP modes. Premium glassmorphic styling with skyline background. Post-login redirects to originally intended page via return URL.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CitizenRegisterPage with email+password signup</name>
  <files>
    frontend-public/src/pages/CitizenRegisterPage.tsx
  </files>
  <action>
    Create `frontend-public/src/pages/CitizenRegisterPage.tsx` for citizen registration.

    **Form fields (single scrollable form, NOT multi-step wizard per user decision):**
    - Full name (required)
    - Email address (required)
    - Password (required, minimum 8 characters)
    - Confirm password (required, must match)
    - Phone number (optional, +27 format hint)
    - Municipality selector (optional dropdown — can be set later in profile)

    **IMPORTANT per user decision:** Proof of residence is NOT required at signup. No file upload on this page.

    **Signup flow:**
    1. Validate form (passwords match, email format, min password length)
    2. Call `signUp(email, password, { full_name, phone })` from useAuth
    3. On success, show a confirmation message: "Account created! Please check your email to verify your account." (Supabase sends verification email by default)
    4. Provide a "Go to Login" link

    **Alternatively, if auto-login is preferred:** After signUp, if Supabase returns a session (when email confirmation is disabled), redirect to returnUrl same as login page. Handle both cases.

    **Layout:**
    - Same premium style: skyline background (.auth-skyline-bg + .auth-skyline-overlay), glassmorphic card centered
    - GSAP entrance animation (same card bounce pattern)
    - Title: "Create Your Account" with gradient text
    - Subtitle: "Join the SALGA Trust Engine citizen portal"

    **Municipality selector:**
    Hardcode the 5 pilot municipalities for now as a simple dropdown:
    ```
    { value: '', label: 'Select your municipality (optional)' },
    { value: 'city-of-johannesburg', label: 'City of Johannesburg' },
    { value: 'ethekwini', label: 'eThekwini Metropolitan' },
    { value: 'city-of-cape-town', label: 'City of Cape Town' },
    { value: 'city-of-tshwane', label: 'City of Tshwane' },
    { value: 'buffalo-city', label: 'Buffalo City Metropolitan' },
    ```

    **Footer:**
    - "Already have an account? Sign in" link → /login

    **Validation:**
    - Client-side: check email format (input type=email), password >= 8 chars, passwords match
    - Show inline error messages below fields that fail validation
    - Show server error in coral box (e.g., "Email already registered")

    **Styling:** Match CitizenLoginPage exactly — same container, card, formGroup, input, button, and linkButton styles. Reuse inline style objects.
  </action>
  <verify>
    Run `cd frontend-public && npx tsc --noEmit` to verify TypeScript compiles.
    Verify CitizenRegisterPage.tsx exports CitizenRegisterPage component.
    Verify file does NOT contain proof of residence upload (not required at signup per user decision).
  </verify>
  <done>
    Citizen register page with email+password signup, optional phone and municipality. Premium glassmorphic styling matching login page. No proof of residence at signup per user decision.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend-public && npx tsc --noEmit` — TypeScript compiles with zero errors
2. CitizenLoginPage has three auth modes (email, phone, verify-otp) with return URL handling
3. CitizenRegisterPage has signup form with full_name, email, password, confirm, phone, municipality
4. Both pages use skyline background + glassmorphic card + GSAP animations
5. No proof of residence on register page
</verification>

<success_criteria>
- Citizens can log in with email+password or phone OTP
- Citizens can register with email+password (no proof of residence required)
- Both pages use premium style consistent with municipal dashboard
- Login redirects to originally intended page via return URL
- All forms have proper validation and error handling
</success_criteria>

<output>
After completion, create `.planning/phases/06.4-dashboard-landing-pages-public-hero-polish-and-citizen-auth-architecture-on-public-portal/06.4-04-SUMMARY.md`
</output>
