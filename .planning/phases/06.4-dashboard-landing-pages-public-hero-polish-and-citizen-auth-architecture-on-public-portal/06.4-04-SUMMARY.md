---
phase: 06.4-dashboard-landing-pages-public-hero-polish-and-citizen-auth-architecture-on-public-portal
plan: 04
subsystem: frontend-public
tags: [authentication, citizen-portal, ui, glassmorphism, gsap]

dependency_graph:
  requires:
    - 06.4-01 (citizen auth infrastructure)
  provides:
    - citizen_login_page
    - citizen_register_page
    - dual_auth_modes (email+password, phone OTP)
    - return_url_redirect
  affects:
    - frontend-public/src/App.tsx (will add /login and /register routes)
    - future protected routes (will redirect unauthenticated users to /login)

tech_stack:
  added:
    - "GSAP page animations for auth pages"
    - "Skyline background pattern for citizen auth pages"
  patterns:
    - "Dual auth mode state machine (email, phone, verify-otp)"
    - "Return URL preservation via sessionStorage + React Router state"
    - "Success state rendering pattern (registration confirmation)"
    - "Client-side form validation with field-level error display"

key_files:
  created:
    - frontend-public/src/pages/CitizenLoginPage.tsx
    - frontend-public/src/pages/CitizenRegisterPage.tsx
  modified:
    - frontend-public/src/App.css

decisions:
  - decision: "Center auth cards for citizen portal (vs right-align for municipal dashboard)"
    rationale: "Citizen portal is single-audience (citizens only), municipal dashboard has product info sidebar. Centered layout is more welcoming for citizens."
    alternatives: ["Copy municipal dashboard layout with product info sidebar"]
    chosen: "Centered glassmorphic card with skyline background"

  - decision: "NO proof of residence at signup (per user decision)"
    rationale: "Explicit user decision during plan discussion. Proof of residence can be added later in profile if needed for specific features."
    alternatives: ["Require proof of residence at signup", "Make it optional upload"]
    chosen: "Not included at all in registration form"

  - decision: "Single-page registration form (not multi-step wizard)"
    rationale: "Only 6 fields (4 required, 2 optional). Multi-step wizard would be over-engineering for this simple form."
    alternatives: ["Multi-step wizard (Step 1: email+password, Step 2: profile)"]
    chosen: "Single scrollable form with all fields visible"

  - decision: "Show email verification message after signup (no auto-login)"
    rationale: "Supabase sends verification email by default. Better UX to acknowledge this explicitly rather than silently auto-logging in unverified users."
    alternatives: ["Auto-login and redirect to /my-reports", "Redirect to login immediately"]
    chosen: "Show success message with 'Go to Login' link"

metrics:
  duration_seconds: 422
  duration_minutes: 7.0
  tasks_completed: 2
  files_created: 2
  files_modified: 1
  commits: 2
  completed_at: "2026-02-13T12:10:42Z"
---

# Phase 06.4 Plan 04: Citizen Login and Registration Pages Summary

**One-liner:** Premium glassmorphic citizen login and registration pages with dual auth modes (email+password, phone OTP) and return URL redirect support

## Overview

Created two complete authentication pages for the public portal's citizen-facing features. Both pages use the same premium skyline background + glassmorphic card styling as the municipal dashboard, adapted for a citizen-focused UX (centered layout, friendlier copy).

The login page supports dual authentication modes: email+password (default) and phone OTP with verification. The registration page collects minimal required data (full name, email, password) with optional phone and municipality, explicitly excluding proof of residence per user decision.

Both pages integrate seamlessly with the auth infrastructure from plan 06.4-01, using the useAuth hook and respecting return URL redirects for protected route flows.

## Tasks Completed

### Task 1: Create CitizenLoginPage with dual auth modes and return URL redirect

**Status:** ✅ Complete
**Commit:** `1986cf3` - feat(06.4-04): create CitizenLoginPage with dual auth modes and return URL redirect

**What was done:**
- Created `frontend-public/src/pages/CitizenLoginPage.tsx` with 3 auth modes:
  - **Email mode (default):** Email + password fields, "Sign In" button
  - **Phone mode:** Phone number input, "Send OTP" button
  - **Verify-OTP mode:** 6-digit code input, "Verify OTP" button
- Mode switching: "Sign in with Phone OTP" toggle, "Back to email login" toggle
- Return URL handling with dual storage:
  ```typescript
  const returnUrl =
    location.state?.from?.pathname ||
    sessionStorage.getItem('returnUrl') ||
    '/my-reports';
  sessionStorage.removeItem('returnUrl');
  navigate(returnUrl, { replace: true });
  ```
- GSAP animations:
  - Card entrance: `y: 50, opacity: 0, ease: 'back.out(1.7)'` (bounce)
  - Form fields stagger: `y: 20, opacity: 0, stagger: 0.1`
- Premium styling:
  - Skyline background (`.auth-skyline-bg` + `.auth-skyline-overlay`)
  - Glassmorphic card centered (margin: '0 auto')
  - Gradient title: "Citizen Portal" (coral → teal)
  - Tagline: "Sign in to track your reports"
- Error handling: Coral-bordered box above form
- Loading states: "Signing in...", "Sending OTP...", "Verifying..."
- Footer link: "Don't have an account? Register" → /register
- Added `.auth-skyline-bg` and `.auth-skyline-overlay` CSS classes to `App.css`

**Verification:**
- ✅ TypeScript compiles with zero errors
- ✅ CitizenLoginPage exports correctly
- ✅ Contains sessionStorage handling (6 references)
- ✅ Contains location.state?.from handling (2 references)
- ✅ Three auth modes implemented (email, phone, verify-otp)

**Files:**
- `frontend-public/src/pages/CitizenLoginPage.tsx` (created, 427 lines)
- `frontend-public/src/App.css` (modified, added 19 lines)

---

### Task 2: Create CitizenRegisterPage with email+password signup

**Status:** ✅ Complete
**Commit:** `cc32903` - feat(06.4-04): create CitizenRegisterPage with email+password signup

**What was done:**
- Created `frontend-public/src/pages/CitizenRegisterPage.tsx` with single-page form:
  - **Required fields:** Full name, email, password, confirm password
  - **Optional fields:** Phone number (+27XXXXXXXXX hint), municipality dropdown
  - **NO proof of residence** (explicit user decision)
- Client-side validation:
  - Full name required
  - Email format validation (regex: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`)
  - Password minimum 8 characters
  - Confirm password must match password
  - Field-level error display below inputs in coral text
- Municipality selector:
  - Hardcoded 5 pilot municipalities as dropdown options
  - Default option: "Select your municipality (optional)"
  - Helper text: "You can set this later in your profile"
- Success state rendering:
  - After successful registration, replaces form with success message
  - Message: "Please check your email to verify your account"
  - Spam folder reminder
  - "Go to Login" button → /login (preserves return URL via state)
- GSAP animations (same pattern as login page):
  - Card bounce entrance
  - Form fields stagger
- Premium styling:
  - Same skyline background + glassmorphic card
  - Centered layout (maxWidth: 500px vs login's 440px for more form space)
  - Gradient title: "Create Your Account"
  - Tagline: "Join the SALGA Trust Engine citizen portal"
  - Required field marker: red asterisk
- Error handling: Coral-bordered box for server errors (e.g., "Email already registered")
- Loading state: "Creating Account..." with disabled button
- Footer link: "Already have an account? Sign in" → /login

**Verification:**
- ✅ TypeScript compiles with zero errors
- ✅ CitizenRegisterPage exports correctly
- ✅ NO proof of residence upload (only 2 matches: comment + profile helper text)
- ✅ Form has 6 fields (4 required, 2 optional)
- ✅ Success state shows email verification message

**Files:**
- `frontend-public/src/pages/CitizenRegisterPage.tsx` (created, 445 lines)

---

## Deviations from Plan

None - plan executed exactly as written.

---

## Verification Results

**Overall verification (Plan success criteria):**

1. ✅ TypeScript compiles with zero errors (`npx tsc --noEmit` in frontend-public)
2. ✅ CitizenLoginPage has three auth modes (email, phone, verify-otp) with return URL handling
3. ✅ CitizenRegisterPage has signup form with full_name, email, password, confirm, phone, municipality
4. ✅ Both pages use skyline background + glassmorphic card + GSAP animations
5. ✅ No proof of residence on register page

**Success criteria (from plan):**
- ✅ Citizens can log in with email+password or phone OTP
- ✅ Citizens can register with email+password (no proof of residence required)
- ✅ Both pages use premium style consistent with municipal dashboard
- ✅ Login redirects to originally intended page via return URL
- ✅ All forms have proper validation and error handling

---

## Self-Check: PASSED

**Created files exist:**
```bash
✓ FOUND: frontend-public/src/pages/CitizenLoginPage.tsx (427 lines)
✓ FOUND: frontend-public/src/pages/CitizenRegisterPage.tsx (445 lines)
```

**Modified files exist:**
```bash
✓ FOUND: frontend-public/src/App.css (auth-skyline CSS classes added)
```

**Commits exist:**
```bash
✓ FOUND: 1986cf3 (Task 1: CitizenLoginPage)
✓ FOUND: cc32903 (Task 2: CitizenRegisterPage)
```

**Key features verified:**
```bash
✓ CitizenLoginPage has dual auth modes (email+password, phone OTP)
✓ CitizenLoginPage has return URL redirect with sessionStorage fallback
✓ CitizenRegisterPage has email+password signup with optional metadata
✓ CitizenRegisterPage has NO proof of residence upload
✓ Both pages use skyline background + glassmorphic card
✓ Both pages have GSAP animations (card bounce + field stagger)
✓ TypeScript compiles with zero errors
```

---

## Next Steps

These pages are complete but not yet wired into routing. Subsequent plans will:

1. **Add routes to App.tsx** - Map `/login` → `<CitizenLoginPage />` and `/register` → `<CitizenRegisterPage />`
2. **Wrap App with AuthProvider** - Make auth context available to entire app (plan 06.4-01 created the provider, needs to be wired in)
3. **Gate citizen routes** - Wrap My Reports, Report Issue, Profile with `<ProtectedRoute>` (will trigger login redirect)
4. **Test auth flow end-to-end** - Register → verify email → login → redirect to originally intended page

**Architectural note:** The centered glassmorphic card design is more welcoming for citizens than the municipal dashboard's asymmetric layout with product info sidebar. Both use the same skyline background, but the citizen portal focuses entirely on the auth experience without sales copy.

---

## Technical Notes

### Pattern: Dual Return URL Storage

Login page checks both sources in priority order:
```typescript
// 1. React Router state (survives initial redirect, lost on refresh)
location.state?.from?.pathname ||
// 2. sessionStorage (survives refresh, set by ProtectedRoute)
sessionStorage.getItem('returnUrl') ||
// 3. Default fallback (citizen portal home)
'/my-reports'
```

ProtectedRoute (from plan 06.4-01) sets both:
```typescript
sessionStorage.setItem('returnUrl', location.pathname);
<Navigate to="/login" state={{ from: location }} />
```

This ensures the return URL works even if the user refreshes the login page.

### Pattern: Success State Rendering

Registration page uses conditional rendering instead of navigation:
```typescript
if (success) {
  return <SuccessView />; // Email verification message
}
return <FormView />; // Registration form
```

This keeps the user on the same page/route while showing different content. Benefits:
- No route change needed (no /register/success route)
- Keeps glassmorphic card consistent
- Avoids "back button" issues (can't accidentally go back to form and re-submit)

### Pattern: Auth Mode State Machine

Login page uses enum-based state machine for auth modes:
```typescript
type AuthMode = 'email' | 'phone' | 'verify-otp';
const [mode, setMode] = useState<AuthMode>('email');

// Transitions:
// email → phone (via "Sign in with Phone OTP")
// phone → email (via "Back to email login")
// phone → verify-otp (after sending OTP)
// verify-otp → phone (via "Resend OTP")
```

Each mode renders different form fields and submit handlers. Clean separation of concerns.

### Design Decision: No Product Info Sidebar

Municipal dashboard login page has a left-aligned product info section (features, CTA). Citizen login page does NOT have this because:
- Citizens already know what the portal does (they're coming from the public landing page or a direct link)
- Municipal dashboard targets two audiences (existing users + municipalities evaluating the product)
- Citizen portal is single-audience (citizens only)
- Centered card is more inviting and less overwhelming

---

**Completed:** 2026-02-13T12:10:42Z
**Duration:** 7.0 minutes (422 seconds)
**Tasks:** 2/2 (100%)
**Commits:** 2 (1986cf3, cc32903)
