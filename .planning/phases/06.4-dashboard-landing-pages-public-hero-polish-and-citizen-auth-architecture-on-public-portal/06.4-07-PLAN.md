---
phase: 06.4-dashboard-landing-pages-public-hero-polish-and-citizen-auth-architecture-on-public-portal
plan: 07
type: execute
wave: 3
depends_on: ["06.4-04", "06.4-05"]
files_modified:
  - frontend-public/src/pages/ProfilePage.tsx
  - frontend-public/src/components/citizen/ProofOfResidence.tsx
autonomous: true

must_haves:
  truths:
    - "Profile page shows name, email/phone, municipality, verification status"
    - "Proof of residence upload available in profile with clear not-verified indicator"
    - "Profile page is auth-gated (ProtectedRoute)"
    - "User can edit profile fields (name, phone, municipality)"
    - "Profile page uses premium full-page style"
  artifacts:
    - path: "frontend-public/src/pages/ProfilePage.tsx"
      provides: "Full citizen profile page with editable fields and proof of residence"
      contains: "ProfilePage"
    - path: "frontend-public/src/components/citizen/ProofOfResidence.tsx"
      provides: "Proof of residence upload component with verification status indicator"
      contains: "ProofOfResidence"
  key_links:
    - from: "frontend-public/src/pages/ProfilePage.tsx"
      to: "frontend-public/src/components/citizen/ProofOfResidence.tsx"
      via: "Renders ProofOfResidence component for document upload"
      pattern: "ProofOfResidence"
    - from: "frontend-public/src/pages/ProfilePage.tsx"
      to: "frontend-public/src/hooks/useAuth.ts"
      via: "useAuth for user data and session"
      pattern: "useAuth"
---

<objective>
Build the citizen profile page with proof of residence upload and verification status.

Purpose: Citizens need a profile page to manage their account information and upload proof of residence. Proof of residence is required before first report submission but NOT at signup (per user decision), so the profile page is where citizens complete this step. The clear "not verified" indicator guides citizens to upload their document.

Output: ProfilePage with editable fields and ProofOfResidence component for document upload.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06.4-dashboard-landing-pages-public-hero-polish-and-citizen-auth-architecture-on-public-portal/06.4-01-SUMMARY.md
@.planning/phases/06.4-dashboard-landing-pages-public-hero-polish-and-citizen-auth-architecture-on-public-portal/06.4-05-SUMMARY.md
@frontend-public/src/hooks/useAuth.ts
@frontend-public/src/lib/supabase.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProofOfResidence component with upload and verification status</name>
  <files>
    frontend-public/src/components/citizen/ProofOfResidence.tsx
  </files>
  <action>
    Create `frontend-public/src/components/citizen/ProofOfResidence.tsx` following research Pattern 6.

    **Props interface:**
    ```typescript
    interface ProofOfResidenceProps {
      isVerified: boolean;
      documentUrl?: string;
      onUpload: (file: File) => Promise<void>;
      isUploading?: boolean;
    }
    ```

    **Two states:**

    **1. Verified state (isVerified === true):**
    Show a success badge:
    - Green/teal checkmark icon + "Verified" text
    - "Your residence has been confirmed" subtitle
    - If documentUrl provided, show "View Document" link (opens in new tab)
    - Wrapped in a card with teal border

    **2. Not verified state (isVerified === false):**
    Show warning + upload area:
    - Warning box (gold-bordered): "You must upload proof of residence before submitting your first report"
    - Drop zone area:
      - Border: 2px dashed var(--border-subtle), rounded
      - Drag state: border turns teal, background slightly elevated
      - Content: "Drag & drop proof of residence here" + "or click to browse (PDF, JPG, PNG)"
      - Upload state: "Uploading..." with spinner
    - Accepted formats note: "Accepted: Utility bill, bank statement, lease agreement, rates notice (max 90 days old)"
    - File input: accept image/* and application/pdf, maxFiles: 1

    **Implementation:**
    Use a standard `<input type="file">` wrapped in a clickable div as the drop zone. Add drag event handlers (onDragEnter, onDragLeave, onDragOver, onDrop) for visual feedback. Call `onUpload(file)` when a file is selected or dropped.

    If react-dropzone is available in frontend-public/package.json, use it. Otherwise, implement a simple native drop zone:
    ```typescript
    const handleDrop = (e: React.DragEvent) => {
      e.preventDefault();
      setIsDragActive(false);
      const file = e.dataTransfer.files[0];
      if (file) onUpload(file);
    };
    ```

    **Styling:** GlassCard wrapper. Use inline styles matching project conventions. Warning box uses gold accent. Verified badge uses teal color.
  </action>
  <verify>
    Run `cd frontend-public && npx tsc --noEmit` to verify TypeScript compiles.
    Verify ProofOfResidence.tsx shows different UI for verified vs not-verified states.
    Verify file upload accepts PDF, JPG, PNG.
  </verify>
  <done>
    ProofOfResidence component shows clear verified/not-verified status. Not-verified state has drag-and-drop upload area for PDF/image documents. Verified state shows green badge with optional document link.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build full citizen profile page with editable fields</name>
  <files>
    frontend-public/src/pages/ProfilePage.tsx
  </files>
  <action>
    Replace the placeholder `frontend-public/src/pages/ProfilePage.tsx` with the full profile page.

    **Layout:**
    - Premium full-page style with animated gradient background (AnimatedGradientBg)
    - Content container: max-width 800px, centered, padding for header
    - Page title: "My Profile" with display font
    - Two sections stacked vertically:
      1. Personal Information (GlassCard)
      2. Proof of Residence (ProofOfResidence component)

    **Personal Information section (GlassCard):**
    Form fields (all pre-filled from user metadata):
    1. **Full Name** — text input, pre-filled from `user.user_metadata?.full_name`
    2. **Email** — text input, readonly/disabled (shown but not editable — email is the auth identifier)
    3. **Phone** — text input, pre-filled from `user.phone` or `user.user_metadata?.phone`, +27 format
    4. **Municipality** — dropdown selector, pre-filled from `user.user_metadata?.municipality`
       Same options as registration page (5 pilot municipalities + empty option)
    5. **Account Created** — readonly display field showing `user.created_at` formatted as date

    **Edit mode:**
    - "Edit Profile" button toggles edit mode
    - In edit mode, fields become editable (except email and created date)
    - "Save Changes" button calls `supabase.auth.updateUser({ data: { full_name, phone, municipality } })`
    - "Cancel" button reverts to view mode
    - Show success toast/message on save: "Profile updated successfully"
    - Show error message on failure

    **Verification status badge:**
    At the top of the page, show a verification status summary:
    - If verified: Green badge "Verified Citizen" with teal border
    - If not verified: Amber badge "Verification Pending — Upload proof of residence below" with gold border

    **Proof of Residence section:**
    Render `<ProofOfResidence>` component with:
    - `isVerified`: from `user.user_metadata?.residence_verified === true`
    - `documentUrl`: from `user.user_metadata?.residence_document_url`
    - `onUpload`: async function that:
      1. Uploads file to Supabase Storage: `supabase.storage.from('documents').upload(\`residence/\${user.id}/\${file.name}\`, file)`
      2. Gets public URL or signed URL
      3. Updates user metadata: `supabase.auth.updateUser({ data: { residence_verified: false, residence_document_url: url, residence_upload_date: new Date().toISOString() } })`
      4. Note: `residence_verified` stays `false` until admin/OCR verifies it. The upload stores the document; verification is a separate step.
      5. Show success message: "Document uploaded. Verification pending."
    - `isUploading`: loading state during upload

    **Imports:**
    - useState from react
    - useAuth from ../hooks/useAuth
    - AnimatedGradientBg from @shared/components/AnimatedGradientBg
    - GlassCard from @shared/components/ui/GlassCard
    - Button from @shared/components/ui/Button
    - ProofOfResidence from ../components/citizen/ProofOfResidence
    - supabase from ../lib/supabase

    **NOTE:** The profile page is already auth-gated in App.tsx via ProtectedRoute (from Plan 05), so no additional auth check needed here. The user object is guaranteed to exist.
  </action>
  <verify>
    Run `cd frontend-public && npx tsc --noEmit` to verify TypeScript compiles.
    Verify ProfilePage.tsx has edit mode for name, phone, municipality.
    Verify ProofOfResidence component is rendered.
    Verify verification status badge shows at top of page.
  </verify>
  <done>
    Full citizen profile page with: name, email (readonly), phone, municipality fields. Edit/save profile functionality. Proof of residence upload with clear not-verified indicator. Verification status badge. Premium styling with animated gradient background.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend-public && npx tsc --noEmit` — TypeScript compiles with zero errors
2. ProfilePage has personal info form with edit mode
3. ProofOfResidence shows upload area when not verified, badge when verified
4. File upload targets Supabase Storage documents bucket
5. Profile updates use supabase.auth.updateUser
6. Page uses premium styling (AnimatedGradientBg, GlassCard)
</verification>

<success_criteria>
- Profile page displays all user information (name, email, phone, municipality, verification status)
- Proof of residence upload is available with clear "not verified" indicator
- Citizens can edit their profile (name, phone, municipality)
- Document upload stores file in Supabase Storage
- Page is auth-gated via ProtectedRoute in App.tsx
</success_criteria>

<output>
After completion, create `.planning/phases/06.4-dashboard-landing-pages-public-hero-polish-and-citizen-auth-architecture-on-public-portal/06.4-07-SUMMARY.md`
</output>
