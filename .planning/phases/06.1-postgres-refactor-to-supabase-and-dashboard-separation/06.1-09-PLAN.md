---
phase: 06.1-postgres-refactor-to-supabase-and-dashboard-separation
plan: 09
type: execute
wave: 6
depends_on: ["06.1-06", "06.1-08"]
files_modified:
  - frontend-public/package.json
  - frontend-public/vite.config.ts
  - frontend-public/tsconfig.app.json
  - frontend-public/src/main.tsx
  - frontend-public/src/App.tsx
  - frontend-public/src/App.css
  - frontend-public/src/pages/LandingPage.tsx
  - frontend-public/src/pages/PublicDashboardPage.tsx
  - frontend-public/src/components/Globe3D.tsx
  - frontend-public/src/components/GlobeLoadingSkeleton.tsx
  - frontend-public/src/components/landing/HeroSection.tsx
  - frontend-public/src/components/landing/ProblemSection.tsx
  - frontend-public/src/components/landing/SolutionSection.tsx
  - frontend-public/src/components/landing/FeaturesSection.tsx
  - frontend-public/src/components/landing/LiveStatsSection.tsx
  - frontend-public/src/components/landing/MunicipalityShowcase.tsx
  - frontend-public/src/components/landing/DashboardPreview.tsx
  - frontend-public/src/providers/LenisProvider.tsx
  - frontend-public/src/components/MunicipalitySelector.tsx
  - frontend-public/src/components/ResponseTimeChart.tsx
  - frontend-public/src/components/ResolutionRateChart.tsx
  - frontend-public/src/components/HeatmapViewer.tsx
  - frontend-public/src/assets/sa-municipalities.json
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Public dashboard has full scroll storytelling landing page with 7 sections"
    - "Hero section has interactive 3D South Africa globe with municipal boundaries"
    - "3D globe uses react-three-fiber with extruded GeoJSON boundaries colored by performance"
    - "3D globe has mobile optimizations: DPR cap at 2, detect-gpu LOD, mediump shaders, on-demand rendering, lazy-loaded"
    - "Globe is lazy-loaded via React.lazy + Suspense with loading skeleton"
    - "Problem statement section uses scroll-triggered text reveal (GSAP ScrollTrigger)"
    - "Features section has 3 staggered feature cards with icon animations"
    - "Live stats section has counter animations using anime.js"
    - "Municipality showcase is horizontal scroll carousel with glow cards"
    - "Dashboard preview cross-fades into live dashboard data"
    - "Lenis smooth scroll wraps the entire public app"
    - "Dark mode with navy/coral/teal palette from shared/ design tokens"
    - "Mobile-first responsive design for ALL sections"
    - "Touch-optimized scroll interactions on mobile"
    - "Page transitions use GSAP (NOT Barba.js)"
  artifacts:
    - path: "frontend-public/src/pages/LandingPage.tsx"
      provides: "Full scroll storytelling landing page assembling all 7 sections"
      contains: "HeroSection"
    - path: "frontend-public/src/components/Globe3D.tsx"
      provides: "Interactive 3D South Africa globe with municipal GeoJSON boundaries"
      contains: "Canvas"
    - path: "frontend-public/src/components/landing/HeroSection.tsx"
      provides: "Hero with 3D globe, headline animation, coral gradient"
      contains: "Globe3D"
    - path: "frontend-public/src/components/landing/LiveStatsSection.tsx"
      provides: "Counter animations for tickets resolved, municipalities, response times"
      contains: "anime"
    - path: "frontend-public/src/components/landing/MunicipalityShowcase.tsx"
      provides: "Horizontal scroll carousel of pilot municipality glow cards"
      contains: "horizontal"
    - path: "frontend-public/src/providers/LenisProvider.tsx"
      provides: "Lenis smooth scroll provider synced with GSAP"
      contains: "ReactLenis"
    - path: "frontend-public/src/assets/sa-municipalities.json"
      provides: "Simplified South Africa municipal boundary GeoJSON for 3D globe"
      contains: "FeatureCollection"
  key_links:
    - from: "frontend-public/src/App.tsx"
      to: "shared/design-tokens.css"
      via: "CSS import at app root for dark mode tokens"
      pattern: "import.*shared/design-tokens"
    - from: "frontend-public/src/components/Globe3D.tsx"
      to: "frontend-public/src/assets/sa-municipalities.json"
      via: "GeoJSON import for extruded 3D boundaries"
      pattern: "sa-municipalities"
    - from: "frontend-public/src/components/landing/HeroSection.tsx"
      to: "frontend-public/src/components/Globe3D.tsx"
      via: "React.lazy for code-split 3D globe loading"
      pattern: "React\\.lazy"
    - from: "frontend-public/src/providers/LenisProvider.tsx"
      to: "gsap"
      via: "GSAP ticker sync for ScrollTrigger"
      pattern: "gsap\\.ticker\\.add"
    - from: "frontend-public/src/pages/LandingPage.tsx"
      to: "frontend-public/src/pages/PublicDashboardPage.tsx"
      via: "Dashboard preview section cross-fades into actual dashboard"
      pattern: "PublicDashboardPage"
---

<objective>
Add the premium UI design layer to the public dashboard (frontend-public/): a full scroll storytelling landing page with 7 animated sections, an interactive 3D South Africa globe with municipal GeoJSON boundaries, mobile-first responsive design with 3D performance optimizations, and dark mode styling using shared/ design tokens.

Purpose: Plan 06 created a functional public dashboard with basic React. This plan adds the "wow factor" — a cinematic landing page that tells the story of municipal transparency, an interactive 3D globe showing SA municipalities colored by service performance, counter animations, horizontal scroll carousels, and GSAP scroll-triggered reveals. The landing page flows into the live dashboard data for a seamless experience.

Output: Fully animated public dashboard with landing page, interactive 3D SA globe, mobile-first responsive design, dark mode, and GSAP scroll storytelling.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06.1-postgres-refactor-to-supabase-and-dashboard-separation/06.1-CONTEXT.md
@.planning/phases/06.1-postgres-refactor-to-supabase-and-dashboard-separation/06.1-UI-RESEARCH.md
@.planning/phases/06.1-postgres-refactor-to-supabase-and-dashboard-separation/06.1-06-SUMMARY.md
@.planning/phases/06.1-postgres-refactor-to-supabase-and-dashboard-separation/06.1-08-SUMMARY.md
@frontend-public/package.json
@frontend-public/src/App.tsx
@frontend-public/src/pages/PublicDashboardPage.tsx
@shared/design-tokens.css
@shared/tokens.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install libraries, create Lenis provider, build interactive 3D SA globe component</name>
  <files>
    frontend-public/package.json
    frontend-public/vite.config.ts
    frontend-public/tsconfig.app.json
    frontend-public/src/providers/LenisProvider.tsx
    frontend-public/src/components/Globe3D.tsx
    frontend-public/src/components/GlobeLoadingSkeleton.tsx
    frontend-public/src/assets/sa-municipalities.json
  </files>
  <action>
    **Step 1: Install animation and 3D libraries in frontend-public/**
    Run: `cd frontend-public && npm install gsap @gsap/react lenis animejs @react-three/fiber @react-three/drei detect-gpu three three-geojson-geometry d3-geo topojson-client topojson-simplify`
    Run: `cd frontend-public && npm install -D @types/three @types/d3-geo @types/topojson-client @types/topojson-simplify`

    **Step 2: Update vite.config.ts with shared/ alias**
    Same pattern as Plan 08:
    ```typescript
    import { defineConfig } from 'vite';
    import react from '@vitejs/plugin-react';
    import path from 'path';

    export default defineConfig({
      plugins: [react()],
      resolve: {
        alias: {
          '@shared': path.resolve(__dirname, '../shared'),
        },
      },
      build: {
        rollupOptions: {
          output: {
            manualChunks: {
              three: ['three', '@react-three/fiber', '@react-three/drei'],
              animations: ['gsap', '@gsap/react', 'lenis', 'animejs'],
            },
          },
        },
      },
    });
    ```
    Also update tsconfig.app.json with path alias and shared/ include (same as Plan 08).

    **Step 3: Create LenisProvider.tsx for public app**
    Same pattern as Plan 08 but with mobile touch optimizations per user decision:
    ```typescript
    import { ReactLenis } from 'lenis/react';
    import { useEffect } from 'react';
    import gsap from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';

    gsap.registerPlugin(ScrollTrigger);

    export function LenisProvider({ children }: { children: React.ReactNode }) {
      useEffect(() => {
        const lenis = (document.querySelector('[data-lenis-root]') as any)?.__lenis;
        if (lenis) {
          lenis.on('scroll', ScrollTrigger.update);
          gsap.ticker.add((time: number) => lenis.raf(time * 1000));
          gsap.ticker.lagSmoothing(0);
        }
      }, []);

      return (
        <ReactLenis root options={{
          lerp: 0.1,
          duration: 1.2,
          smoothWheel: true,
          syncTouch: true,        // Enable touch inertia on mobile
          touchMultiplier: 2,     // Increase touch sensitivity
        }}>
          {children}
        </ReactLenis>
      );
    }
    ```

    **Step 4: Create SA municipality GeoJSON asset**
    Create `frontend-public/src/assets/sa-municipalities.json` — a simplified South Africa provincial/municipal boundary GeoJSON. This should be a valid GeoJSON FeatureCollection with at minimum South Africa's 9 provinces as Feature objects, each with:
    - `properties.name` (province name)
    - `properties.code` (province code: EC, FS, GP, KZN, LP, MP, NW, NC, WC)
    - `geometry` of type Polygon or MultiPolygon with simplified coordinates

    Approach: Download from https://mapit.code4sa.org/ or https://simplemaps.com/gis/country/za during execution. If download fails, create a simplified hand-coded GeoJSON with approximate provincial outlines (enough for visual representation). Use topojson-simplify to reduce vertex count by 70% for mobile performance.

    The GeoJSON must be small enough for mobile (<100KB after simplification). If the raw file is larger, simplify during build or at import time:
    ```typescript
    import { presimplify, simplify } from 'topojson-simplify';
    import { topology } from 'topojson-client';
    ```

    **Step 5: Create Globe3D.tsx — Interactive 3D South Africa globe**
    This is the hero component. Build with react-three-fiber:
    ```typescript
    // frontend-public/src/components/Globe3D.tsx
    import { useRef, useMemo, useState, useEffect, useCallback } from 'react';
    import { Canvas, useFrame, useThree } from '@react-three/fiber';
    import { OrbitControls, Detailed } from '@react-three/drei';
    import { getGPUTier } from 'detect-gpu';
    import * as THREE from 'three';
    import { geoMercator } from 'd3-geo';
    import saGeoJSON from '../assets/sa-municipalities.json';

    // GPU tier detection for LOD
    function useGPUTier() {
      const [tier, setTier] = useState(2);
      useEffect(() => {
        getGPUTier().then(result => setTier(result.tier));
      }, []);
      return tier;
    }

    // Convert GeoJSON polygon to Three.js ExtrudeGeometry
    function createExtrudedMesh(feature: any, projection: any, height: number, color: string) {
      // Project each coordinate ring through d3-geo projection
      // Create THREE.Shape from projected coords
      // Return ExtrudeGeometry with depth = height
      // Color based on service performance metric
    }

    // Main SA Map component
    function SAMap({ gpuTier, onHover, onClick }: Props) {
      const groupRef = useRef<THREE.Group>(null);
      const projection = useMemo(() =>
        geoMercator().center([25, -29]).scale(600).translate([0, 0]),
        []
      );

      useFrame((_, delta) => {
        if (groupRef.current) {
          groupRef.current.rotation.y += delta * 0.05; // Slow auto-rotate
        }
      });

      const meshes = useMemo(() => {
        return saGeoJSON.features.map((feature: any, i: number) => {
          const extrudeHeight = 0.1 + Math.random() * 0.3; // Replace with real performance data
          const hue = feature.properties.performance ?? 0.5;
          const color = hue > 0.7 ? '#00D9A6' : hue > 0.4 ? '#FBBF24' : '#FF6B4A';
          return createExtrudedMesh(feature, projection, extrudeHeight, color);
        });
      }, [projection, gpuTier]);

      return (
        <group ref={groupRef}>
          {meshes}
        </group>
      );
    }

    // Interactive hover/click with raycasting
    // Add pointer events to each mesh:
    // onPointerOver: highlight mesh (emissive glow), show tooltip with municipality name
    // onPointerOut: remove highlight
    // onClick: could scroll to municipality stats in dashboard below

    interface Globe3DProps {
      className?: string;
      onMunicipalityClick?: (code: string) => void;
    }

    export default function Globe3D({ className, onMunicipalityClick }: Globe3DProps) {
      const gpuTier = useGPUTier();
      const [hovered, setHovered] = useState<string | null>(null);

      return (
        <div className={className} style={{ width: '100%', height: '100%' }}>
          <Canvas
            dpr={[1, Math.min(window.devicePixelRatio, 2)]}  // DPR cap at 2 for mobile
            frameloop="demand"                                 // On-demand rendering
            camera={{ position: [0, 0, 5], fov: 45 }}
            gl={{
              precision: 'mediump',                           // mediump shaders for mobile
              antialias: gpuTier >= 2,                        // Disable AA on low-end
              powerPreference: 'high-performance',
            }}
          >
            <ambientLight intensity={0.4} />
            <directionalLight position={[5, 5, 5]} intensity={0.8} color="#FF6B4A" />
            <directionalLight position={[-5, -3, -5]} intensity={0.3} color="#00D9A6" />

            <SAMap
              gpuTier={gpuTier}
              onHover={setHovered}
              onClick={onMunicipalityClick}
            />

            <OrbitControls
              enableZoom={false}
              enablePan={false}
              autoRotate
              autoRotateSpeed={0.5}
              minPolarAngle={Math.PI / 3}
              maxPolarAngle={Math.PI / 1.5}
            />
          </Canvas>
          {hovered && (
            <div style={{
              position: 'absolute',
              bottom: 20,
              left: '50%',
              transform: 'translateX(-50%)',
              padding: '8px 16px',
              background: 'var(--glass-bg)',
              backdropFilter: 'blur(10px)',
              border: '1px solid var(--glass-border)',
              borderRadius: '8px',
              color: 'var(--text-primary)',
              fontSize: '14px',
            }}>
              {hovered}
            </div>
          )}
        </div>
      );
    }
    ```

    **MOBILE PERFORMANCE OPTIMIZATIONS (all per user locked decisions):**
    1. `dpr={[1, Math.min(window.devicePixelRatio, 2)]}` — Cap DPR at 2 (mobile phones report 3x but 2x is visually identical)
    2. `frameloop="demand"` — Only re-render on interaction/animation (huge battery savings)
    3. `precision: 'mediump'` — mediump shaders for colors/normals (2x faster than highp on mobile GPUs)
    4. `detect-gpu` for LOD: tier 0-1 gets simplified geometry, no antialiasing; tier 2+ gets full detail
    5. Lazy-loaded via `React.lazy(() => import('./Globe3D'))` in HeroSection (Three.js bundle only loads when hero viewport enters)
    6. GeoJSON pre-simplified via topojson-simplify (reduce vertex count by 70%)

    **Step 6: Create GlobeLoadingSkeleton.tsx**
    ```typescript
    // frontend-public/src/components/GlobeLoadingSkeleton.tsx
    export function GlobeLoadingSkeleton() {
      return (
        <div style={{
          width: '100%',
          height: '100%',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          background: 'radial-gradient(ellipse, rgba(0, 217, 166, 0.1), transparent)',
        }}>
          <div style={{
            width: 200,
            height: 200,
            borderRadius: '50%',
            background: 'linear-gradient(135deg, rgba(255, 107, 74, 0.2), rgba(0, 217, 166, 0.2))',
            animation: 'glowPulse 2s ease-in-out infinite',
          }} />
        </div>
      );
    }
    ```
  </action>
  <verify>
    - `cd frontend-public && npm ls gsap @gsap/react lenis animejs @react-three/fiber @react-three/drei detect-gpu three` shows all installed
    - File `frontend-public/src/assets/sa-municipalities.json` exists with "FeatureCollection"
    - File `frontend-public/src/components/Globe3D.tsx` exists with "Canvas" and "dpr" and "mediump" and "demand"
    - File `frontend-public/src/providers/LenisProvider.tsx` exists with "ReactLenis" and "syncTouch"
    - `cd frontend-public && npx tsc --noEmit` succeeds
  </verify>
  <done>
    Animation libraries installed. Lenis provider with mobile touch optimization created. Interactive 3D South Africa globe built with react-three-fiber, extruded GeoJSON boundaries, performance-color-coded municipalities, hover/click interactivity, and full mobile optimization suite (DPR cap, on-demand rendering, mediump shaders, detect-gpu LOD, lazy loading). Globe loading skeleton created.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build scroll storytelling landing page with 7 animated sections and apply dark mode</name>
  <files>
    frontend-public/src/main.tsx
    frontend-public/src/App.tsx
    frontend-public/src/App.css
    frontend-public/src/pages/LandingPage.tsx
    frontend-public/src/pages/PublicDashboardPage.tsx
    frontend-public/src/components/landing/HeroSection.tsx
    frontend-public/src/components/landing/ProblemSection.tsx
    frontend-public/src/components/landing/SolutionSection.tsx
    frontend-public/src/components/landing/FeaturesSection.tsx
    frontend-public/src/components/landing/LiveStatsSection.tsx
    frontend-public/src/components/landing/MunicipalityShowcase.tsx
    frontend-public/src/components/landing/DashboardPreview.tsx
    frontend-public/src/components/MunicipalitySelector.tsx
    frontend-public/src/components/ResponseTimeChart.tsx
    frontend-public/src/components/ResolutionRateChart.tsx
    frontend-public/src/components/HeatmapViewer.tsx
  </files>
  <action>
    **Step 1: Create HeroSection.tsx — Full-viewport 3D globe with headline**
    ```typescript
    // frontend-public/src/components/landing/HeroSection.tsx
    import React, { Suspense, useRef } from 'react';
    import gsap from 'gsap';
    import { useGSAP } from '@gsap/react';
    import { GlobeLoadingSkeleton } from '../GlobeLoadingSkeleton';

    const Globe3D = React.lazy(() => import('../Globe3D'));

    gsap.registerPlugin(useGSAP);

    export function HeroSection() {
      const sectionRef = useRef<HTMLDivElement>(null);
      const headlineRef = useRef<HTMLHeadingElement>(null);
      const subtitleRef = useRef<HTMLParagraphElement>(null);

      useGSAP(() => {
        const tl = gsap.timeline();
        tl.from(headlineRef.current, {
          y: 80, opacity: 0, duration: 1.2, ease: 'power3.out'
        })
        .from(subtitleRef.current, {
          y: 40, opacity: 0, duration: 0.8, ease: 'power2.out'
        }, '-=0.5');
      }, { scope: sectionRef });

      return (
        <section ref={sectionRef} className="hero-section">
          {/* Full viewport with 3D globe as background */}
          <div className="hero-globe-container">
            <Suspense fallback={<GlobeLoadingSkeleton />}>
              <Globe3D />
            </Suspense>
          </div>
          <div className="hero-content">
            <h1 ref={headlineRef} className="hero-headline">
              Transparent Municipal Services.<br />
              <span className="text-coral">For Every Citizen.</span>
            </h1>
            <p ref={subtitleRef} className="hero-subtitle">
              Track service delivery, hold municipalities accountable, and see real results across South Africa.
            </p>
            <a href="#dashboard" className="hero-cta">
              View Dashboard
            </a>
          </div>
          {/* Coral gradient overlay at bottom */}
          <div className="hero-gradient-overlay" />
        </section>
      );
    }
    ```
    CSS: height: 100vh, position: relative, overflow: hidden. Globe container absolute inset with opacity 0.7. Hero content centered with z-index above globe. Headline uses display font (Clash Display). Text-coral class uses var(--color-coral). On mobile: globe renders at reduced quality (handled by Globe3D internal detect-gpu), text sizes scale down, CTA button full-width.

    **Step 2: Create ProblemSection.tsx — Scroll-triggered text reveal**
    ```typescript
    // Uses GSAP ScrollTrigger for text reveal on scroll
    import { useRef } from 'react';
    import gsap from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';
    import { useGSAP } from '@gsap/react';

    gsap.registerPlugin(ScrollTrigger);

    export function ProblemSection() {
      const sectionRef = useRef<HTMLDivElement>(null);

      useGSAP(() => {
        const lines = sectionRef.current?.querySelectorAll('.reveal-line');
        lines?.forEach((line, i) => {
          gsap.from(line, {
            y: 60,
            opacity: 0,
            duration: 0.8,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: line,
              start: 'top 85%',
              toggleActions: 'play none none reverse',
            },
          });
        });
      }, { scope: sectionRef });

      return (
        <section ref={sectionRef} className="problem-section">
          <div className="problem-content">
            <p className="reveal-line problem-text-large">Municipal services are broken.</p>
            <p className="reveal-line problem-text-large">Citizens are unheard.</p>
            <p className="reveal-line problem-text-detail">
              Reports disappear into bureaucracy. Response times are measured in weeks, not hours.
              There is no visibility into whether anything is being done.
            </p>
          </div>
        </section>
      );
    }
    ```
    CSS: Min-height 80vh, centered text, large font sizes (3rem mobile, 4.5rem desktop). Text color var(--text-primary) with coral accent on key words.

    **Step 3: Create SolutionSection.tsx — Split-screen scroll transition**
    Left side shows problem (faded), right side shows solution (bright). On scroll, the problem side fades and solution slides in.
    Uses GSAP ScrollTrigger with `scrub: true` for scroll-linked animation.
    On mobile: stacks vertically (problem on top fades out, solution below fades in).

    **Step 4: Create FeaturesSection.tsx — 3 staggered feature cards**
    Three cards: "Report", "Track", "Transparency". Each staggered in with GSAP:
    ```typescript
    useGSAP(() => {
      gsap.from('.feature-card', {
        y: 80,
        opacity: 0,
        duration: 0.8,
        stagger: 0.2,
        ease: 'back.out(1.7)',
        scrollTrigger: {
          trigger: '.features-grid',
          start: 'top 75%',
        },
      });
    }, { scope: sectionRef });
    ```
    Each card has: icon (SVG), title, description. Cards use glassmorphism (var(--glass-bg), backdrop-filter). On hover: glow effect (coral for Report, teal for Track, violet for Transparency). On mobile: single-column stack.

    **Step 5: Create LiveStatsSection.tsx — anime.js counter animations**
    Three animated counters triggered on viewport enter:
    ```typescript
    import anime from 'animejs';

    // Use IntersectionObserver to trigger only when section enters viewport
    useEffect(() => {
      const observer = new IntersectionObserver(([entry]) => {
        if (entry.isIntersecting && !hasAnimated.current) {
          hasAnimated.current = true;

          anime({
            targets: '.counter-tickets',
            innerHTML: [0, 12847],
            round: 1,
            duration: 2500,
            easing: 'easeOutExpo',
          });

          anime({
            targets: '.counter-municipalities',
            innerHTML: [0, 5],
            round: 1,
            duration: 2000,
            easing: 'easeOutExpo',
          });

          anime({
            targets: '.counter-response',
            innerHTML: [0, 73],
            round: 1,
            duration: 2200,
            easing: 'easeOutExpo',
          });
        }
      }, { threshold: 0.3 });

      if (sectionRef.current) observer.observe(sectionRef.current);
      return () => observer.disconnect();
    }, []);
    ```
    Display: "12,847 Tickets Resolved", "5 Pilot Municipalities", "73% Faster Response". Number format with commas. On mobile: stack vertically with full-width stat blocks.

    NOTE: The counter target values (12847, 5, 73) are hardcoded defaults. In production, these would come from the Supabase public stats hooks. Use the hooks if data is available, fall back to these defaults.

    **Step 6: Create MunicipalityShowcase.tsx — Horizontal scroll carousel**
    ```typescript
    // Horizontal scroll carousel of pilot municipality cards
    // Uses CSS scroll-snap for native touch scrolling
    // Each card: municipality name, stats summary, glow effect on hover
    // On desktop: horizontal scroll area with arrow buttons
    // On mobile: horizontal swipeable cards (scroll-snap-type: x mandatory)
    ```
    Cards use glassmorphism + glow-teal effect. GSAP stagger animation on viewport enter. Each card shows: municipality name, total tickets, avg response time, resolution rate. On mobile: cards take ~85vw width for easy swipe.

    **Step 7: Create DashboardPreview.tsx — Cross-fade into live dashboard**
    This section uses GSAP ScrollTrigger `scrub` to gradually cross-fade from a stylized dashboard preview into the actual PublicDashboardPage component:
    ```typescript
    useGSAP(() => {
      gsap.fromTo('.dashboard-preview-overlay', {
        opacity: 1,
      }, {
        opacity: 0,
        scrollTrigger: {
          trigger: '.dashboard-preview-section',
          start: 'top 50%',
          end: 'bottom 30%',
          scrub: true,
        },
      });
    }, { scope: sectionRef });
    ```
    The overlay is a styled mockup that fades away to reveal the real dashboard data. On mobile: simpler fade transition (no complex overlay).

    **Step 8: Create LandingPage.tsx — Assemble all 7 sections**
    ```typescript
    // frontend-public/src/pages/LandingPage.tsx
    import { HeroSection } from '../components/landing/HeroSection';
    import { ProblemSection } from '../components/landing/ProblemSection';
    import { SolutionSection } from '../components/landing/SolutionSection';
    import { FeaturesSection } from '../components/landing/FeaturesSection';
    import { LiveStatsSection } from '../components/landing/LiveStatsSection';
    import { MunicipalityShowcase } from '../components/landing/MunicipalityShowcase';
    import { DashboardPreview } from '../components/landing/DashboardPreview';

    export function LandingPage() {
      return (
        <main className="landing-page">
          <HeroSection />
          <ProblemSection />
          <SolutionSection />
          <FeaturesSection />
          <LiveStatsSection />
          <MunicipalityShowcase />
          <DashboardPreview />
        </main>
      );
    }
    ```

    **Step 9: Update App.tsx — Landing page + dashboard routing**
    Change from single-page dashboard to landing-first with scroll into dashboard:
    ```typescript
    import { LenisProvider } from './providers/LenisProvider';
    import { LandingPage } from './pages/LandingPage';
    import { PublicDashboardPage } from './pages/PublicDashboardPage';
    import '@shared/design-tokens.css';
    import '@shared/animations.css';

    function App() {
      return (
        <LenisProvider>
          <div className="App">
            <LandingPage />
            <section id="dashboard" className="dashboard-section">
              <PublicDashboardPage />
            </section>
            <footer className="site-footer">
              <p>SALGA Trust Engine -- Transparent municipal service delivery</p>
              <p className="privacy-notice">
                GBV and sensitive reports are excluded from all public statistics.
              </p>
            </footer>
          </div>
        </LenisProvider>
      );
    }
    ```
    The landing flows directly into the dashboard via scroll. The DashboardPreview cross-fades into the actual dashboard section. The hero CTA "View Dashboard" scrolls to #dashboard anchor.

    **Step 10: Restyle App.css — Full dark mode with mobile-first responsive design**
    Import shared tokens and apply dark mode to ALL components:
    - `@import '../../shared/design-tokens.css';` and `@import '../../shared/animations.css';`
    - html, body: background var(--surface-base), color var(--text-primary), font-family var(--font-body)
    - All chart containers: dark backgrounds, themed axis labels (var(--chart-axis-text))
    - Recharts overrides: set fill/stroke colors to chart palette variables
    - Leaflet heatmap container: dark tile layer (use CartoDB dark_all tiles instead of default OSM for dark mode)
    - Municipality selector: dark dropdown with var(--surface-elevated), border var(--border-subtle)

    **MOBILE-FIRST responsive design (per user locked decision):**
    Base styles target mobile (320px+). Progressive enhancement for larger screens:
    ```css
    /* Mobile-first base */
    .hero-headline { font-size: 2rem; }
    .feature-card { width: 100%; }
    .stats-grid { grid-template-columns: 1fr; }
    .showcase-carousel { scroll-snap-type: x mandatory; }

    /* Tablet (768px+) */
    @media (min-width: 768px) {
      .hero-headline { font-size: 3.5rem; }
      .features-grid { grid-template-columns: repeat(2, 1fr); }
      .stats-grid { grid-template-columns: repeat(3, 1fr); }
    }

    /* Desktop (1024px+) */
    @media (min-width: 1024px) {
      .hero-headline { font-size: 4.5rem; }
      .features-grid { grid-template-columns: repeat(3, 1fr); }
      .solution-section { flex-direction: row; } /* side-by-side */
    }
    ```

    **Step 11: Restyle existing dashboard components for dark mode**
    Update PublicDashboardPage.tsx, MunicipalitySelector.tsx, ResponseTimeChart.tsx, ResolutionRateChart.tsx, HeatmapViewer.tsx:
    - Apply dark mode class names from App.css
    - Update Recharts theme: set fill colors to var(--chart-primary), var(--chart-secondary), grid to var(--chart-grid)
    - Update Leaflet tile URL to CartoDB dark_all: `https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png` (instead of default OSM)
    - Add glow effects to chart containers on hover
    - Ensure all text is readable against dark backgrounds (use WCAG AA contrast ratios from research)
    - Municipality selector: dark themed dropdown
  </action>
  <verify>
    - `cd frontend-public && npm run build` succeeds with no errors
    - `cd frontend-public && npx tsc --noEmit` succeeds
    - Grep for "Barba" in frontend-public/ returns 0 matches
    - Grep for "React.lazy" in HeroSection.tsx confirms code-split globe
    - Grep for "anime" in LiveStatsSection.tsx confirms counter animations
    - Grep for "ScrollTrigger" in ProblemSection.tsx confirms scroll-triggered reveals
    - Grep for "scroll-snap" in App.css confirms horizontal carousel
    - Grep for "@shared/design-tokens" in App.css or App.tsx confirms token import
    - Grep for "dark_all" in HeatmapViewer.tsx confirms dark mode tiles
    - Grep for "syncTouch" in LenisProvider.tsx confirms mobile touch optimization
    - Mobile-first check: base CSS uses single-column layouts, media queries add columns
  </verify>
  <done>
    Full scroll storytelling landing page with 7 animated sections: hero (3D globe + headline), problem (scroll-reveal), solution (split-screen), features (3 staggered cards), live stats (anime.js counters), municipality showcase (horizontal carousel), dashboard preview (cross-fade). Dark mode applied to all components. Mobile-first responsive design with touch-optimized scroll. Leaflet dark tiles. Build succeeds.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend-public && npm run build` succeeds
2. Landing page has 7 distinct animated sections in correct order
3. 3D globe loads lazily (React.lazy + Suspense) with loading skeleton
4. Globe has all mobile optimizations: DPR cap, on-demand rendering, mediump, detect-gpu
5. Problem section text reveals on scroll (GSAP ScrollTrigger)
6. Feature cards stagger in with glow effects
7. Live stats counters animate with anime.js on viewport enter
8. Municipality showcase is horizontally scrollable carousel
9. Dashboard preview cross-fades into real dashboard data
10. Lenis smooth scroll wraps entire app with mobile touch settings
11. Dark mode applied: background #0A0E1A, text #E8E8EC, dark Leaflet tiles
12. Mobile-first CSS: base = mobile, media queries add complexity
13. NO Barba.js references anywhere
14. shared/ design tokens imported and used
15. TypeScript compiles with zero errors
</verification>

<success_criteria>
- Full scroll storytelling landing page with 7 sections (hero, problem, solution, features, stats, showcase, preview)
- Interactive 3D SA globe with GeoJSON municipalities, hover/click, performance-color-coded
- Globe mobile optimizations: DPR 2 cap, detect-gpu LOD, mediump shaders, on-demand rendering, lazy-loaded
- GSAP ScrollTrigger for scroll-driven animations (NOT Barba.js)
- anime.js counter animations on live stats
- Horizontal scroll carousel for municipality showcase
- Cross-fade from landing into live dashboard
- Lenis smooth scroll with mobile touch support
- Dark mode from shared/ tokens
- Mobile-first responsive (base mobile, media queries up)
- Dark Leaflet tiles (CartoDB dark_all)
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-postgres-refactor-to-supabase-and-dashboard-separation/06.1-09-SUMMARY.md`
</output>
