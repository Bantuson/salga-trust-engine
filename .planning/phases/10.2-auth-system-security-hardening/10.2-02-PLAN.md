---
phase: 10.2-auth-system-security-hardening
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend-public/src/pages/CitizenRegisterPage.tsx
  - frontend-public/src/pages/CitizenLoginPage.tsx
  - frontend-dashboard/src/pages/RegisterPage.tsx
  - frontend-dashboard/src/pages/LoginPage.tsx
autonomous: false
requirements:
  - SEC-01
  - SEC-02
  - SEC-04

must_haves:
  truths:
    - "All four registration/login forms display password requirements hint (min 12 chars, uppercase, lowercase, digit)"
    - "Frontend password validation matches backend (12 char minimum, complexity) with inline error messages"
    - "Supabase Dashboard password policy is documented and verified by human"
    - "Supabase Dashboard OTP expiry setting is documented and verified by human"
    - "email_confirm: True workaround status is assessed and documented"
  artifacts:
    - path: "frontend-public/src/pages/CitizenRegisterPage.tsx"
      provides: "Client-side password validation matching backend policy"
      contains: "12"
    - path: "frontend-dashboard/src/pages/RegisterPage.tsx"
      provides: "Client-side password validation matching backend policy"
      contains: "12"
  key_links:
    - from: "frontend-public/src/pages/CitizenRegisterPage.tsx"
      to: "src/schemas/user.py"
      via: "Password validation rules match (both enforce 12 chars + complexity)"
      pattern: "12.*uppercase.*lowercase.*digit"
---

<objective>
Add client-side password validation to match the strengthened backend policy and verify Supabase Dashboard security settings.

Purpose: Password complexity rules must be enforced client-side for immediate UX feedback (before the Supabase or FastAPI server rejects the password). Supabase Dashboard settings (OTP expiry, password policy) need human verification since they cannot be automated via CLI. The email_confirm workaround from Phase 10.1 needs assessment.

Output: All four auth pages (2 register, 2 login) display password requirements and validate client-side. Supabase Dashboard configuration verified via checkpoint.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10.2-auth-system-security-hardening/10.2-RESEARCH.md
@frontend-public/src/pages/CitizenRegisterPage.tsx
@frontend-public/src/pages/CitizenLoginPage.tsx
@frontend-dashboard/src/pages/RegisterPage.tsx
@frontend-dashboard/src/pages/LoginPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add client-side password validation to all auth pages</name>
  <files>
    frontend-public/src/pages/CitizenRegisterPage.tsx,
    frontend-public/src/pages/CitizenLoginPage.tsx,
    frontend-dashboard/src/pages/RegisterPage.tsx,
    frontend-dashboard/src/pages/LoginPage.tsx
  </files>
  <action>
**Add a `validatePassword()` helper and password requirements UI to all registration pages.**

For BOTH registration pages (CitizenRegisterPage.tsx and RegisterPage.tsx):

1. Add a local `validatePassword(password: string)` function that returns an object `{ valid: boolean; errors: string[] }`:
   - Check length >= 12: error "At least 12 characters"
   - Check `/[A-Z]/`: error "At least one uppercase letter"
   - Check `/[a-z]/`: error "At least one lowercase letter"
   - Check `/\d/`: error "At least one digit"
   - `valid` is true only when errors array is empty

2. Below the password input field, add a password requirements hint block that shows:
   - A list of requirements with visual indicators (checkmark or bullet) showing which are met as the user types
   - Use inline styles matching the existing glassmorphic design (subtle text, ~0.7 opacity)
   - Requirements text: "12+ characters", "Uppercase letter", "Lowercase letter", "Number"
   - Color each requirement green (met) or default gray (unmet) as user types

3. Disable the submit button if password validation fails (in addition to any existing disabled conditions)

4. If the form currently shows server-side errors, ensure the new client-side validation does NOT conflict — run client validation first, only submit to server if client validation passes.

For BOTH login pages (CitizenLoginPage.tsx and LoginPage.tsx):
- No password validation needed on login (existing passwords may predate the new policy)
- No changes needed

**Style notes:**
- Use inline styles consistent with existing form styling in each page
- Requirements hint should be small text (~12px) below the password field
- Green (#4ade80) for met requirements, gray with reduced opacity for unmet
- Do not add any new npm dependencies
  </action>
  <verify>
    <automated>cd C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-public && npm run build:check 2>&1 | tail -5 && cd ../frontend-dashboard && npm run build:check 2>&1 | tail -5</automated>
    <manual>Both frontends compile without TypeScript errors. Registration pages show password requirements hint.</manual>
  </verify>
  <done>Both registration pages display real-time password requirement indicators. Submit button disabled when password fails validation. Login pages unchanged. Both apps build clean.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify Supabase Dashboard security settings</name>
  <files>N/A — Supabase Dashboard configuration (no code files)</files>
  <action>
Human verifies and configures Supabase Dashboard security settings. Backend password validation (Plan 01) and frontend password requirements UI (Task 1 above) are in place. Now verify the Supabase Dashboard side to complete the auth hardening.
  </action>
  <verify>Human checkpoint — see how-to-verify steps below</verify>
  <done>Supabase Dashboard settings verified and configured per security hardening checklist. Plan tier, SMTP status, and email_confirm decision documented.</done>
  <what-built>
Backend password validation (Plan 01) and frontend password requirements UI (Task 1 above) are in place. Now verify the Supabase Dashboard side to complete the auth hardening.
  </what-built>
  <how-to-verify>
**Check and configure these Supabase Dashboard settings:**

1. **Go to Supabase Dashboard > Authentication > Providers > Email:**
   - Confirm "Enable email confirmations" is ON
   - Confirm "OTP Length" is 8 digits (set in Phase 10.1)
   - Check current "OTP Expiry" — set to 600 seconds (10 minutes) if currently higher

2. **Go to Supabase Dashboard > Authentication > Advanced:**
   - Check "JWT expiry" — should be 3600 seconds (1 hour, the default)
   - Verify refresh token reuse interval is default (10 seconds)

3. **Go to Supabase Dashboard > Authentication > Passwords** (if available on your plan):
   - Set "Minimum password length" to 12
   - Enable "Require lowercase letter"
   - Enable "Require uppercase letter"
   - Enable "Require digits"
   - Leave "Require symbols" OFF
   - If on Pro Plan: enable "Check against HaveIBeenPwned", set "Prevent reuse of last N passwords" to 5

4. **Go to Supabase Dashboard > Authentication > Sessions** (if available on your plan):
   - If Pro Plan: set "Inactivity timeout" to 24 hours
   - Note: Session time-boxing and single-session enforcement are Pro Plan features
   - If on Free Plan: note that JWT expiry (1 hour) + client autoRefreshToken is the effective session control

5. **Assess `email_confirm: True` workaround:**
   - In `src/api/v1/auth.py` line 109, `email_confirm: True` auto-confirms users
   - This was set to work around the email delivery issue from Phase 10.1
   - **If custom SMTP is now configured:** This should be changed to `email_confirm: False` so users must verify email
   - **If SMTP is NOT yet configured:** Leave as-is and note as a remaining hardening item

**Report back:**
- Which plan (Free/Pro) the project is on
- Whether SMTP is configured
- What OTP expiry was set to
- Whether password policy settings were available and applied
- Whether `email_confirm` should be changed
  </how-to-verify>
  <resume-signal>Type "dashboard verified" followed by your findings (plan tier, SMTP status, settings applied, email_confirm decision)</resume-signal>
</task>

</tasks>

<verification>
1. Both frontend apps build without errors: `cd frontend-public && npm run build && cd ../frontend-dashboard && npm run build`
2. Registration pages show password requirements with real-time validation
3. Supabase Dashboard settings verified by human checkpoint
4. Plan tier limitations documented
</verification>

<success_criteria>
- Both registration pages enforce 12-char minimum with complexity indicators
- Both registration pages disable submit on invalid password
- Supabase Dashboard OTP expiry confirmed at 600s
- Supabase Dashboard password policy settings documented (applied if available on plan)
- email_confirm workaround status assessed and decision documented
- Both frontend apps build successfully
</success_criteria>

<output>
After completion, create `.planning/phases/10.2-auth-system-security-hardening/10.2-02-SUMMARY.md`
</output>
