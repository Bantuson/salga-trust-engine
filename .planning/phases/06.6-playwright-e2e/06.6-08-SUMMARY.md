---
phase: 06.6-playwright-e2e
plan: 08
subsystem: UI/UX
tags: [design-tokens, readability, error-handling, auth, glassmorphism]
dependency_graph:
  requires: [06.6-06-PLAN.md]
  provides: [increased-glass-opacity, retry-logic, stale-token-handling]
  affects: [shared/design-tokens.css, frontend-dashboard, frontend-public]
tech_stack:
  added: []
  patterns: [exponential-backoff, graceful-degradation, text-shadow]
key_files:
  created: []
  modified:
    - shared/design-tokens.css
    - frontend-dashboard/src/App.css
    - frontend-dashboard/src/components/dashboard/MetricsCards.tsx
    - frontend-dashboard/src/pages/DashboardPage.tsx
    - frontend-dashboard/src/pages/TicketListPage.tsx
    - frontend-public/src/App.css
    - frontend-public/src/pages/ReportIssuePage.tsx
    - frontend-public/src/pages/TransparencyDashboardPage.tsx
    - frontend-public/src/contexts/AuthContext.tsx
decisions:
  - title: "Increased glass opacity from 0.25 to 0.35"
    rationale: "Text-heavy content over Johannesburg skyline photo requires stronger frosting for readability while preserving glassmorphism aesthetic"
    alternatives: ["Add dark overlay", "Use solid backgrounds"]
    chosen: "Increase opacity and blur"
  - title: "MAX_RETRIES set to 3 with exponential backoff (1s, 2s, 4s)"
    rationale: "Prevents infinite retry loop while giving reasonable retry attempts. Exponential backoff reduces server load during outages."
    alternatives: ["Linear backoff", "No retries", "Infinite retries with circuit breaker"]
    chosen: "3 retries with exponential backoff"
  - title: "Stale auth tokens logged as warning, not error"
    rationale: "Invalid refresh tokens are expected when sessions expire. Warning-level logging reduces console noise while maintaining visibility."
    alternatives: ["Silent fail", "Error-level logging", "User notification"]
    chosen: "Warning with automatic cleanup"
metrics:
  duration_seconds: 921
  duration_minutes: 15.4
  tasks_completed: 4
  files_modified: 9
  commits: 4
  completed_at: "2026-02-16T10:04:41Z"
---

# Phase 06.6 Plan 08: UAT UI/UX Fixes - Glass Readability, Retry Logic, Auth Tokens

**One-liner:** Increased glassmorphism opacity/blur for text readability, added exponential backoff retry logic to ticket fetching, fixed report form styling, and gracefully handle stale auth tokens.

## Overview

Fixed 7 UAT test failures (Tests 8, 9, 11, 14, 15, 18, 19) covering design token readability, dashboard card contrast, infinite retry loops, report form styling, transparency dashboard contrast, and stale token handling. The glassmorphism system was too transparent for text-heavy content over the Johannesburg skyline background. Municipal dashboard cards blended into the pink background. The tickets page entered an infinite retry loop when the backend was unreachable (BLOCKER). Submit button and form elements had poor visibility. Stale auth tokens caused console errors on every page load.

## Tasks Completed

### Task 1: Increase glass readability tokens and dashboard card contrast

**Files:**
- `shared/design-tokens.css`
- `frontend-dashboard/src/components/dashboard/MetricsCards.tsx`
- `frontend-dashboard/src/App.css`
- `frontend-dashboard/src/pages/DashboardPage.tsx`

**Changes:**
- Increased `--glass-white-frost` from `rgba(255, 255, 255, 0.25)` to `0.35`
- Increased `--glass-pink-frost` from `rgba(205, 94, 129, 0.25)` to `0.35`
- Increased `--glass-border` from `0.2` to `0.25`
- Increased `--glass-blur-subtle` from `10px` to `16px`
- Increased `--glass-blur-medium` from `20px` to `28px`
- Enhanced `.animated-card` with `rgba(255, 255, 255, 0.30)` background and `blur(20px)`
- Updated metric card titles from `text-secondary` to `text-primary` with `text-shadow`
- Added placeholder cards for no-data state (shows "--" instead of empty space)
- Added `text-shadow` to dashboard title for readability over pink surface

**Commit:** `e5f67f3`

### Task 2: Add retry logic with exponential backoff to TicketListPage

**Files:**
- `frontend-dashboard/src/pages/TicketListPage.tsx`

**Changes:**
- Added `MAX_RETRIES = 3` constant
- Added `retryCount` state and `retryTimeoutRef` for timeout management
- Added `prevFiltersRef` to detect genuine filter changes vs re-renders
- Reset retry count when filters genuinely change
- Implemented exponential backoff: 1s, 2s, 4s between retries
- Show yellow warning banner during retries with countdown message
- Show red error banner with manual "Retry" button after max retries exhausted
- Added `retryCount > MAX_RETRIES` guard to prevent infinite loop
- Cleanup timeout on component unmount
- Fixed UAT Test 15 BLOCKER: infinite retry loop producing 124+ errors when backend unreachable

**Commit:** `df6b0e2`

### Task 3: Fix Report page Submit button visibility and form readability

**Files:**
- `frontend-public/src/pages/ReportIssuePage.tsx`
- `frontend-public/src/App.css`

**Changes:**
- Replaced gradient text heading with solid `var(--text-primary)` color and `text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3)`
- Added explicit coral background styling to Submit Report button: `backgroundColor: 'var(--color-coral)'`, white text, larger font (1.1rem), proper padding (14px 24px)
- Updated character counter from `rgba(255,255,255,0.6)` to `var(--text-secondary)` with `text-shadow`
- Added CSS rule `#description::placeholder { color: rgba(255, 255, 255, 0.5); }` for improved placeholder contrast
- Fixed UAT Test 8: Submit Report button now has prominent coral background (was transparent)
- Fixed UAT Test 9: Report form heading and character counter now readable (was low contrast)

**Commit:** `99771df`

### Task 4: Fix Transparency Dashboard contrast and stale auth token handling

**Files:**
- `frontend-public/src/pages/TransparencyDashboardPage.tsx`
- `frontend-public/src/App.css`
- `frontend-public/src/contexts/AuthContext.tsx`

**Changes:**
- Replaced gradient text heading with solid white text: `color: 'var(--text-primary)'`, `textShadow: '0 2px 4px rgba(0, 0, 0, 0.3)'`
- Added `text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2)` to dashboard subtitle
- Upgraded `.metric-label` from `var(--text-muted)` (#c7b3ba) to `var(--text-secondary)` (#e0d4d8) with `text-shadow`
- Upgraded `.metric-note` from `var(--text-muted)` to `var(--text-secondary)` with `text-shadow`
- Added graceful stale token handling in `AuthContext.getSession()`: destructure `error` from response, log warning (not error), call `supabase.auth.signOut()` to clear invalid session, set session/user to null
- Fixed UAT Test 11: Transparency dashboard heading and metric labels now readable
- Fixed UAT Test 18: Stale refresh tokens cleared gracefully, no more `AuthApiError: Invalid Refresh Token` console spam

**Commit:** `374a5aa`

## Deviations from Plan

None - plan executed exactly as written.

## Verification

All verification steps passed:

1. `cd frontend-dashboard && npx vite build` - SUCCESS (1m 29s)
2. `cd frontend-public && npx vite build` - SUCCESS (1m 1s, 1m 14s)
3. `grep -c "0.35" shared/design-tokens.css` - 2 (white-frost and pink-frost)
4. `grep -c "MAX_RETRIES" frontend-dashboard/src/pages/TicketListPage.tsx` - 6
5. `grep -c "animated-card" frontend-dashboard/src/App.css` - 7
6. `grep -c "textShadow" frontend-dashboard/src/pages/DashboardPage.tsx` - 1
7. `grep -c "color-coral" frontend-public/src/pages/ReportIssuePage.tsx` - 1
8. `grep -c "textShadow" frontend-public/src/pages/ReportIssuePage.tsx` - 3
9. `grep -c "text-secondary" frontend-public/src/pages/ReportIssuePage.tsx` - 1
10. `grep -c "text-shadow" frontend-public/src/App.css` - 3
11. `grep -c "Session recovery failed" frontend-public/src/contexts/AuthContext.tsx` - 1
12. `grep -c "textShadow" frontend-public/src/pages/TransparencyDashboardPage.tsx` - 2

## Success Criteria

All success criteria met:

- [x] Glass design tokens increased: white-frost 0.35, pink-frost 0.35, blur-subtle 16px, blur-medium 28px
- [x] Dashboard stat cards have visible white border and enhanced background opacity
- [x] Metric card titles use primary text color with text-shadow
- [x] No-data state shows "--" placeholders instead of empty space
- [x] TicketListPage has max 3 retries with 1s/2s/4s exponential backoff
- [x] After max retries, error UI shows with clickable Retry button
- [x] No infinite retry loop possible under any network condition
- [x] Submit Report button has explicit coral background, white text, and text-shadow (Test 8)
- [x] Report heading uses solid text-primary color with text-shadow, not gradient (Test 9)
- [x] Character counter uses text-secondary with text-shadow for readability (Test 9)
- [x] Transparency dashboard heading uses solid white text with text-shadow (Test 11)
- [x] Metric labels and notes upgraded from text-muted to text-secondary with text-shadow (Test 11)
- [x] Stale auth refresh tokens caught and cleared gracefully, no AuthApiError console spam (Test 18)
- [x] Both frontend apps build successfully

## Impact

**UAT Test Coverage:**
- Test 8: Submit Report button visibility - FIXED
- Test 9: Report form layout and readability - FIXED
- Test 11: Transparency Dashboard contrast - FIXED
- Test 14: Municipal Dashboard card contrast - FIXED
- Test 15: Tickets page infinite retry loop - FIXED (BLOCKER)
- Test 18: Console errors from stale auth tokens - FIXED
- Test 19: Glassmorphism readability system-wide - FIXED

**Readability improvements:**
- Text contrast improved across all glassmorphic cards (0.25 → 0.35 opacity)
- Blur effect strengthened for better text separation from background (10-20px → 16-28px)
- Text shadows added to all critical text over photo backgrounds
- Color upgrades: text-muted (#c7b3ba) → text-secondary (#e0d4d8) where needed

**Error resilience:**
- Ticket fetching now resilient to backend outages with exponential backoff
- Stale auth sessions cleared automatically without console errors
- Users presented with clear manual retry option after automatic attempts exhausted

## Self-Check

Verifying all claimed files and commits exist:

```bash
# Check Task 1 files
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/shared/design-tokens.css" ] && echo "FOUND: shared/design-tokens.css" || echo "MISSING"
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-dashboard/src/App.css" ] && echo "FOUND: frontend-dashboard/src/App.css" || echo "MISSING"
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-dashboard/src/components/dashboard/MetricsCards.tsx" ] && echo "FOUND: MetricsCards.tsx" || echo "MISSING"
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-dashboard/src/pages/DashboardPage.tsx" ] && echo "FOUND: DashboardPage.tsx" || echo "MISSING"

# Check Task 2 file
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-dashboard/src/pages/TicketListPage.tsx" ] && echo "FOUND: TicketListPage.tsx" || echo "MISSING"

# Check Task 3 files
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-public/src/pages/ReportIssuePage.tsx" ] && echo "FOUND: ReportIssuePage.tsx" || echo "MISSING"
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-public/src/App.css" ] && echo "FOUND: frontend-public/src/App.css" || echo "MISSING"

# Check Task 4 files
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-public/src/pages/TransparencyDashboardPage.tsx" ] && echo "FOUND: TransparencyDashboardPage.tsx" || echo "MISSING"
[ -f "C:/Users/Bantu/mzansi-agentive/salga-trust-engine/frontend-public/src/contexts/AuthContext.tsx" ] && echo "FOUND: AuthContext.tsx" || echo "MISSING"

# Check commits
git log --oneline --all | grep -q "e5f67f3" && echo "FOUND: e5f67f3" || echo "MISSING"
git log --oneline --all | grep -q "df6b0e2" && echo "FOUND: df6b0e2" || echo "MISSING"
git log --oneline --all | grep -q "99771df" && echo "FOUND: 99771df" || echo "MISSING"
git log --oneline --all | grep -q "374a5aa" && echo "FOUND: 374a5aa" || echo "MISSING"
```

## Self-Check: PASSED

All files and commits verified:
- FOUND: shared/design-tokens.css
- FOUND: frontend-dashboard/src/App.css
- FOUND: MetricsCards.tsx
- FOUND: DashboardPage.tsx
- FOUND: TicketListPage.tsx
- FOUND: ReportIssuePage.tsx
- FOUND: frontend-public/src/App.css
- FOUND: TransparencyDashboardPage.tsx
- FOUND: AuthContext.tsx
- FOUND: e5f67f3
- FOUND: df6b0e2
- FOUND: 99771df
- FOUND: 374a5aa
