---
phase: 06.6-playwright-e2e
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend-public/src/pages/CitizenRegisterPage.tsx
  - frontend-public/src/pages/CitizenLoginPage.tsx
  - frontend-dashboard/src/pages/LoginPage.tsx
  - frontend-public/src/components/landing/FeaturesSection.tsx
  - frontend-public/src/App.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Create Account button on register page is visible and clickable"
    - "Sign In button on citizen login page is visible and clickable"
    - "Sign In button on municipal login page is visible and clickable"
    - "Citizen Portal heading on login page is visible"
    - "Feature cards in How It Works section are visible on mobile viewports"
    - "Register card does not overlap the header/navbar"
  artifacts:
    - path: "frontend-public/src/pages/CitizenRegisterPage.tsx"
      provides: "Register page with safe GSAP animation and correct paddingTop"
      contains: "clearProps"
    - path: "frontend-public/src/pages/CitizenLoginPage.tsx"
      provides: "Login page with safe GSAP animation"
      contains: "clearProps"
    - path: "frontend-dashboard/src/pages/LoginPage.tsx"
      provides: "Municipal login with safe GSAP animation"
      contains: "clearProps"
    - path: "frontend-public/src/components/landing/FeaturesSection.tsx"
      provides: "Feature cards with CSS visibility fallback"
      contains: "clearProps"
    - path: "frontend-public/src/App.css"
      provides: "CSS fallback ensuring feature-card visibility"
      contains: "visibility: visible"
  key_links:
    - from: "CitizenRegisterPage.tsx"
      to: "GSAP timeline"
      via: "clearProps on animation complete"
      pattern: "clearProps.*opacity"
    - from: "FeaturesSection.tsx"
      to: "ScrollTrigger"
      via: "onComplete callback ensuring visibility"
      pattern: "clearProps|onComplete"
---

<objective>
Fix GSAP animation issues that leave buttons, headings, and feature cards invisible across all auth pages and the landing page.

Purpose: 4 BLOCKER gaps and 2 MAJOR gaps stem from GSAP `from()` animations setting `opacity: 0` on elements. If the animation doesn't complete or ScrollTrigger doesn't fire, elements remain invisible. This plan eliminates that failure mode across all affected pages.

Output: All auth pages show buttons/headings immediately after animation, feature cards visible on all viewports, register page correctly positioned below header.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.6-playwright-e2e/06.6-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix GSAP opacity:0 animations on all auth pages</name>
  <files>
    frontend-public/src/pages/CitizenRegisterPage.tsx
    frontend-public/src/pages/CitizenLoginPage.tsx
    frontend-dashboard/src/pages/LoginPage.tsx
  </files>
  <action>
Fix the GSAP animation pattern that sets `opacity: 0` on form children (buttons, headings) and may leave them invisible if animation fails.

**CitizenRegisterPage.tsx** (lines 54-77):
1. Replace the `tl.from(formFieldsRef.current?.children, { y: 20, opacity: 0, ... })` stagger animation with a safer pattern that uses `clearProps: 'opacity,transform'` on complete:
   ```tsx
   tl.from(
     formFieldsRef.current?.children || [],
     {
       y: 20,
       opacity: 0,
       duration: 0.4,
       stagger: 0.1,
       clearProps: 'opacity,transform',
     },
     '-=0.3'
   );
   ```
2. Also add `clearProps: 'opacity,transform'` to the card slide-up animation (`tl.from(cardRef.current, { y: 50, opacity: 0, ... })`).
3. Add `opacity: 1` to the button style object (line 413-426) as a defensive CSS fallback.
4. Fix Gap 5: Change the container style (line 322-330) from `padding: 'var(--space-lg) 0'` to `paddingTop: '100px', paddingBottom: 'var(--space-lg)', paddingLeft: 0, paddingRight: 0` to clear the fixed header (matching CitizenLoginPage's pattern but with slightly more room since the register form is taller).

**CitizenLoginPage.tsx** (lines 55-78):
1. Same fix: Add `clearProps: 'opacity,transform'` to both the card animation and the form fields stagger animation.
2. Add `opacity: 1` to the button style object as defensive fallback.

**Municipal LoginPage.tsx** (lines 40-71):
1. Same fix: Add `clearProps: 'opacity,transform'` to all three GSAP `from()` calls: productInfoRef, cardRef, and formFieldsRef.children.
2. Add `opacity: 1` to the button style object as defensive fallback.

**Why clearProps:** GSAP `from()` sets inline styles that override CSS. `clearProps` removes them after animation completes, returning to CSS defaults. This ensures even if animation is interrupted or replayed, elements remain visible.

**Do NOT:** Remove the animations entirely — they are part of the premium UX. Only add the safety net.
  </action>
  <verify>
Run `cd frontend-public && npx vite build` and `cd frontend-dashboard && npx vite build` to confirm no build errors. Grep for `clearProps` in all three files to confirm the fix is applied. Grep for `paddingTop` in CitizenRegisterPage.tsx to confirm Gap 5 fix.
  </verify>
  <done>
All auth page GSAP animations include clearProps, button styles have explicit opacity: 1, register page has paddingTop: 100px clearing the fixed header. Both frontends build without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix feature card visibility on mobile with CSS fallback</name>
  <files>
    frontend-public/src/components/landing/FeaturesSection.tsx
    frontend-public/src/App.css
  </files>
  <action>
Fix Gap 1: Feature cards use GSAP `fromTo` with `autoAlpha: 0` (sets `visibility: hidden; opacity: 0`) paired with ScrollTrigger. On mobile viewports where ScrollTrigger may not fire (viewport too small, section never reaches trigger point), cards remain invisible.

**FeaturesSection.tsx** (lines 22-42):
1. Add `clearProps: 'opacity,visibility,transform'` to the `to` vars of the `gsap.fromTo()` call so that after animation completes, inline GSAP styles are removed and CSS takes over:
   ```tsx
   gsap.fromTo(cards,
     {
       autoAlpha: 0,
       y: 80,
       rotateX: 5,
     },
     {
       autoAlpha: 1,
       y: 0,
       rotateX: 0,
       duration: 0.8,
       stagger: 0.2,
       ease: 'back.out(1.7)',
       clearProps: 'opacity,visibility,transform',
       scrollTrigger: {
         trigger: '.features-grid',
         start: 'top 85%',       // Changed from 75% to 85% — fires earlier, especially on mobile
         toggleActions: 'play none none none',  // Changed: don't reverse — once visible, stay visible
         once: true,              // Added: only animate once, then leave in final state
       },
     }
   );
   ```
2. Note the key changes: `start: 'top 85%'` (triggers earlier for smaller viewports), `toggleActions: 'play none none none'` (no reverse — once cards appear they stay), `once: true` (animation runs once then ScrollTrigger is killed, preventing re-hiding on scroll). The `clearProps` ensures GSAP inline styles are removed after animation.

**App.css** (around line 219-222):
3. Update the `.feature-card` CSS to include a `!important` visibility fallback that ensures cards are never permanently hidden. Add just below the existing `.feature-card` rule:
   ```css
   .feature-card {
     transition: var(--transition-base);
     opacity: 1;
     visibility: visible;
   }

   /* Ensure feature cards become visible even if GSAP fails to execute */
   @supports (animation: none) {
     .feature-card[style*="visibility: hidden"] {
       animation: feature-card-fallback 0s 2s forwards;
     }
   }

   @keyframes feature-card-fallback {
     to {
       visibility: visible !important;
       opacity: 1 !important;
     }
   }
   ```
   This CSS fallback fires after 2 seconds if GSAP set `visibility: hidden` but never set it back. It is a pure safety net.

4. Also increase the glass-card readability for feature cards by adding a `text-shadow` to `.feature-description`:
   ```css
   .feature-description {
     font-size: 1rem;
     color: var(--text-secondary);
     line-height: 1.6;
     text-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
   }
   ```

**Do NOT:** Remove the GSAP animation entirely. The scroll-triggered entrance is part of the design.
  </action>
  <verify>
Run `cd frontend-public && npx vite build` to confirm no build errors. Grep for `clearProps` in FeaturesSection.tsx. Grep for `feature-card-fallback` in App.css to confirm the CSS fallback keyframe exists. Grep for `once: true` in FeaturesSection.tsx.
  </verify>
  <done>
Feature cards have GSAP clearProps for post-animation cleanup, ScrollTrigger fires earlier (85% viewport), animation runs once without reversing, and a 2-second CSS fallback keyframe ensures visibility even if GSAP fails entirely. Feature description text has subtle text-shadow for readability.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend-public && npx vite build` completes with zero errors
2. `cd frontend-dashboard && npx vite build` completes with zero errors
3. All auth page buttons have `clearProps` in their GSAP animations
4. Feature cards have CSS visibility fallback and `once: true` ScrollTrigger
5. Register page has `paddingTop: '100px'` to clear fixed header
</verification>

<success_criteria>
- All GSAP animations across 4 pages include `clearProps` safety net
- No button or heading can remain at `opacity: 0` after animation completes
- Feature cards trigger at `85%` viewport, animate once, and have CSS fallback
- Register page does not overlap navbar (paddingTop matches login page pattern)
- Both frontend apps build successfully
</success_criteria>

<output>
After completion, create `.planning/phases/06.6-playwright-e2e/06.6-07-SUMMARY.md`
</output>
