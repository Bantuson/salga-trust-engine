---
phase: 06.6-playwright-e2e
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend-public/src/pages/CitizenRegisterPage.tsx
  - frontend-public/src/pages/CitizenLoginPage.tsx
  - frontend-dashboard/src/pages/LoginPage.tsx
  - frontend-dashboard/src/pages/RequestAccessPage.tsx
  - frontend-public/src/components/landing/FeaturesSection.tsx
  - frontend-public/src/components/landing/HeroSection.tsx
  - frontend-public/src/components/landing/ProblemSection.tsx
  - frontend-public/src/components/landing/DashboardCTA.tsx
  - frontend-public/src/App.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Create Account button on register page is visible and clickable"
    - "Sign In button on citizen login page is visible and clickable"
    - "Sign In button on municipal login page is visible and clickable"
    - "Citizen Portal heading on login page is visible"
    - "Feature cards in How It Works section are visible on mobile viewports"
    - "Register card does not overlap the header/navbar"
    - "DashboardCTA View Dashboard button is clearly visible with solid background"
    - "Landing page hero CTA has solid gold background, not just gradient text on transparent"
    - "Form inputs have autocomplete attributes on login, register, request-access pages"
    - "Request Access page has single Sign In link, not two redundant ones"
    - "Landing page GSAP animations all include clearProps safety"
  artifacts:
    - path: "frontend-public/src/pages/CitizenRegisterPage.tsx"
      provides: "Register page with safe GSAP animation, correct paddingTop, autocomplete attrs"
      contains: "clearProps"
    - path: "frontend-public/src/pages/CitizenLoginPage.tsx"
      provides: "Login page with safe GSAP animation, autocomplete attrs"
      contains: "clearProps"
    - path: "frontend-dashboard/src/pages/LoginPage.tsx"
      provides: "Municipal login with safe GSAP animation, autocomplete attrs"
      contains: "clearProps"
    - path: "frontend-dashboard/src/pages/RequestAccessPage.tsx"
      provides: "Request access with GSAP clearProps, single footer link, autocomplete attrs"
      contains: "clearProps"
    - path: "frontend-public/src/components/landing/FeaturesSection.tsx"
      provides: "Feature cards with CSS visibility fallback"
      contains: "clearProps"
    - path: "frontend-public/src/components/landing/DashboardCTA.tsx"
      provides: "Dashboard CTA with visible solid button"
      contains: "clearProps"
    - path: "frontend-public/src/App.css"
      provides: "CSS fallback for feature-card visibility, solid hero-cta styling"
      contains: "visibility: visible"
  key_links:
    - from: "CitizenRegisterPage.tsx"
      to: "GSAP timeline"
      via: "clearProps on animation complete"
      pattern: "clearProps.*opacity"
    - from: "FeaturesSection.tsx"
      to: "ScrollTrigger"
      via: "onComplete callback ensuring visibility"
      pattern: "clearProps|onComplete"
---

<objective>
Fix GSAP animation visibility, CTA button styling, autocomplete attributes, landing page readability, and request access UX across all auth and landing pages.

Purpose: Covers UAT tests 1-6, 8, 12, 16, 17, 20. GSAP `from()` animations set `opacity: 0` and may leave elements invisible. Landing page CTAs use gradient text on transparent backgrounds (low visibility). Auth form inputs lack autocomplete attributes. Request Access page has redundant Sign In links.

Output: All auth pages show buttons/headings immediately after animation, feature cards visible on all viewports, register page positioned below header, landing CTAs have solid backgrounds, form inputs have autocomplete, request access has single sign-in link.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.6-playwright-e2e/06.6-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix GSAP opacity:0 animations on all auth pages</name>
  <files>
    frontend-public/src/pages/CitizenRegisterPage.tsx
    frontend-public/src/pages/CitizenLoginPage.tsx
    frontend-dashboard/src/pages/LoginPage.tsx
  </files>
  <action>
Fix the GSAP animation pattern that sets `opacity: 0` on form children (buttons, headings) and may leave them invisible if animation fails.

**CitizenRegisterPage.tsx** (lines 54-77):
1. Replace the `tl.from(formFieldsRef.current?.children, { y: 20, opacity: 0, ... })` stagger animation with a safer pattern that uses `clearProps: 'opacity,transform'` on complete:
   ```tsx
   tl.from(
     formFieldsRef.current?.children || [],
     {
       y: 20,
       opacity: 0,
       duration: 0.4,
       stagger: 0.1,
       clearProps: 'opacity,transform',
     },
     '-=0.3'
   );
   ```
2. Also add `clearProps: 'opacity,transform'` to the card slide-up animation (`tl.from(cardRef.current, { y: 50, opacity: 0, ... })`).
3. Add `opacity: 1` to the button style object (line 413-426) as a defensive CSS fallback.
4. Fix Gap 5: Change the container style (line 322-330) from `padding: 'var(--space-lg) 0'` to `paddingTop: '100px', paddingBottom: 'var(--space-lg)', paddingLeft: 0, paddingRight: 0` to clear the fixed header (matching CitizenLoginPage's pattern but with slightly more room since the register form is taller).

**CitizenLoginPage.tsx** (lines 55-78):
1. Same fix: Add `clearProps: 'opacity,transform'` to both the card animation and the form fields stagger animation.
2. Add `opacity: 1` to the button style object as defensive fallback.

**Municipal LoginPage.tsx** (lines 40-71):
1. Same fix: Add `clearProps: 'opacity,transform'` to all three GSAP `from()` calls: productInfoRef, cardRef, and formFieldsRef.children.
2. Add `opacity: 1` to the button style object as defensive fallback.

**Why clearProps:** GSAP `from()` sets inline styles that override CSS. `clearProps` removes them after animation completes, returning to CSS defaults. This ensures even if animation is interrupted or replayed, elements remain visible.

**Autocomplete attributes (Test 20):**
5. Add `autoComplete` props to all form inputs across the three auth pages:
   - **CitizenRegisterPage.tsx:** fullName input → `autoComplete="name"`, email → `autoComplete="email"`, password → `autoComplete="new-password"`, confirmPassword → `autoComplete="new-password"`, phone → `autoComplete="tel"`.
   - **CitizenLoginPage.tsx:** email input → `autoComplete="email"`, password → `autoComplete="current-password"`, phone → `autoComplete="tel"`, OTP → `autoComplete="one-time-code"`.
   - **Municipal LoginPage.tsx:** email → `autoComplete="email"`, password → `autoComplete="current-password"`, phone → `autoComplete="tel"`, OTP → `autoComplete="one-time-code"`.

**Do NOT:** Remove the animations entirely — they are part of the premium UX. Only add the safety net.
  </action>
  <verify>
Run `cd frontend-public && npx vite build` and `cd frontend-dashboard && npx vite build` to confirm no build errors. Grep for `clearProps` in all three files to confirm the fix is applied. Grep for `paddingTop` in CitizenRegisterPage.tsx to confirm Gap 5 fix.
  </verify>
  <done>
All auth page GSAP animations include clearProps, button styles have explicit opacity: 1, register page has paddingTop: 100px clearing the fixed header. Both frontends build without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix feature card visibility on mobile with CSS fallback</name>
  <files>
    frontend-public/src/components/landing/FeaturesSection.tsx
    frontend-public/src/App.css
  </files>
  <action>
Fix Gap 1: Feature cards use GSAP `fromTo` with `autoAlpha: 0` (sets `visibility: hidden; opacity: 0`) paired with ScrollTrigger. On mobile viewports where ScrollTrigger may not fire (viewport too small, section never reaches trigger point), cards remain invisible.

**FeaturesSection.tsx** (lines 22-42):
1. Add `clearProps: 'opacity,visibility,transform'` to the `to` vars of the `gsap.fromTo()` call so that after animation completes, inline GSAP styles are removed and CSS takes over:
   ```tsx
   gsap.fromTo(cards,
     {
       autoAlpha: 0,
       y: 80,
       rotateX: 5,
     },
     {
       autoAlpha: 1,
       y: 0,
       rotateX: 0,
       duration: 0.8,
       stagger: 0.2,
       ease: 'back.out(1.7)',
       clearProps: 'opacity,visibility,transform',
       scrollTrigger: {
         trigger: '.features-grid',
         start: 'top 85%',       // Changed from 75% to 85% — fires earlier, especially on mobile
         toggleActions: 'play none none none',  // Changed: don't reverse — once visible, stay visible
         once: true,              // Added: only animate once, then leave in final state
       },
     }
   );
   ```
2. Note the key changes: `start: 'top 85%'` (triggers earlier for smaller viewports), `toggleActions: 'play none none none'` (no reverse — once cards appear they stay), `once: true` (animation runs once then ScrollTrigger is killed, preventing re-hiding on scroll). The `clearProps` ensures GSAP inline styles are removed after animation.

**App.css** (around line 219-222):
3. Update the `.feature-card` CSS to include a `!important` visibility fallback that ensures cards are never permanently hidden. Add just below the existing `.feature-card` rule:
   ```css
   .feature-card {
     transition: var(--transition-base);
     opacity: 1;
     visibility: visible;
   }

   /* Ensure feature cards become visible even if GSAP fails to execute */
   @supports (animation: none) {
     .feature-card[style*="visibility: hidden"] {
       animation: feature-card-fallback 0s 2s forwards;
     }
   }

   @keyframes feature-card-fallback {
     to {
       visibility: visible !important;
       opacity: 1 !important;
     }
   }
   ```
   This CSS fallback fires after 2 seconds if GSAP set `visibility: hidden` but never set it back. It is a pure safety net.

4. Also increase the glass-card readability for feature cards by adding a `text-shadow` to `.feature-description`:
   ```css
   .feature-description {
     font-size: 1rem;
     color: var(--text-secondary);
     line-height: 1.6;
     text-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
   }
   ```

**Do NOT:** Remove the GSAP animation entirely. The scroll-triggered entrance is part of the design.
  </action>
  <verify>
Run `cd frontend-public && npx vite build` to confirm no build errors. Grep for `clearProps` in FeaturesSection.tsx. Grep for `feature-card-fallback` in App.css to confirm the CSS fallback keyframe exists. Grep for `once: true` in FeaturesSection.tsx.
  </verify>
  <done>
Feature cards have GSAP clearProps for post-animation cleanup, ScrollTrigger fires earlier (85% viewport), animation runs once without reversing, and a 2-second CSS fallback keyframe ensures visibility even if GSAP fails entirely. Feature description text has subtle text-shadow for readability.
  </done>
</task>

<task type="auto">
  <name>Task 3: Fix landing page CTA visibility and GSAP safety on hero + problem + CTA sections</name>
  <files>
    frontend-public/src/components/landing/HeroSection.tsx
    frontend-public/src/components/landing/ProblemSection.tsx
    frontend-public/src/components/landing/DashboardCTA.tsx
    frontend-public/src/App.css
  </files>
  <action>
Fix Tests 1 and 11: Landing page CTAs use gradient text on transparent backgrounds making them nearly invisible. GSAP animations on hero, problem, and CTA sections also lack clearProps safety.

**HeroSection.tsx** (lines 17-33):
1. Add `clearProps: 'opacity,transform'` to all three `tl.from()` calls (headlineRef, subtitleRef, ctaRef).
2. The hero CTA uses `.hero-cta` class with `background: transparent` (App.css line 104). This makes the button text (gradient via `.text-coral`) float on a transparent glass card — nearly invisible against the skyline.

**App.css — .hero-cta** (around lines 101-123):
3. Change the `.hero-cta` from transparent background to a solid gold CTA button:
   ```css
   .hero-cta {
     display: inline-block;
     padding: 1rem 2.5rem;
     background: var(--color-accent-gold);
     color: #333;
     border: none;
     text-decoration: none;
     border-radius: var(--radius-md);
     font-weight: 700;
     font-size: 1.125rem;
     transition: var(--transition-base);
     box-shadow: var(--glow-gold);
   }
   ```
4. Update `.hero-cta .text-coral` to override the gradient text and use solid dark text instead:
   ```css
   .hero-cta .text-coral {
     font-size: inherit;
     font-weight: inherit;
     background: none;
     -webkit-background-clip: unset;
     -webkit-text-fill-color: #333;
     background-clip: unset;
     color: #333;
   }
   ```

**ProblemSection.tsx** (lines 13-36):
5. Add `clearProps: 'opacity,transform'` and `once: true` to the ScrollTrigger config on each reveal-line animation. This prevents problem text from reversing to invisible on scroll back.

**DashboardCTA.tsx** (lines 15-36):
6. Add `clearProps: 'opacity,transform'` to the section `gsap.fromTo()`.
7. Change the `<Link>` inside DashboardCTA from using `.hero-cta` class with `.text-coral` span to use the `.preview-cta-button` class (which already has `background: var(--color-accent-gold)` at App.css line 1222). Update:
   ```tsx
   <Link to="/dashboard" className="preview-cta-link" style={{ marginTop: 'var(--space-xl)' }}>
     <span className="preview-cta-button">View Dashboard</span>
   </Link>
   ```

**Do NOT:** Change the hero headline gradient text (`.text-coral` on the headline is fine — it's large text). Only fix the CTA buttons.
  </action>
  <verify>
Run `cd frontend-public && npx vite build` to confirm no build errors. Grep for `clearProps` in HeroSection.tsx, ProblemSection.tsx, DashboardCTA.tsx. Grep for `color: #333` in App.css `.hero-cta` to confirm solid text. Grep for `preview-cta-button` in DashboardCTA.tsx.
  </verify>
  <done>
Hero CTA has solid gold background with dark text (not gradient on transparent). DashboardCTA uses preview-cta-button with gold background. All landing sections have GSAP clearProps safety. Problem section animations play once.
  </done>
</task>

<task type="auto">
  <name>Task 4: Fix Request Access redundant links and add autocomplete + GSAP clearProps</name>
  <files>
    frontend-dashboard/src/pages/RequestAccessPage.tsx
  </files>
  <action>
Fix Tests 16 and 20 for the Request Access page.

**Test 16 — Redundant footer links** (lines 507-520):
The footer currently has TWO Sign In links with nearly identical text:
```tsx
<p>Already have an invite? <Link to="/login">Sign In</Link></p>
<p>Already have an account? <Link to="/login">Sign In</Link></p>
```
1. Replace the footer with a single link:
   ```tsx
   <div style={styles.footer}>
     <p style={styles.footerText}>
       Already have an account?{' '}
       <Link to="/login" style={styles.link}>
         Sign In
       </Link>
     </p>
   </div>
   ```

**Test 20 — Autocomplete attributes:**
2. Add `autoComplete` props to form inputs. The `<Input>` component from shared accepts standard HTML input props:
   - municipalityName → `autoComplete="organization"`
   - contactName → `autoComplete="name"`
   - contactEmail → `autoComplete="email"`
   - contactPhone → `autoComplete="tel"`
   - Province select → `autoComplete="address-level1"`

**GSAP clearProps:**
3. Add `clearProps: 'opacity,transform'` to the card entrance animation (lines 104-115):
   ```tsx
   tl.from(cardRef.current, {
     y: 50,
     opacity: 0,
     duration: 0.8,
     ease: 'back.out(1.7)',
     clearProps: 'opacity,transform',
   });
   ```
  </action>
  <verify>
Run `cd frontend-dashboard && npx vite build`. Grep for `Already have an invite` in RequestAccessPage.tsx — should return 0 (removed). Grep for `autoComplete` in RequestAccessPage.tsx — should return >= 4. Grep for `clearProps` in RequestAccessPage.tsx.
  </verify>
  <done>
Request Access page has single footer link (redundant removed), form inputs have autocomplete attributes, GSAP animation includes clearProps safety.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend-public && npx vite build` completes with zero errors
2. `cd frontend-dashboard && npx vite build` completes with zero errors
3. All auth page buttons have `clearProps` in their GSAP animations
4. Feature cards have CSS visibility fallback and `once: true` ScrollTrigger
5. Register page has `paddingTop: '100px'` to clear fixed header
6. Hero CTA has solid `background: var(--color-accent-gold)` (not transparent)
7. DashboardCTA uses `preview-cta-button` class with gold background
8. All landing GSAP animations (hero, problem, features, CTA) have `clearProps`
9. Form inputs on register, login, municipal login, request-access have `autoComplete` attrs
10. Request Access page has single footer Sign In link (not two redundant ones)
</verification>

<success_criteria>
- All GSAP animations across 8+ pages include `clearProps` safety net
- No button or heading can remain at `opacity: 0` after animation completes
- Feature cards trigger at `85%` viewport, animate once, and have CSS fallback
- Register page does not overlap navbar (paddingTop matches login page pattern)
- Hero CTA and DashboardCTA buttons have solid gold backgrounds with dark text
- All form inputs across auth pages have proper autocomplete attributes
- Request Access page has single Sign In link (redundant removed)
- Both frontend apps build successfully
</success_criteria>

<output>
After completion, create `.planning/phases/06.6-playwright-e2e/06.6-07-SUMMARY.md`
</output>
