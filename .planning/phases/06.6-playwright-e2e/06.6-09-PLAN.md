---
phase: 06.6-playwright-e2e
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - shared/design-tokens.css
  - shared/components/ui/Button.tsx
  - frontend-public/src/components/landing/FeaturesSection.tsx
  - frontend-public/src/App.css
  - frontend-public/src/pages/CitizenLoginPage.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All primary CTA buttons (Create Account, Sign In, Submit Report) render with a visible coral background color, not transparent"
    - "Feature cards on mobile viewports (375px) are visible with opacity:1 and visibility:visible"
    - "Citizen Portal h1 heading on the login page is visible in the viewport with correct gradient text"
  artifacts:
    - path: "shared/design-tokens.css"
      provides: "--color-coral and --color-coral-hover CSS custom properties"
      contains: "--color-coral"
    - path: "frontend-public/src/App.css"
      provides: "Mobile safety net for feature cards"
      contains: "@media.*max-width.*768"
    - path: "frontend-public/src/components/landing/FeaturesSection.tsx"
      provides: "Mobile-aware GSAP animation that skips ScrollTrigger on small viewports"
    - path: "frontend-public/src/pages/CitizenLoginPage.tsx"
      provides: "Visible heading with explicit transform:none fallback"
  key_links:
    - from: "shared/design-tokens.css"
      to: "shared/components/ui/Button.tsx"
      via: "CSS variable --color-coral consumed by primary variant"
      pattern: "var\\(--color-coral\\)"
    - from: "shared/design-tokens.css"
      to: "frontend-public/src/pages/CitizenLoginPage.tsx"
      via: "CSS variable --color-coral consumed by button styles and title gradient"
      pattern: "var\\(--color-coral\\)"
---

<objective>
Fix three UAT-identified visual regressions: missing CTA button backgrounds (4 pages), invisible mobile feature cards, and hidden Citizen Portal heading.

Purpose: Close all remaining UAT gaps from phase 6.6 so every E2E test passes on both desktop and mobile viewports.
Output: Corrected CSS variables, mobile-safe animations, and visible heading — all compile clean.
</objective>

<execution_context>
@C:/Users/Bantu/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Bantu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@shared/design-tokens.css
@shared/components/ui/Button.tsx
@frontend-public/src/components/landing/FeaturesSection.tsx
@frontend-public/src/App.css
@frontend-public/src/pages/CitizenLoginPage.tsx
@frontend-public/src/pages/CitizenRegisterPage.tsx
@frontend-public/src/pages/ReportIssuePage.tsx
@frontend-dashboard/src/pages/LoginPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing --color-coral CSS variables to design tokens</name>
  <files>shared/design-tokens.css</files>
  <action>
    In `shared/design-tokens.css`, inside the `:root` block, add the following two CSS custom properties immediately after the `--color-teal-hover` line (line 17):

    ```css
    --color-coral: #FF6B4A;
    --color-coral-hover: #FF8266;
    ```

    This single addition resolves transparent backgrounds on ALL primary CTA buttons across 4 pages:
    - `frontend-public/src/pages/CitizenRegisterPage.tsx` (Create Account button)
    - `frontend-public/src/pages/CitizenLoginPage.tsx` (Sign In button)
    - `frontend-dashboard/src/pages/LoginPage.tsx` (Sign In button)
    - `frontend-public/src/pages/ReportIssuePage.tsx` (Submit Report button)
    - `shared/components/ui/Button.tsx` (primary variant)

    Also fixes the Citizen Portal heading gradient which uses `var(--color-coral)` as the first gradient stop.

    Do NOT modify any other file for this task — the variable definition in `:root` cascades to all consumers automatically.
  </action>
  <verify>
    1. `grep --color-coral shared/design-tokens.css` shows both `--color-coral` and `--color-coral-hover` defined.
    2. `grep -r "var(--color-coral)" shared/ frontend-public/ frontend-dashboard/` confirms all references now have a backing definition.
  </verify>
  <done>--color-coral: #FF6B4A and --color-coral-hover: #FF8266 exist in shared/design-tokens.css :root block. All button and heading gradient references to var(--color-coral) resolve to a visible color.</done>
</task>

<task type="auto">
  <name>Task 2: Fix mobile feature card visibility with viewport-aware GSAP and CSS safety net</name>
  <files>frontend-public/src/components/landing/FeaturesSection.tsx, frontend-public/src/App.css</files>
  <action>
    **Part A — FeaturesSection.tsx: Skip ScrollTrigger on mobile viewports**

    In `frontend-public/src/components/landing/FeaturesSection.tsx`, modify the `useGSAP` callback (lines 14-44). After the existing `reducedMotion` check on line 17, add a mobile viewport check. The full revised logic inside `useGSAP` should be:

    ```tsx
    const cards = sectionRef.current?.querySelectorAll('.feature-card');
    if (!cards || cards.length === 0) return;

    // On reduced motion OR mobile viewports, show cards immediately without ScrollTrigger
    const isMobile = window.innerWidth <= 768;
    if (reducedMotion || isMobile) {
      gsap.set(cards, { opacity: 1, visibility: 'visible', y: 0, rotateX: 0 });
      return;
    }

    gsap.fromTo(cards,
      {
        autoAlpha: 0,
        y: 80,
        rotateX: 5,
      },
      {
        autoAlpha: 1,
        y: 0,
        rotateX: 0,
        duration: 0.8,
        stagger: 0.2,
        ease: 'back.out(1.7)',
        clearProps: 'opacity,visibility,transform',
        scrollTrigger: {
          trigger: '.features-grid',
          start: 'top 85%',
          toggleActions: 'play none none none',
          once: true,
        },
      }
    );
    ```

    Key changes:
    - Added `const isMobile = window.innerWidth <= 768;`
    - Combined `reducedMotion || isMobile` into the early-return guard
    - The early-return now explicitly sets `visibility: 'visible'` in addition to `opacity: 1`

    **Part B — App.css: Replace broken attribute selector with mobile media query safety net**

    In `frontend-public/src/App.css`, replace the broken `@supports` fallback block (lines 231-243) with a reliable mobile safety net:

    Replace this:
    ```css
    /* Ensure feature cards become visible even if GSAP fails to execute */
    @supports (animation: none) {
      .feature-card[style*="visibility: hidden"] {
        animation: feature-card-fallback 0s 2s forwards;
      }
    }

    @keyframes feature-card-fallback {
      to {
        visibility: visible !important;
        opacity: 1 !important;
      }
    }
    ```

    With this:
    ```css
    /* Mobile safety net: ensure feature cards are always visible on small viewports
       even if GSAP ScrollTrigger fails to fire (viewport too short to reach trigger) */
    @media (max-width: 768px) {
      .feature-card {
        opacity: 1 !important;
        visibility: visible !important;
        transform: none !important;
      }
    }

    /* Desktop fallback: if GSAP hasn't animated after 3s, force-show cards */
    @keyframes feature-card-fallback {
      to {
        visibility: visible !important;
        opacity: 1 !important;
      }
    }
    .feature-card {
      animation: feature-card-fallback 0s 3s forwards;
    }
    ```
  </action>
  <verify>
    1. `grep -n "isMobile\|window.innerWidth" frontend-public/src/components/landing/FeaturesSection.tsx` confirms mobile detection is present.
    2. `grep -n "@media.*max-width.*768" frontend-public/src/App.css` confirms the mobile safety net media query exists.
    3. `grep -n "visibility: hidden" frontend-public/src/App.css` returns NO matches (broken attribute selector removed).
  </verify>
  <done>FeaturesSection.tsx skips ScrollTrigger on viewports <= 768px and sets cards to visible immediately. App.css has a @media (max-width: 768px) rule forcing feature-card opacity:1, visibility:visible, transform:none. Broken attribute selector is removed.</done>
</task>

<task type="auto">
  <name>Task 3: Fix Citizen Portal heading visibility on login page</name>
  <files>frontend-public/src/pages/CitizenLoginPage.tsx</files>
  <action>
    In `frontend-public/src/pages/CitizenLoginPage.tsx`, fix the heading visibility by updating the `title` style object (lines 334-343).

    The heading uses `background: 'linear-gradient(135deg, var(--color-coral), var(--color-teal))'` with `WebkitTextFillColor: 'transparent'`. When `--color-coral` was undefined, the gradient started from nothing, making text invisible. Task 1 fixes the variable, but we also need to guard against GSAP transform residue.

    Update the `title` styles object to add `transform: 'none'` and a text color fallback:

    ```typescript
    title: {
      fontSize: '1.75rem',
      fontWeight: '700',
      color: 'var(--color-coral, #FF6B4A)',
      marginBottom: '0.5rem',
      background: 'linear-gradient(135deg, var(--color-coral, #FF6B4A), var(--color-teal, #00bfa5))',
      WebkitBackgroundClip: 'text',
      WebkitTextFillColor: 'transparent',
      backgroundClip: 'text',
      transform: 'none',
      opacity: 1,
    } as React.CSSProperties,
    ```

    Changes:
    1. Added CSS fallback values to `var(--color-coral, #FF6B4A)` and `var(--color-teal, #00bfa5)` in both `color` and `background` properties — defense-in-depth if design-tokens.css fails to load.
    2. Added `transform: 'none'` to prevent any GSAP residual translateY from keeping the heading off-screen.
    3. Added `opacity: 1` to ensure GSAP doesn't leave it at 0.

    These are inline styles so they have high specificity and override any GSAP leftover.
  </action>
  <verify>
    1. `grep -n "transform.*none" frontend-public/src/pages/CitizenLoginPage.tsx` confirms transform reset is present on the title style.
    2. `grep -n "FF6B4A" frontend-public/src/pages/CitizenLoginPage.tsx` confirms fallback color values are present.
  </verify>
  <done>"Citizen Portal" h1 heading has explicit transform:none, opacity:1, and CSS variable fallback colors. It is visible in viewport regardless of GSAP animation state or CSS variable loading.</done>
</task>

<task type="auto">
  <name>Task 4: Verify all fixes compile without errors</name>
  <files>shared/design-tokens.css, shared/components/ui/Button.tsx, frontend-public/src/components/landing/FeaturesSection.tsx, frontend-public/src/App.css, frontend-public/src/pages/CitizenLoginPage.tsx</files>
  <action>
    Run TypeScript compilation checks and verify no build errors:

    1. `cd frontend-public && npx tsc --noEmit` — must exit 0 with no errors
    2. `cd frontend-dashboard && npx tsc --noEmit` — must exit 0 with no errors
    3. `cd frontend-public && npx vite build --mode development 2>&1 | tail -5` — must show successful build
    4. `cd frontend-dashboard && npx vite build --mode development 2>&1 | tail -5` — must show successful build

    If any compilation errors appear related to the changes (CSS types, style properties), fix them immediately. The `transform: 'none'` and `opacity: 1` are valid React.CSSProperties and should not cause TS errors.
  </action>
  <verify>
    All four commands above exit with code 0 and no errors in output.
  </verify>
  <done>Both frontend-public and frontend-dashboard compile cleanly (tsc --noEmit and vite build both succeed) with all gap-closure changes applied.</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **CTA Buttons (GAP 1):** Open each of the 4 affected pages in browser — all primary buttons show a coral (#FF6B4A) background, not transparent.
2. **Mobile Feature Cards (GAP 2):** Open landing page at 375px viewport width — all 3 feature cards are visible (opacity:1, visibility:visible).
3. **Login Heading (GAP 3):** Open Citizen Portal login page — "Citizen Portal" h1 is visible with gradient text in the viewport.
4. **No Regressions:** Both dashboards build and serve without errors.
</verification>

<success_criteria>
- shared/design-tokens.css defines --color-coral: #FF6B4A and --color-coral-hover: #FF8266
- All CTA buttons across 4 pages render with visible coral background
- Feature cards display on 375px mobile viewport without depending on ScrollTrigger
- "Citizen Portal" heading is visible with gradient text and transform:none
- Both frontend-public and frontend-dashboard compile cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/06.6-playwright-e2e/06.6-09-SUMMARY.md`
</output>
